!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@rxweb/reactive-form-validators"),require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define("@rxweb/reactive-dynamic-forms",["exports","@rxweb/reactive-form-validators","@angular/core","@angular/common"],t):t(((e=e||self).rxweb=e.rxweb||{},e.rxweb["reactive-dynamic-forms"]={}),e["@rxweb/reactive-form-validators"],e.ng.core,e.ng.common)}(this,function(e,t,o,n){"use strict";var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};function i(e,t){function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}var s=function(){return(s=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function c(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s}function a(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function l(e){var t="function"==typeof Symbol&&e[Symbol.iterator],o=0;return t?t.call(e):{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}}}function f(e,t){var o=!1;for(var n in t){if(Array.isArray(e[n]))for(var r=0;r<e[n].length;r++)o=f(e[n][r],t[n][r]);else o="object"==typeof e[n]?f(e[n],t[n]):!(e[n]==t[n]);if(o)break}return o}var u=function(){function e(){this.attributeChangeSubscriptions=new Array}return e.prototype.onPropValueChanged=function(e,t,o){this.attributeChangeSubscriptions.push({controlId:e,names:t.names,props:t.props,func:o})},e.prototype.notifyValueChanged=function(e,t,o,n){(void 0===n&&(n=!1),!n&&this.isNotEqual(o,t)&&this.onPropValueChanged)&&this.attributeChangeSubscriptions.filter(function(t){return-1!=t.names.indexOf(e)}).forEach(function(t){t.props&&t.props[e]&&t.func(t.props[e])})},e.prototype.isNotEqual=function(e,t){if(Array.isArray(e)&&Array.isArray(t)){var o=e.length!=t.length;if(!o)for(var n=0;n<e.length&&!(o=f(e[n],t[n]));n++);return o}return e!=t},e.prototype.destroy=function(e){for(var t=0;t<this.attributeChangeSubscriptions.length;t++)if(this.attributeChangeSubscriptions[t].controlId==e){this.attributeChangeSubscriptions.splice(t,1);break}},e}(),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.checkFilterFunction=function(){var e=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(this),"filter");this.isDefinedFilter=e&&!e.get&&!e.set&&"function"==typeof this.filter},t.prototype.overrideProp=function(e){var t=this;Object.keys(e).forEach(function(o){Object.defineProperty(t,o,e[o])})},t.prototype.defineProp=function(e){var t=this,o=this.props[e],n=null;Object.defineProperty(this.props,e,{get:function(){return o},set:function(r){o=r,t.notifyValueChanged("props."+e,o,n,!1),n=o}})},t.prototype.overrideProps=function(){var t=this;["disabled","label","placeholder","hide","description","focus","readonly","class","source"].forEach(function(o){var n=t.getDescriptor(o),r=null,i=null;Object.defineProperty(t,o,{get:function(){return n?n.get.call(t):r},set:function(s){r=s,n&&n.set&&n.set.call(t,s),e.prototype.notifyValueChanged.call(t,o,r,i),i=s}})})},t.prototype.overrideErrorsProp=function(e){var t=this,o=e.errors,n="",r=e.errorMessage;Object.defineProperty(e,"errors",{get:function(){return o},set:function(i){o=i,n=e.errorMessage,t.notifyValueChanged("errorMessage",n||"",r),r=e.errorMessage}}),e.errors=e.errors},t.prototype.getDescriptor=function(e){var t=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(this),e);return t||(t=Object.getOwnPropertyDescriptor(this,e)),t},t}(u),d="file",h="range",g="checkbox",m="",v="radio",y="input",C=function(){function e(){}return e.extractArguments=function(e){var t=["this"];return e&&e[0]&&e[0].split(",").forEach(function(e){return t.push(e.trim().replace("(","").replace(")",""))}),t},e.dynamicConfigParser=function(t){var o=[],n=e.extractArguments(t.match(/\(([^)]+)\)/g)),r=t.replace(new RegExp(/\r?\n|\r|;/g)," ").replace(/["%()\{}=\\?´`'#<>|,;:+-]+/g," ").split(/ /g);return n.length>3&&n.splice(n.length-1,1),r.forEach(function(e,t){if(e)if(e.includes("controlsConfig.")){var n=e.split("controlsConfig.");n.length>1&&o.push(n[1].split(".")[0])}else e.includes("controlsConfig[")&&o.push(r[t+1])}),o},e}(),b=function(){function e(){}return e.controlId=1,e.controls={},e}(),w=function(){function e(){}return e.notificationId=1,e.notifications={},e}(),P=function(e){function t(t,o){var n=e.call(this)||this;return n.configs=t,n.notificationId=o,n._actionResult={label:void 0,img:void 0,placeholder:void 0,source:[],filter:[],hide:!1,description:void 0,disabled:!1,focus:!1,readonly:!1,class:[],prependText:""},n}return i(t,e),t.prototype.setNotification=function(){w.notifications[this.notificationId]&&(w.notifications[this.notificationId][this.config.name]?this.controlNotifications=w.notifications[this.notificationId][this.config.name]:w.notifications[this.notificationId][this.config.name]=this.controlNotifications={filter:[],disabled:[],label:[],description:[],hide:[],placeholder:[],readonly:[],focus:[],class:[]}),this.complete()},t.prototype.complete=function(){var e=this,t=function(t){var n=o.getDescriptor(t);if(n&&n.get||o.isDefinedFilter){var r=o.isDefinedFilter?String(o.filter):String(n.get);C.dynamicConfigParser(r).forEach(function(o){w.notifications[e.notificationId][o]||(w.notifications[e.notificationId][o]={filter:[],disabled:[],label:[],description:[],hide:[],placeholder:[],readonly:[],focus:[],class:[]}),w.notifications[e.notificationId][o][t].push(e.config.name)})}},o=this;for(var n in this.controlNotifications)t(n);this.overrideProps(),this.updateActionValue()},t.prototype.refresh=function(e){var t=this;for(var o in this.controlNotifications)this.controlNotifications[o].length>0&&this.controlNotifications[o].forEach(function(e){"filter"==o&&(t.configs[e].value=null),e!=t.config.name?t.configs[e].refresh(o):t.setActionValue(o)});e&&this.setActionValue(e)},t.prototype.setActionValue=function(e){"filter"==e&&this.isDefinedFilter?this.filter.call(this):this["filter"==e?"source":e]=this[e]},t.prototype.updateActionValue=function(){var e=this;["disabled","label","img","placeholder","hide","description","focus","readonly","class","filter","source"].forEach(function(t){switch(t){case"filter":e.isDefinedFilter&&"filter"==t&&e.filter(),e.config.filter&&(e.filter=e.config.filter);break;case"source":e.config[t]&&(e[t]=e.config[t]),"source"!=t||e.source||(e[t]=[]);break;default:e.config.ui&&e.config.ui[t]?e[t]=e.config.ui[t]:e["filter"==t?"source":t]=e._actionResult[t]}})},t}(p),x=new(function(){function e(){this.components=[],this.overrideProps={}}return e.prototype.registerComponent=function(e,t){this.components.filter(function(e){return e.instance==t})[0]||this.components.push({instance:t,name:e})},e.prototype.registerOverrideProp=function(e){var t=this;e&&Object.keys(e).forEach(function(o){return t.overrideProps[o]=e[o]})},e.prototype.getOverrideProp=function(e){return this.overrideProps[e]},e.prototype.getComponent=function(e){return this.components.filter(function(t){return t.name==e})[0]},e}()),O=function(e){function t(t,o,n){var r=e.call(this,o,n)||this;return r.controlsConfig=o,r.overrides={},r.config=t,r.overrideProperty(),r.value=t.value,e.prototype.checkFilterFunction.call(r),r.props=r.config.props||Object.create({}),r.setNotification(),r}return i(t,e),t.prototype.overrideProperty=function(){var e=this;this.config.overrideProps&&this.config.overrideProps.forEach(function(t){var o=x.getOverrideProp(t);e.overrideProp(o)})},Object.defineProperty(t.prototype,"formControl",{get:function(){return this._formControl},set:function(e){var t=this;this._formControl=e,setTimeout(function(){return t.overrideErrorsProp(t._formControl)},10)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"errorMessage",{get:function(){return this.formControl.errorMessage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"prependText",{get:function(){return this.config.ui?this.config.ui.prependText:""},enumerable:!0,configurable:!0}),t}(P),M=function(e){function t(t,o){return e.call(this,t,o,0)||this}return i(t,e),t}(O);var k=function(){function e(){}return e.getRootFormGroup=function(e){return e.parent?this.getRootFormGroup(e.parent):e},e.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},e}(),R=function(){function e(){}return e.prototype.formGroup=function(e,o){var n=this,r=w.notificationId++;w.notifications[r]={},this.formConfiguration=o||{};var i={},s=new Array,c={},a=new t.RxFormGroup({},i,{},void 0);e.forEach(function(e,o){if("array"==e.type)n.createFormArray(c,e,k.getRootFormGroup(a),i,r);else{var l=e.name.split("."),f=e.name;l.length>1?(i[l[0]]?null!=a.controls[l[0]]&&a.controls[l[0]]instanceof t.RxFormGroup&&(a=a.controls[l[0]]):(i[l[0]]={},a.addControl(l[0],new t.RxFormGroup({},i[l[0]],{},void 0)),a=a.controls[l[0]]),f=l[1]):a=k.getRootFormGroup(a);var u=n.getDynamicModelInstance(e,c,i,f,r);a.addControl(f,u.formControl),s.push(u)}}),this.formConfiguration.additionalConfig&&this.formConfiguration.additionalConfig.forEach(function(e){return n.getModelInstance(e,c,r)});var l=k.getRootFormGroup(a);return l.model=void 0,{controlsConfig:c,formGroup:l}},e.prototype.createFormArray=function(e,o,n,r,i){var s=this;e[o.name]=[],r[o.name]=[];var c=new t.RxFormArray(r[o.name],[]);if(o.controlConfigs){if(o.rows&&o.rows.forEach(function(t){c.controls.push(s.createDynamicFormGroup(o,e[o.name],s.getRefObject(r[o.name]),t,i))}),o.minimumRepeatCount&&o.minimumRepeatCount>0)for(var a=o.minimumRepeatCount-c.controls.length,l=0;l<a;l++)c.controls.push(this.createDynamicFormGroup(o,e[o.name],this.getRefObject(r[o.name]),{fields:[]},i));this.addTwoProp(e[o.name],o,r[o.name],c,i),n.addControl(o.name,c)}},e.prototype.getRefObject=function(e){var t={};return e.push(t),t},e.prototype.addTwoProp=function(e,t,o,n,r){var i=this;e.__proto__.addItem=function(){n.controls.push(i.createDynamicFormGroup(t,e,i.getRefObject(o),{fields:[]},r))},e.__proto__.removeItem=function(t){n.removeAt(t),e.splice(t,1)}},e.prototype.createDynamicFormGroup=function(e,o,n,r,i){var c=this,a=new t.RxFormGroup({},n,{},void 0),l={};return o.push(l),Object.keys(e.controlConfigs).forEach(function(t){var o=r.fields.filter(function(e){return e.name==t})[0],f=s({},e.controlConfigs[t],{name:t});o&&(f=s({},f,o));var u=c.getDynamicModelInstance(f,l,n,t,i);a.addControl(t,u.formControl)}),a},e.prototype.getModelInstance=function(e,t,o){var n=e.modelName&&this.formConfiguration&&this.formConfiguration.controlConfigModels?this.formConfiguration.controlConfigModels.filter(function(t){return t.modelName==e.modelName})[0]:void 0,r=[e,t,o],i=void 0;n?(i=n.model,n.arguments&&n.arguments.forEach(function(e){return r.push(e)})):i=O;var s=function(e,t){var o=Object.create(e.prototype);try{e.apply(o,t)}catch(n){o=Reflect.construct(e,t)}return o}(i,r);return t[e.name]=s,s},e.prototype.getDynamicModelInstance=function(e,o,n,r,i){var s=this.getModelInstance(e,o,i),c=[],a=[];e.validators&&this.validatorBindings(c,e.validators),s.validator&&c.push(s.validator.bind(s)),s.asyncValidator&&a.push(s.asyncValidator.bind(s)),s&&(n[e.name]=e.value);var l={};return l[e.name]=e.value,n[e.name]=e.value,s.formControl=new t.RxFormControl(e.value,c,a,n,l,r,void 0),s},e.prototype.validatorBindings=function(e,o){for(var n in t.RxwebValidators)o[n]&&e.push(t.RxwebValidators[n](o[n]));return e},e}(),V={placeholder:":placeholder",readonly:":readonly",class:":class",name:"{config.name"},N={focus:":focus",input:"true",blur:"blur"},E=function(e,t){return["div",["input",[{attr:s({type:"{config.type"},V,{value:e[this.config.valuePropName||"value"],checked:e[this.config.valuePropName||"value"]==this.value,disabled:e.disabled?e.disabled:":disabled"}),events:N,overrideProp:0==t}],"label",[{prop:{innerText:e[this.config.textPropName||"text"]}}]]]},j=["div",[{source:!0},{for:{source:E}}]],F={innerText:":props.text"},A={class:":class",style:{display:":hide"}},I=function(e){return["label",[{attr:s({type:"{config.type"},V,{value:e[this.config.valuePropName||"value"]}),events:N}],"label",[{prop:{innerText:e[this.config.textPropName||"text"]}}]]},T=function(e){var t=this;return["option",[{prop:{innerText:e[this.config.textPropName||"text"]},attr:{value:e[this.config.valuePropName||"value"],selected:Array.isArray(this.value)?null!=this.value.filter(function(o){return e[t.config.valuePropName||"value"]==o})[0]:e[this.config.valuePropName||"value"]==this.value,disabled:e.disabled}}]]},S={p:["p",[{prop:F,attr:A}]],h1:["h1",[{prop:F,attr:A}]],h2:["h2",[{prop:F,attr:A}]],h3:["h3",[{prop:F,attr:A}]],h4:["h4",[{prop:F,attr:A}]],h5:["h5",[{prop:F,attr:A}]],h6:["h6",[{prop:F,attr:A}]],a:["a",[{attr:s({href:"{config.href"},A),prop:F}]],hr:["hr",[{attr:V}]],strong:["strong",[{prop:F,attr:A}]],span:["span",[{prop:F,attr:A}]],img:["img",[{prop:{src:":img"},attr:s({style:{display:":img"}},A)}]],label:["label",[{prop:{innerText:":label"},attr:s({style:{display:":label"}},A)}]],small:["small",[{prop:{innerText:":description"},attr:s({style:{display:":description"}},A)}]],input:["input",[{attr:s({type:"{config.type"},V,{disabled:":disabled"}),events:N}]],error:["span",[{prop:{innerText:":errorMessage"},attr:s({style:{display:":errorMessage"}},V)}]],div:["div",[{attr:A}]],card:["div",[{attr:A}]],"card-header":["div",[{attr:A,prop:F}]],"card-body":["div",[{attr:A}]],buttonGroup:["div",[{for:{source:I}}]],"prepend-left":["div",["div",["div",[{prop:{innerText:"{config.ui.prependText.left"}}]],"[input-text]"]],"prepend-right":["div",["[input-text]","div",["div",[{prop:{innerText:"{config.ui.prependText.right"}}]]]],"prepend-both":["div",["div",["div",[{prop:{innerText:"{config.ui.prependText.left"}}]],"[input-text]","div",["div",[{prop:{innerText:"{config.ui.prependText.right"}}]]]],textarea:["textarea",[{attr:s({rows:"{config.ui.rows",cols:"{config.ui.cols"},V),events:N}]],radio:j,checkbox:j,select:["select",[{attr:{multiple:"{config.multiselect"},events:N,source:!0},"option",[{prop:{innerText:":placeholder"},attr:{value:"",style:{display:":placeholder"}}}],{for:{source:T}}]],button:["button",[{attr:s({},V,{name:"{config.name",type:"{config.type"}),events:{click:"{config.events.click"},prop:{innerText:":props.text"}}]],alert:["div",[{attr:V}]],viewMode:{basic:["div",[{attr:{style:{display:":hide"}}},"[label]","[control]","[error]","[small]"]],horizontal:["div",[{attr:{style:{display:":hide"}}},"[label]","div",["[control]","[error]","[small]"]]],inline:[],advance:["div",["div",[{attr:{style:{display:":hide"}}},"[img]","[label]","[control]","[error]","[small]"]]]}},D={defaultControl:"form-control",fileControl:"form-control-file",readOnlyPlainText:"form-control-plaintext",rangeControl:"form-control-range",checkBoxAndRadioControl:"form-check-input",checkboxAndRadioControlInline:"form-check-inline",controlValid:"is-valid",controlInvalid:"is-invalid",validMessage:"valid-feedback",invalidMessage:"invalid-feedback"},_={class:["input-group-prepend"],child:{0:{class:["input-group-text"]}}},B=["input-group"],G={elementClassPath:{"prepend-left":{class:B,child:{0:_}},"prepend-right":{class:B,child:{1:_}},"prepend-both":{class:B,child:{0:_,2:_}},input:{class:[function(){var e="";if(!this.readonly||this.readonly&&!this.isPlainTextMode)switch(this.config.type){case d:e=D.fileControl;break;case h:e=D.rangeControl;break;case v:case g:e=m;break;default:e=D.defaultControl}else this.readonly&&this.isPlainTextMode&&(e=D.readOnlyPlainText);return e},z],listenerProps:[":errorMessage"]},checkbox:{class:[],child:{0:{class:["form-check",L],child:{0:{class:["form-check-input"]},1:{class:["form-check-label"]}}}}},radio:{class:[],child:{0:{class:["form-check",L],child:{0:{class:["form-check-input"]},1:{class:["form-check-label"]}}}}},error:{class:[function(){return(this.formControl.validator||this.formControl.asyncValidator)&&this.formControl.errorMessage?D.invalidMessage:""}],listenerProps:[":errorMessage"]},button:{class:["btn"]},alert:{class:["alert"]},card:{class:["card"]},"card-header":{class:["card-header"]},"card-body":{class:["card-body"]},viewMode:{basic:{class:["form-group"]},horizontal:{class:["form-group","row"],child:{0:{class:[function(){return this.config.ui&&this.config.ui.viewMode&&this.config.ui.viewMode.horizontal&&this.config.ui.viewMode.horizontal.label?this.config.ui.viewMode.horizontal.label:""}]},1:{class:[function(){return this.config.ui&&this.config.ui.viewMode&&this.config.ui.viewMode.horizontal&&this.config.ui.viewMode.horizontal.div?this.config.ui.viewMode.horizontal.div:""}]}}},inline:{class:[],child:{}},advance:{class:["form-row",function(){return this.config&&this.config.ui&&this.config.ui.viewMode&&this.config.ui.viewMode.advance&&this.config.ui.viewMode.advance.root_div?this.config.ui.viewMode.advance.root_div:""}],child:{0:{class:["form-group",function(){return this.config&&this.config.ui&&this.config.ui.viewMode&&this.config.ui.viewMode.advance&&this.config.ui.viewMode.advance.div?this.config.ui.viewMode.advance.div:""}],child:{0:{class:[function(){return this.config&&this.config.ui&&this.config.ui.viewMode&&this.config.ui.viewMode.advance&&this.config.ui.viewMode.advance.label?this.config.ui.viewMode.advance.label:""}]},2:{class:[function(){return this.config&&this.config.ui&&this.config.ui.viewMode&&this.config.ui.viewMode.advance&&this.config.ui.viewMode.advance.error?this.config.ui.viewMode.advance.error:""}]},3:{class:[function(){return this.config.ui&&this.config.ui.viewMode&&this.config.ui.viewMode.advance&&this.config.ui.viewMode.advance.small?this.config.ui.viewMode.advance.small:""}]}}}}}},small:{class:["form-text"]},textarea:{class:[D.defaultControl,z],listenerProps:[":errorMessage"]},select:{class:[D.defaultControl,z],listenerProps:[":errorMessage"]}}};function L(){return this.config&&this.config.inline?["form-check-inline"]:[]}function z(){return(this.formControl.validator||this.formControl.asyncValidator)&&this.formControl.errorMessage?D.controlInvalid:""}function q(e,t){var o,n,r=void 0,i=e.split(".");try{for(var s=l(i),c=s.next();!c.done;c=s.next()){var a=c.value;if(r||(r=t),!r)break;r=r[a]}}catch(e){o={error:e}}finally{try{c&&!c.done&&(n=s.return)&&n.call(s)}finally{if(o)throw o.error}}return r}var W=function(){function e(e){this.dynamicNodeConfig=e,this.subscribeProps={names:[],props:{}},this.controlConfig=this.dynamicNodeConfig.controlConfig}return e.prototype.getPropName=function(e){return":"==e[0]||"{"==e[0]?e.replace(new RegExp(":","g"),m).replace(new RegExp("{","g"),m):e},e.prototype.getValue=function(e){return"string"!=typeof e||":"!=e[0]&&"{"!=e[0]?e:q(e=e.replace(new RegExp(":","g"),m).replace(new RegExp("{","g"),m),this.controlConfig)},e.prototype.setPropSubscription=function(e,t,o,n,r){void 0===n&&(n=""),void 0===r&&(r=""),e.startsWith(":props.")&&this.defineProp(e);var i=this.getPropName(e);this.subscribeProps.props[i]||(this.subscribeProps.props[i]={}),this.subscribeProps.props[i][t]||(this.subscribeProps.props[i][t]={}),r?(this.subscribeProps.props[i][t][r]={},this.subscribeProps.props[i][t][r][o]=n||e):this.subscribeProps.props[i][t][o]=n||e,-1==this.subscribeProps.names.indexOf(i)&&this.subscribeProps.names.push(i)},e.prototype.isSubscribeProp=function(e){return"string"==typeof e&&":"==e[0]},e.prototype.defineProp=function(e){var t=e.split(".");t.length>1&&(Object.getOwnPropertyDescriptor(Object.getPrototypeOf(this.controlConfig.props),t[1])||this.controlConfig.defineProp(t[1]))},e}(),Y=function(){function e(e,t,o,n,r){this.formControlConfig=n,this.dynamicFormBuildConfig=r,this.component=e,this.viewContainerRef=t,this.componentFactoryResolver=o}return e.prototype.create=function(){var e=this.componentFactoryResolver.resolveComponentFactory(this.component);this.componentRef=this.viewContainerRef.createComponent(e,this.viewContainerRef.length,this.viewContainerRef.parentInjector),this.setParams(this.componentRef.instance)},e.prototype.setParams=function(e){var t,o;if(this.formControlConfig.inputs){var n=Object.getOwnPropertyNames(this.formControlConfig.inputs);try{for(var r=l(n),i=r.next();!i.done;i=r.next()){var s=i.value;this.overridePropAndSetValue(e,s,this.formControlConfig.inputs)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(o=r.return)&&o.call(r)}finally{if(t)throw t.error}}}e.controlConfig=this.formControlConfig,e.dynamicFormBuildConfig=this.dynamicFormBuildConfig},e.prototype.overridePropAndSetValue=function(e,t,o){var n=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(o),t),r="";n||(r=o[t],delete o[t]),Object.defineProperty(o,t,{get:function(){return n?n.get():r},set:function(i){e[t]=i,n?n.set.call(o,i):r=i}}),e[t]=n?n.get.call(o):r},e.prototype.rootNode=function(){return this.componentRef.hostView.rootNodes[0]},e.prototype.getComponentRef=function(){return this.componentRef},e.prototype.destroy=function(){this.componentRef&&(this.componentRef.destroy(),this.componentRef=void 0)},e}(),H=function(e){function t(t){var o=e.call(this,t)||this;return o.oldAdditionalClasses=[],o.oldClasses=[],o}return i(t,e),t.prototype.bindAttribute=function(e,t){var o=this;Object.keys(e).forEach(function(n){var r="style"!==n?o.getValue(e[n]):e[n];switch(n){case"additional-class":case"class":o.setClass(r,n);break;case"style":Object.keys(e[n]).forEach(function(r){var i=o.getValue(e[n][r]);o.setStyleProp(r,i),t&&o.isSubscribeProp(e[n][r])&&o.setPropSubscription(e[n][r],"attr",r,"","style")});break;default:o.addOrRemoveAttribute(n,r,""===e[n])}t&&"style"!==n&&o.isSubscribeProp(e[n])&&o.setPropSubscription(e[n],"attr",n)})},t.prototype.bindProp=function(e,t){var o=this;Object.keys(e).forEach(function(n){var r=o.getValue(e[n]);o.setProperty(n,null!=r&&!1!==r?r:""),t&&o.isSubscribeProp(e[n])&&o.setPropSubscription(e[n],"prop",n)})},t.prototype.setClass=function(e,t){switch(e=this.getClassNames("additional-class"==t?this.dynamicNodeConfig.additionalClasses.class:e),"additional-class"==t?this.addOrRemoveClasses(this.oldAdditionalClasses,!1):this.addOrRemoveClasses(this.oldClasses,!1),this.addOrRemoveClasses(e),t){case"additional-class":this.oldAdditionalClasses=e;break;case"class":this.oldClasses=e}},t.prototype.setStyleProp=function(e,t){switch(e){case"display":t=(t="boolean"==typeof t||void 0===t?t:!t)?"none":m}this.addOrRemoveStyle(e,t)},t.prototype.setProperty=function(e,t){this.dynamicNodeConfig.renderer.setProperty(this.element,e,t)},t.prototype.addOrRemoveClasses=function(e,t){var o=this;void 0===t&&(t=!0),t?e.forEach(function(e){return o.dynamicNodeConfig.renderer.addClass(o.element,e)}):e.forEach(function(e){return o.dynamicNodeConfig.renderer.removeClass(o.element,e)})},t.prototype.addOrRemoveStyle=function(e,t){t?this.dynamicNodeConfig.renderer.setStyle(this.element,e,t):this.dynamicNodeConfig.renderer.removeStyle(this.element,e)},t.prototype.addOrRemoveAttribute=function(e,t,o){t||o?this.dynamicNodeConfig.renderer.setAttribute(this.element,e,t):this.dynamicNodeConfig.renderer.removeAttribute(this.element,e)},t.prototype.getClassNames=function(e){var t=this,o=[];return e&&e.forEach(function(e){if("string"==typeof e)o.push(e);else if("function"==typeof e){var n=e.call(t.controlConfig);n&&!Array.isArray(n)?o.push(n):Array.isArray(n)&&n.forEach(function(e){return o.push(e)})}}),o},t}(function(e){function t(t){var o=e.call(this,t)||this;return o.dynamicNodeConfig=t,o}return i(t,e),t.prototype.bindEvents=function(e,t){var o=this;Object.keys(e).forEach(function(n){switch(n){case"focus":o.setFocus(o.getValue(e[n]));break;case"select":case y:o.setInput();break;case"blur":o.setBlur();break;case"click":o.setClick(o.getValue(e[n]))}t&&o.isSubscribeProp(e[n])&&o.setPropSubscription(o.getPropName(e[n]),"events",n)})},t.prototype.setClick=function(e){var t=this;this.element.onclick=function(){t.controlConfig[e]&&t.controlConfig[e].call(t.controlConfig)}},t.prototype.setFocus=function(e){var t=this;e&&this.element.focus&&setTimeout(function(e){t.element.focus()},1e3)},t.prototype.setBlur=function(){var e=this,t=this.dynamicNodeConfig.renderer.listen(this.element,"blur",function(){e.dynamicNodeConfig.controlConfig.formControl.markAsTouched()});this.eventListeners.push(t)},t.prototype.setInput=function(){var e=this,t=this.dynamicNodeConfig.renderer.listen(this.element,y,function(t){var o=!0;e.controlConfig.hooks&&e.controlConfig.hooks.preValue&&((o=e.controlConfig.hooks.preValue.call(e.controlConfig,t.target.value))||(e.controlConfig.formControl.patchValue(e.controlConfig.formControl.value),e.resetElementValue(e.controlConfig.formControl.value))),o&&(e.setControlConfigValue(t.target),e.controlConfig.hooks&&e.controlConfig.hooks.postValue&&e.controlConfig.hooks.postValue.call(e.controlConfig),e.controlConfig.formControl.markAsDirty()),e.conditionalValidator&&e.conditionalValidator(e.controlConfig.formControl)});this.eventListeners.push(t),setTimeout(function(){e.controlConfig.formControl.conditionalValidator&&(e.conditionalValidator=e.controlConfig.formControl.conditionalValidator,delete e.controlConfig.formControl.conditionalValidator)},50)},t}(function(e){function t(t){var o=e.call(this,t)||this;return o.checkedCheckbox=function(e,t){return!!e&&(o.controlConfig.config.multiselect?null!=e.filter(function(e){return t.value==e})[0]:t.value==e)},o.checkedRadio=function(e,t){return!!e&&e==t.value},o}return i(t,e),t.prototype.createNodeElement=function(e,t){this.element=t.startsWith("#")?this.createComponentView(this.dynamicNodeConfig.controlConfig):this.dynamicNodeConfig.renderer.createElement(t),this.dynamicNodeConfig.renderer.appendChild(e,this.element)},t.prototype.createComponentView=function(e){var t=x.getComponent(e.config.type.replace("#",""));if(t)return this.componentView=new Y(t.instance,this.dynamicNodeConfig.viewContainerRef,this.dynamicNodeConfig.componentFactoryResolver,e,this.dynamicNodeConfig.dynamicFormBuildConfig),this.componentView.create(),this.componentView.rootNode()},t.prototype.removeChildren=function(e){e.firstElementChild&&this.removeChildren(e.firstElementChild);var t=e.getAttribute("data-rxwebid");t&&b.controls[t]&&(b.controls[t].destroy(),delete b.controls[t])},t.prototype.setControlConfigValue=function(e){var t,o,n=""===e.value?null:e.value;switch(e.type){case d:this.controlConfig.formControl.setValue(e.files),this.controlConfig.value=e.files;break;case g:this.setCheckboxValue(e);break;case"select-multiple":var r=[];try{for(var i=l(this.element.options),s=i.next();!s.done;s=i.next()){var c=s.value;c.selected&&c.value&&r.push(c.value)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(o=i.return)&&o.call(i)}finally{if(t)throw t.error}}this.controlConfig.value=r;break;default:this.controlConfig.formControl.setValue(n),this.controlConfig.value=n}},t.prototype.resetElementValue=function(e){var t,o;switch(this.element.type){case g:case v:for(var n=document.querySelectorAll("[name='"+this.controlConfig.config.name+"']"),r=0;r<n.length;r++)n[r].checked=this.element.type==g?this.checkedCheckbox(e,n[r]):this.checkedRadio(e,n[r]);break;case"select-multiple":var i=function(t){t.selected=!!e&&null!=e.filter(function(e){return e==t.value})[0]};try{for(var s=l(this.element.options),c=s.next();!c.done;c=s.next()){i(c.value)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(t)throw t.error}}break;default:this.element.value=e}},t.prototype.setCheckboxValue=function(e){var t=this.controlConfig.config.multiselect?this.controlConfig.value||[]:e.value;e.checked?this.controlConfig.config.multiselect&&t.push(e.value):this.controlConfig.config.multiselect?t.splice(t.indexOf(e.value),1):t=null,this.controlConfig.formControl.setValue(t),this.controlConfig.value=t},t}(W))),J=function(e){function t(t,o,n){var r=e.call(this,n)||this;return r.isComponentView=!1,r.subscribers=[],r.elementIndex=0,r.eventListeners=[],r.actionListeners={},r.elementClasses=[],r.nodeName=o,e.prototype.createNodeElement.call(r,t,o),r.bindAdditionalClasses(),r.controlId=b.controlId=b.controlId+1,b.controls[r.controlId]=r,r.addOrRemoveAttribute("data-rxwebid",r.controlId,!1),r}return i(t,e),t.prototype.parseObject=function(e,t){this.domConfig=e,this.process(e,t),this.overrideProp(t),this.subscribeValueChange()},t.prototype.subscribeValueChange=function(){var e=this;Object.keys(this.subscribeProps).length>0&&this.controlConfig.onPropValueChanged(this.controlId,this.subscribeProps,function(t,o){e.process(t,!1)})},t.prototype.process=function(e,t){var o=this;Object.keys(e).forEach(function(n){switch(n){case"prop":o.bindProp(e[n],t);break;case"attr":o.bindAttribute(e[n],t);break;case"events":o.bindEvents(e[n],t);break;case"source":if(t)o.setPropSubscription("source","source","source");else{for(;o.element.firstElementChild;)o.removeChildren(o.element.firstElementChild);o.dynamicNodeConfig.controlConfigProcessor.createChildrens(o.dynamicNodeConfig.collections,o,o.controlConfig,o.dynamicNodeConfig.additionalClasses,!1)}}})},t.prototype.overrideProp=function(e){switch(this.nodeName){case y:case"select":case"textarea":(null==this.domConfig.overrideProp||this.domConfig.overrideProp)&&this.overrideValueProp(),this.setPropSubscription("readonly","attr","additional-class","additional-class"),this.controlConfig&&this.controlConfig.config&&this.controlConfig.config.additionalConfig&&this.process(this.controlConfig.config.additionalConfig,e)}},t.prototype.bindAdditionalClasses=function(){var e=this,t=this.dynamicNodeConfig.additionalClasses;t&&t.class&&(this.setClass(t.class,"additional-class"),t.listenerProps&&t.listenerProps.forEach(function(t){return e.setPropSubscription(t,"attr","additional-class","additional-class")}))},t.prototype.destroy=function(){for(var e=this.eventListeners.length,t=0;t<e;t++)this.eventListeners[0](),this.eventListeners.splice(0,1);this.eventListeners=[],this.element.onClick=null,this.componentView?this.componentView.destroy():this.element.parentElement.removeChild(this.element),this.controlConfig.destroy(this.controlId)},t}(function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.overrideValueProp=function(){var e=this,t=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(this.controlConfig),"value"),o=this.controlConfig.value,n=null;Object.defineProperty(this.controlConfig,"value",{get:function(){return t?t.get.call(e.controlConfig):o},set:function(r){o=r,e.controlConfig.formControl.value!=r?(e.controlConfig.formControl.setValue(r),e.resetElementValue(r),e.controlConfig.value=r):(e.controlConfig.notifyValueChanged("value",r,n),t&&t.set.call(e.controlConfig,r),e.controlConfig.refresh()),e.controlConfig.config.value=r,n=r}}),this.overrideFormControlProp(),this.controlConfig.formControl.value&&setTimeout(function(){e.resetElementValue(e.controlConfig.formControl.value)},50)},t.prototype.overrideFormControlProp=function(){var e=this,t=this.controlConfig.formControl.value;Object.defineProperty(this.controlConfig.formControl,"value",{get:function(){return t},set:function(o){t=o;setTimeout(function(){t!=e.controlConfig.value&&(e.controlConfig.value=t,e.resetElementValue(t))},50)}})},t}(H)),K=function(){function e(e,t,o,n){this.element=e,this.renderer=t,this.componentFactoryResolver=o,this.viewContainerRef=n,this.isBuild=!1}return Object.defineProperty(e.prototype,"viewMode",{get:function(){return this._viewMode},set:function(e){this._viewMode=e,this.isBuild&&this.build()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentViewMode",{get:function(){return S.viewMode[this.viewMode]},enumerable:!0,configurable:!0}),e.prototype.getView=function(e,t){return"inline"==this.viewMode&&(e=this.getName(e,t,!0)),S[e]},Object.defineProperty(e.prototype,"viewClassPath",{get:function(){return G.elementClassPath.viewMode[this.viewMode]},enumerable:!0,configurable:!0}),e.prototype.build=function(){var e=this;this.uiBindings.forEach(function(t){e.designForm(t,e.element,e.currentViewMode[0],e.currentViewMode[1],G.elementClassPath.viewMode[e.viewMode])})},e.prototype.designForm=function(e,t,o,n,r,i){var s=this,c=i||this.getControlConfig(e);if(c)if("inline"!=this.viewMode&&c&&!c.config.skipDefaultView)this.createElement(o,n,t,c,r);else{var a=this.getView(c.config.type,c);a?this.createElement(a[0],a[1],t,c,this.getClassPath(c.config.type,c,"inline"==this._viewMode)):this.createDomManipulation(c.config.type,[],t,c,[],!0)}else if("advance"==this.viewMode&&Array.isArray(e)){var l=new M({},{}),f=this.createElement(this.currentViewMode[0],[],t,l,G.elementClassPath.viewMode[this.viewMode]);e.forEach(function(e){s.designForm(e,f.element,s.currentViewMode[1][0],s.currentViewMode[1][1],G.elementClassPath.viewMode[s.viewMode].child[0])})}},e.prototype.createElement=function(e,t,o,n,r){var i=this;if(!e.startsWith("#")){r=r||{};var c=this.createDomManipulation(e,t,o,n,r);return this.createChildrens(t,c,n,r),n.config&&n.config.childrens&&n.config.childrens.length>0&&n.config.childrens.forEach(function(e,t){var o=void 0;"string"==typeof e||Array.isArray(e)||(o=new M(s({},e,{skipDefaultView:!0}),{})),i.designForm(e,c.element,i.currentViewMode[0],i.currentViewMode[1],G.elementClassPath.viewMode[i.viewMode],o)}),c}this.createDomManipulation(e,t,o,n,r,!0)},e.prototype.createDomManipulation=function(e,t,o,n,r,i){void 0===i&&(i=!1);var s={controlConfig:n,additionalClasses:r,renderer:this.renderer,collections:t,controlConfigProcessor:this,viewContainerRef:i?this.viewContainerRef:void 0,componentFactoryResolver:i?this.componentFactoryResolver:void 0,dynamicFormBuildConfig:this.dynamicFormBuildConfig};return new J(o,e,s)},e.prototype.createChildrens=function(e,t,o,n,r){var i=this;void 0===r&&(r=!0);for(var s=0,c=n.child?n.child:{},a=0;a<e.length;a++){var l=e[a];if(k.isObject(l))l.for&&this.runForCollection(l,t,o,n),r&&t.parseObject(e[a],r);else{if(this.isCreateElement(e[a],o))if("[control]"==l&&null==o.config.type&&o.config.childControlConfigs)o.config.childControlConfigs.forEach(function(o){var n=i.getControlConfig(o);i.createChildNodes(e,n,c,s,a,t)});else if("[control]"==l&&o.config.type.startsWith("#"))this.createDomManipulation(o.config.type,[],t.element,o,[],!0);else this.createChildNodes(e,o,c,s,a,t)&&(a+=1);s++}}},e.prototype.createChildNodes=function(e,t,o,n,r,i){var s=!1,c=this.getCollection(e[r],t),a=this.getAdditionalClasses(e[r],o,n,t);return c||(c=[e[r],e[r+1]],s=!0),this.createElement(c[0],c[1],i.element,t,a),s},e.prototype.runForCollection=function(e,t,o,n){var r=this;Object.keys(e.for).forEach(function(i){q(i,o).forEach(function(s,c){var a=e.for[i].call(o,s,c);r.createChildrens(a,t,o,n)})})},e.prototype.getAdditionalClasses=function(e,t,o,n){e=this.getName(e,n);var r=G.elementClassPath[e],i=t[o]?t[o]:{class:[]};return r?(i.class&&(r={class:r.class.concat(i.class),listenerProps:r.listenerProps,child:r.child}),r):i},e.prototype.getCollection=function(e,t){if("["==e[0])return e=this.getName(e,t),S[e]},e.prototype.getControlName=function(e){var t="";switch(e){case"number":case"color":case"date":case"email":case"password":case"tel":case"time":case"url":case"color":case h:case d:case"text":t=y;break;default:t=e}return t},e.prototype.getControlConfig=function(e){return this.dynamicFormBuildConfig.controlsConfig[e]},e.prototype.getName=function(e,t,o){switch(void 0===o&&(o=!1),e="control"==(e=e.replace(new RegExp(/\[/g),"").replace(new RegExp(/\]/g),""))||o?this.getControlName(t.config.type):e){case y:e=this.prependControl(e,t);break;case"input-text":e=y}return e},e.prototype.prependControl=function(e,t){return t.config.ui&&t.config.ui.prependText&&t.config.ui.prependText.right&&t.config.ui.prependText.left?e="prepend-both":e==y&&t.config.ui&&t.config.ui.prependText&&t.config.ui.prependText.left?e="prepend-left":e==y&&t.config.ui&&t.config.ui.prependText&&t.config.ui.prependText.right&&(e="prepend-right"),e},e.prototype.isCreateElement=function(e,t){var o=!0;switch(e){case"[img]":o=null!=t.img;case"[label]":o=null!=t.label;break;case"[small]":o=null!=t.description;break;case"[error]":o=null!=t.formControl&&(null!=t.formControl.validator||null!=t.formControl.asyncValidator)}return o},e.prototype.getClassPath=function(e,t,o){return"inline"==this.viewMode&&(e=this.getName(e,t,o)),G.elementClassPath[e]},c([o.Input("rxwebDynamicForm"),a("design:type",Object)],e.prototype,"dynamicFormBuildConfig",void 0),c([o.Input(),a("design:type",String),a("design:paramtypes",[String])],e.prototype,"viewMode",null),c([o.Input(),a("design:type",Array)],e.prototype,"uiBindings",void 0),e}(),Q=function(e){function t(t,o,n,r){return e.call(this,t.nativeElement,o,n,r)||this}return i(t,e),t.prototype.ngOnInit=function(){this.build()},t.prototype.removeChildren=function(e){for(;e.firstElementChild;)this.removeChildren(e.firstElementChild);var t=e.getAttribute("data-rxwebid");t&&b.controls[t]&&(b.controls[t].destroy(),delete b.controls[t])},t.prototype.ngOnDestroy=function(){this.element&&this.removeChildren(this.element)},t=c([o.Directive({selector:"[rxwebDynamicForm]"}),a("design:paramtypes",[o.ElementRef,o.Renderer2,o.ComponentFactoryResolver,o.ViewContainerRef])],t)}(K),U=function(){function e(){}var t;return t=e,e.forRoot=function(){return{ngModule:t,providers:[]}},e=t=c([o.NgModule({declarations:[Q],imports:[n.CommonModule],providers:[R],exports:[Q]})],e)}();var X=function(){function e(){}return Object.defineProperty(e.prototype,"controlConfig",{get:function(){return this._controlConfig},set:function(e){this._controlConfig=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dynamicFormBuildConfig",{get:function(){return this._dynamicFormBuildConfig},set:function(e){this._dynamicFormBuildConfig=e},enumerable:!0,configurable:!0}),e.prototype.addItem=function(){this.dynamicFormBuildConfig.controlsConfig[this.controlConfig.config.controlConfigName].addItem()},e.prototype.removeItem=function(e){this.dynamicFormBuildConfig.controlsConfig[this.controlConfig.config.controlConfigName].removeItem(e)},c([o.Input(),a("design:type",O),a("design:paramtypes",[O])],e.prototype,"controlConfig",null),c([o.Input(),a("design:type",Object),a("design:paramtypes",[Object])],e.prototype,"dynamicFormBuildConfig",null),e}();e.AbstractControlConfig=X,e.BOOSTRAP_CLASS_CONFIG=D,e.BOOTSTRAP_DESIGN_CONFIG=G,e.ControlConfig=M,e.DYNAMIC_ELEMENT_DESIGN_TREE=S,e.FormControlConfig=O,e.RxDynamicFormBuilder=R,e.RxReactiveDynamicFormsModule=U,e.dynamicComponent=function(e){return function(t){x.registerComponent(e,t)}},e.overrideProps=function(e){return function(t){x.registerOverrideProp(e)}},e.ɵ0=E,e.ɵ1=I,e.ɵ2=T,e.ɵa=Q,e.ɵb=K,e.ɵc=P,e.ɵd=p,e.ɵe=u,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=rxweb-reactive-dynamic-forms.umd.min.js.map