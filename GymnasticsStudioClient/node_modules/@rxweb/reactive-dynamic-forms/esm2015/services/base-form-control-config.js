import { PropDescriptor } from './prop-descriptor';
import { FILTER, SOURCE } from '../const/app.const';
import { Linq } from '../util/linq';
import { NotificationState } from '../statics/control-state';
export class BaseFormControlConfig extends PropDescriptor {
    constructor(configs, notificationId) {
        super();
        this.configs = configs;
        this.notificationId = notificationId;
        this._actionResult = {
            label: undefined,
            img: undefined,
            placeholder: undefined,
            source: [],
            filter: [],
            hide: false,
            description: undefined,
            disabled: false,
            focus: false,
            readonly: false,
            class: [],
            prependText: ''
        };
    }
    setNotification() {
        if (NotificationState.notifications[this.notificationId])
            if (!NotificationState.notifications[this.notificationId][this.config.name])
                NotificationState.notifications[this.notificationId][this.config.name] =
                    this.controlNotifications = { filter: [], disabled: [], label: [], description: [], hide: [], placeholder: [], readonly: [], focus: [], class: [] };
            else
                this.controlNotifications = NotificationState.notifications[this.notificationId][this.config.name];
        this.complete();
    }
    complete() {
        for (let action in this.controlNotifications) {
            let descriptor = this.getDescriptor(action);
            if ((descriptor && descriptor.get) || this.isDefinedFilter) {
                let stringFunction = this.isDefinedFilter ? String(this[FILTER]) : String(descriptor.get);
                let columnNames = Linq.dynamicConfigParser(stringFunction);
                columnNames.forEach(column => {
                    if (!NotificationState.notifications[this.notificationId][column])
                        NotificationState.notifications[this.notificationId][column] = { filter: [], disabled: [], label: [], description: [], hide: [], placeholder: [], readonly: [], focus: [], class: [] };
                    let controlNotifications = NotificationState.notifications[this.notificationId][column];
                    controlNotifications[action].push(this.config.name);
                });
            }
        }
        this.overrideProps();
        this.updateActionValue();
    }
    refresh(actionName) {
        for (var columnName in this.controlNotifications) {
            if (this.controlNotifications[columnName].length > 0)
                this.controlNotifications[columnName].forEach(x => {
                    if (columnName == FILTER)
                        this.configs[x].value = null;
                    if (x != this.config.name)
                        this.configs[x].refresh(columnName);
                    else
                        this.setActionValue(columnName);
                });
        }
        if (actionName)
            this.setActionValue(actionName);
    }
    setActionValue(actionName) {
        if (actionName == FILTER && this.isDefinedFilter) {
            this[FILTER].call(this);
        }
        else
            this[actionName == FILTER ? SOURCE : actionName] = this[actionName];
    }
    updateActionValue() {
        ["disabled", "label", "img", "placeholder", "hide", "description", "focus", "readonly", "class", "filter", "source"].forEach(key => {
            switch (key) {
                case FILTER:
                    if (this.isDefinedFilter && key == FILTER)
                        this[FILTER]();
                    if (this.config.filter)
                        this[FILTER] = this.config.filter;
                    break;
                case SOURCE:
                    if (this.config[key])
                        this[key] = this.config[key];
                    if (key == SOURCE && !this.source)
                        this[key] = [];
                    break;
                default:
                    if (this.config.ui && this.config.ui[key])
                        this[key] = this.config.ui[key];
                    else
                        this[key == FILTER ? SOURCE : key] = this._actionResult[key];
                    break;
            }
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS1mb3JtLWNvbnRyb2wtY29uZmlnLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHJ4d2ViL3JlYWN0aXZlLWR5bmFtaWMtZm9ybXMvIiwic291cmNlcyI6WyJzZXJ2aWNlcy9iYXNlLWZvcm0tY29udHJvbC1jb25maWcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLG1CQUFtQixDQUFBO0FBQ2xELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sb0JBQW9CLENBQUE7QUFFbkQsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLGNBQWMsQ0FBQTtBQUNuQyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUM3RCxNQUFNLE9BQWdCLHFCQUFzQixTQUFRLGNBQWM7SUFJOUQsWUFBb0IsT0FBK0IsRUFBVSxjQUFzQjtRQUMvRSxLQUFLLEVBQUUsQ0FBQztRQURRLFlBQU8sR0FBUCxPQUFPLENBQXdCO1FBQVUsbUJBQWMsR0FBZCxjQUFjLENBQVE7UUF1RjNFLGtCQUFhLEdBQWlCO1lBQ2xDLEtBQUssRUFBRSxTQUFTO1lBQ2hCLEdBQUcsRUFBRSxTQUFTO1lBQ2QsV0FBVyxFQUFFLFNBQVM7WUFDdEIsTUFBTSxFQUFFLEVBQUU7WUFDVixNQUFNLEVBQUUsRUFBRTtZQUNWLElBQUksRUFBRSxLQUFLO1lBQ1gsV0FBVyxFQUFFLFNBQVM7WUFDdEIsUUFBUSxFQUFFLEtBQUs7WUFDZixLQUFLLEVBQUUsS0FBSztZQUNaLFFBQVEsRUFBRSxLQUFLO1lBQ2YsS0FBSyxFQUFFLEVBQUU7WUFDVCxXQUFXLEVBQUUsRUFBRTtTQUNsQixDQUFDO0lBakdGLENBQUM7SUFFRCxlQUFlO1FBQ1gsSUFBSSxpQkFBaUIsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQztZQUNwRCxJQUFJLENBQUMsaUJBQWlCLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQztnQkFDdkUsaUJBQWlCLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQztvQkFDbEUsSUFBSSxDQUFDLG9CQUFvQixHQUFHLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsV0FBVyxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLFdBQVcsRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsQ0FBQTs7Z0JBRXZKLElBQUksQ0FBQyxvQkFBb0IsR0FBRyxpQkFBaUIsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDM0csSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQ3BCLENBQUM7SUFJRCxRQUFRO1FBQ0osS0FBSyxJQUFJLE1BQU0sSUFBSSxJQUFJLENBQUMsb0JBQW9CLEVBQUU7WUFDMUMsSUFBSSxVQUFVLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUM1QyxJQUFJLENBQUMsVUFBVSxJQUFJLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJLENBQUMsZUFBZSxFQUFFO2dCQUN4RCxJQUFJLGNBQWMsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQzFGLElBQUksV0FBVyxHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxjQUFjLENBQUMsQ0FBQztnQkFDM0QsV0FBVyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRTtvQkFDekIsSUFBSSxDQUFDLGlCQUFpQixDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUMsTUFBTSxDQUFDO3dCQUM3RCxpQkFBaUIsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsV0FBVyxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLFdBQVcsRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsQ0FBQTtvQkFDMUwsSUFBSSxvQkFBb0IsR0FBRyxpQkFBaUIsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDO29CQUN4RixvQkFBb0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQTtnQkFDdkQsQ0FBQyxDQUFDLENBQUE7YUFDTDtTQUNKO1FBQ0QsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO0lBQzdCLENBQUM7SUFFRCxPQUFPLENBQUMsVUFBbUI7UUFDdkIsS0FBSyxJQUFJLFVBQVUsSUFBSSxJQUFJLENBQUMsb0JBQW9CLEVBQUU7WUFDOUMsSUFBSSxJQUFJLENBQUMsb0JBQW9CLENBQUMsVUFBVSxDQUFDLENBQUMsTUFBTSxHQUFHLENBQUM7Z0JBQ2hELElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxVQUFVLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUU7b0JBQzlDLElBQUksVUFBVSxJQUFJLE1BQU07d0JBQ3BCLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztvQkFDakMsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJO3dCQUNyQixJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQzs7d0JBRXBDLElBQUksQ0FBQyxjQUFjLENBQUMsVUFBVSxDQUFDLENBQUM7Z0JBQ3hDLENBQUMsQ0FBQyxDQUFBO1NBQ1Q7UUFDRCxJQUFJLFVBQVU7WUFDVixJQUFJLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3hDLENBQUM7SUFHTyxjQUFjLENBQUMsVUFBa0I7UUFDckMsSUFBSSxVQUFVLElBQUksTUFBTSxJQUFJLElBQUksQ0FBQyxlQUFlLEVBQUU7WUFDOUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUMzQjs7WUFDRyxJQUFJLENBQUMsVUFBVSxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDNUUsQ0FBQztJQUVPLGlCQUFpQjtRQUNyQixDQUFDLFVBQVUsRUFBRSxPQUFPLEVBQUMsS0FBSyxFQUFFLGFBQWEsRUFBRSxNQUFNLEVBQUUsYUFBYSxFQUFFLE9BQU8sRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDOUgsUUFBUSxHQUFHLEVBQUU7Z0JBQ1QsS0FBSyxNQUFNO29CQUNQLElBQUksSUFBSSxDQUFDLGVBQWUsSUFBSSxHQUFHLElBQUksTUFBTTt3QkFDckMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUM7b0JBQ25CLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNO3dCQUNsQixJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUM7b0JBQ3RDLE1BQU07Z0JBQ1YsS0FBSyxNQUFNO29CQUNQLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUM7d0JBQ2hCLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO29CQUNqQyxJQUFJLEdBQUcsSUFBSSxNQUFNLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTTt3QkFDN0IsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztvQkFDbkIsTUFBTTtnQkFDVjtvQkFDSSxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQzt3QkFDckMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDOzt3QkFFaEMsSUFBSSxDQUFDLEdBQUcsSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQztvQkFDakUsTUFBTTthQUViO1FBRUwsQ0FBQyxDQUFDLENBQUE7SUFDTixDQUFDO0NBK0JKIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHJvcERlc2NyaXB0b3IgfSBmcm9tICcuL3Byb3AtZGVzY3JpcHRvcidcclxuaW1wb3J0IHsgRklMVEVSLCBTT1VSQ0UgfSBmcm9tICcuLi9jb25zdC9hcHAuY29uc3QnXHJcbmltcG9ydCB7IEFjdGlvblJlc3VsdCB9IGZyb20gXCIuLi9tb2RlbHMvaW50ZXJmYWNlL2FjdGlvbi1jb25maWdcIlxyXG5pbXBvcnQgeyBMaW5xIH0gZnJvbSAnLi4vdXRpbC9saW5xJ1xyXG5pbXBvcnQgeyBOb3RpZmljYXRpb25TdGF0ZSB9IGZyb20gJy4uL3N0YXRpY3MvY29udHJvbC1zdGF0ZSc7XHJcbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBCYXNlRm9ybUNvbnRyb2xDb25maWcgZXh0ZW5kcyBQcm9wRGVzY3JpcHRvciB7XHJcbiAgICBjb25maWc6IHsgW2tleTogc3RyaW5nXTogYW55IH07XHJcbiAgICBzb3VyY2U6IGFueVtdO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgY29uZmlnczogeyBba2V5OiBzdHJpbmddOiBhbnkgfSwgcHJpdmF0ZSBub3RpZmljYXRpb25JZDogbnVtYmVyKSB7XHJcbiAgICAgICAgc3VwZXIoKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgc2V0Tm90aWZpY2F0aW9uKCkge1xyXG4gICAgICAgIGlmIChOb3RpZmljYXRpb25TdGF0ZS5ub3RpZmljYXRpb25zW3RoaXMubm90aWZpY2F0aW9uSWRdKVxyXG4gICAgICAgICAgICBpZiAoIU5vdGlmaWNhdGlvblN0YXRlLm5vdGlmaWNhdGlvbnNbdGhpcy5ub3RpZmljYXRpb25JZF1bdGhpcy5jb25maWcubmFtZV0pXHJcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25TdGF0ZS5ub3RpZmljYXRpb25zW3RoaXMubm90aWZpY2F0aW9uSWRdW3RoaXMuY29uZmlnLm5hbWVdID1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xOb3RpZmljYXRpb25zID0geyBmaWx0ZXI6IFtdLCBkaXNhYmxlZDogW10sIGxhYmVsOiBbXSwgZGVzY3JpcHRpb246IFtdLCBoaWRlOiBbXSwgcGxhY2Vob2xkZXI6IFtdLCByZWFkb25seTogW10sIGZvY3VzOiBbXSwgY2xhc3M6IFtdIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgdGhpcy5jb250cm9sTm90aWZpY2F0aW9ucyA9IE5vdGlmaWNhdGlvblN0YXRlLm5vdGlmaWNhdGlvbnNbdGhpcy5ub3RpZmljYXRpb25JZF1bdGhpcy5jb25maWcubmFtZV07XHJcbiAgICAgICAgdGhpcy5jb21wbGV0ZSgpO1xyXG4gICAgfVxyXG5cclxuXHJcblxyXG4gICAgY29tcGxldGUoKSB7XHJcbiAgICAgICAgZm9yIChsZXQgYWN0aW9uIGluIHRoaXMuY29udHJvbE5vdGlmaWNhdGlvbnMpIHtcclxuICAgICAgICAgICAgbGV0IGRlc2NyaXB0b3IgPSB0aGlzLmdldERlc2NyaXB0b3IoYWN0aW9uKTtcclxuICAgICAgICAgICAgaWYgKChkZXNjcmlwdG9yICYmIGRlc2NyaXB0b3IuZ2V0KSB8fCB0aGlzLmlzRGVmaW5lZEZpbHRlcikge1xyXG4gICAgICAgICAgICAgICAgbGV0IHN0cmluZ0Z1bmN0aW9uID0gdGhpcy5pc0RlZmluZWRGaWx0ZXIgPyBTdHJpbmcodGhpc1tGSUxURVJdKSA6IFN0cmluZyhkZXNjcmlwdG9yLmdldCk7XHJcbiAgICAgICAgICAgICAgICBsZXQgY29sdW1uTmFtZXMgPSBMaW5xLmR5bmFtaWNDb25maWdQYXJzZXIoc3RyaW5nRnVuY3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgY29sdW1uTmFtZXMuZm9yRWFjaChjb2x1bW4gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghTm90aWZpY2F0aW9uU3RhdGUubm90aWZpY2F0aW9uc1t0aGlzLm5vdGlmaWNhdGlvbklkXVtjb2x1bW5dKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25TdGF0ZS5ub3RpZmljYXRpb25zW3RoaXMubm90aWZpY2F0aW9uSWRdW2NvbHVtbl0gPSB7IGZpbHRlcjogW10sIGRpc2FibGVkOiBbXSwgbGFiZWw6IFtdLCBkZXNjcmlwdGlvbjogW10sIGhpZGU6IFtdLCBwbGFjZWhvbGRlcjogW10sIHJlYWRvbmx5OiBbXSwgZm9jdXM6IFtdLCBjbGFzczogW10gfVxyXG4gICAgICAgICAgICAgICAgICAgIGxldCBjb250cm9sTm90aWZpY2F0aW9ucyA9IE5vdGlmaWNhdGlvblN0YXRlLm5vdGlmaWNhdGlvbnNbdGhpcy5ub3RpZmljYXRpb25JZF1bY29sdW1uXTtcclxuICAgICAgICAgICAgICAgICAgICBjb250cm9sTm90aWZpY2F0aW9uc1thY3Rpb25dLnB1c2godGhpcy5jb25maWcubmFtZSlcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5vdmVycmlkZVByb3BzKCk7XHJcbiAgICAgICAgdGhpcy51cGRhdGVBY3Rpb25WYWx1ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlZnJlc2goYWN0aW9uTmFtZT86IHN0cmluZykge1xyXG4gICAgICAgIGZvciAodmFyIGNvbHVtbk5hbWUgaW4gdGhpcy5jb250cm9sTm90aWZpY2F0aW9ucykge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jb250cm9sTm90aWZpY2F0aW9uc1tjb2x1bW5OYW1lXS5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5jb250cm9sTm90aWZpY2F0aW9uc1tjb2x1bW5OYW1lXS5mb3JFYWNoKHggPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2x1bW5OYW1lID09IEZJTFRFUilcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25maWdzW3hdLnZhbHVlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoeCAhPSB0aGlzLmNvbmZpZy5uYW1lKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZ3NbeF0ucmVmcmVzaChjb2x1bW5OYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QWN0aW9uVmFsdWUoY29sdW1uTmFtZSk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoYWN0aW9uTmFtZSlcclxuICAgICAgICAgICAgdGhpcy5zZXRBY3Rpb25WYWx1ZShhY3Rpb25OYW1lKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBzZXRBY3Rpb25WYWx1ZShhY3Rpb25OYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICBpZiAoYWN0aW9uTmFtZSA9PSBGSUxURVIgJiYgdGhpcy5pc0RlZmluZWRGaWx0ZXIpIHtcclxuICAgICAgICAgICAgdGhpc1tGSUxURVJdLmNhbGwodGhpcyk7XHJcbiAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgIHRoaXNbYWN0aW9uTmFtZSA9PSBGSUxURVIgPyBTT1VSQ0UgOiBhY3Rpb25OYW1lXSA9IHRoaXNbYWN0aW9uTmFtZV07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB1cGRhdGVBY3Rpb25WYWx1ZSgpIHtcclxuICAgICAgICBbXCJkaXNhYmxlZFwiLCBcImxhYmVsXCIsXCJpbWdcIiwgXCJwbGFjZWhvbGRlclwiLCBcImhpZGVcIiwgXCJkZXNjcmlwdGlvblwiLCBcImZvY3VzXCIsIFwicmVhZG9ubHlcIiwgXCJjbGFzc1wiLCBcImZpbHRlclwiLCBcInNvdXJjZVwiXS5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAoa2V5KSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIEZJTFRFUjpcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0RlZmluZWRGaWx0ZXIgJiYga2V5ID09IEZJTFRFUilcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1tGSUxURVJdKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY29uZmlnLmZpbHRlcilcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1tGSUxURVJdID0gdGhpcy5jb25maWcuZmlsdGVyO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBTT1VSQ0U6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY29uZmlnW2tleV0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNba2V5XSA9IHRoaXMuY29uZmlnW2tleV07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PSBTT1VSQ0UgJiYgIXRoaXMuc291cmNlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzW2tleV0gPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY29uZmlnLnVpICYmIHRoaXMuY29uZmlnLnVpW2tleV0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNba2V5XSA9IHRoaXMuY29uZmlnLnVpW2tleV07XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzW2tleSA9PSBGSUxURVIgPyBTT1VSQ0UgOiBrZXldID0gdGhpcy5fYWN0aW9uUmVzdWx0W2tleV07XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgX2FjdGlvblJlc3VsdDogQWN0aW9uUmVzdWx0ID0ge1xyXG4gICAgICAgIGxhYmVsOiB1bmRlZmluZWQsXHJcbiAgICAgICAgaW1nOiB1bmRlZmluZWQsXHJcbiAgICAgICAgcGxhY2Vob2xkZXI6IHVuZGVmaW5lZCxcclxuICAgICAgICBzb3VyY2U6IFtdLFxyXG4gICAgICAgIGZpbHRlcjogW10sXHJcbiAgICAgICAgaGlkZTogZmFsc2UsXHJcbiAgICAgICAgZGVzY3JpcHRpb246IHVuZGVmaW5lZCxcclxuICAgICAgICBkaXNhYmxlZDogZmFsc2UsXHJcbiAgICAgICAgZm9jdXM6IGZhbHNlLFxyXG4gICAgICAgIHJlYWRvbmx5OiBmYWxzZSxcclxuICAgICAgICBjbGFzczogW10sXHJcbiAgICAgICAgcHJlcGVuZFRleHQ6ICcnXHJcbiAgICB9O1xyXG5cclxuICAgIHByaXZhdGUgY29udHJvbE5vdGlmaWNhdGlvbnM6IHtcclxuICAgICAgICBkaXNhYmxlZD86IHN0cmluZ1tdLFxyXG4gICAgICAgIHBsYWNlaG9sZGVyPzogc3RyaW5nW10sXHJcbiAgICAgICAgZmlsdGVyPzogc3RyaW5nW10sXHJcbiAgICAgICAgaGlkZT86IHN0cmluZ1tdLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uPzogc3RyaW5nW10sXHJcbiAgICAgICAgbGFiZWw/OiBzdHJpbmdbXSxcclxuICAgICAgICBmb2N1cz86IHN0cmluZ1tdLFxyXG4gICAgICAgIHJlYWRvbmx5OiBzdHJpbmdbXSxcclxuICAgICAgICBjbGFzczogc3RyaW5nW10sXHJcbiAgICAgICAgaW1nPzpzdHJpbmdbXVxyXG4gICAgfTtcclxuXHJcbn0iXX0=