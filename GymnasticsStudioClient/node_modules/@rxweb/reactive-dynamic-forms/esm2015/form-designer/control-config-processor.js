import * as tslib_1 from "tslib";
import { Input } from "@angular/core";
import { ControlConfig } from "../services/form-control-config";
import { DYNAMIC_ELEMENT_DESIGN_TREE } from '../const/dynamic-element-design-tree.const';
import { BOOTSTRAP_DESIGN_CONFIG } from '../const/bootstrap-design-config.const';
import { DomManipulation } from '../domain/dom/dom-manipulation';
import { ApplicationUtil } from '../util/application-util';
import { objectPropValue } from '../functions/object-prop-value.function';
import { INLINE, PREPEND_BOTH, PREPEND_LEFT, PREPEND_RIGHT, INPUT_TEXT, SQUARE_ERROR, SQUARE_SMALL, SQUARE_LABEL, SQUARE_CONTROL, ADVANCE, INPUT, TEXT, RANGE, FILE, STRING, CONTROL } from '../const/app.const';
export class ControlConfigProcessor {
    constructor(element, renderer, componentFactoryResolver, viewContainerRef) {
        this.element = element;
        this.renderer = renderer;
        this.componentFactoryResolver = componentFactoryResolver;
        this.viewContainerRef = viewContainerRef;
        this.isBuild = false;
    }
    set viewMode(value) {
        this._viewMode = value;
        if (this.isBuild)
            this.build();
    }
    get viewMode() {
        return this._viewMode;
    }
    get currentViewMode() {
        return DYNAMIC_ELEMENT_DESIGN_TREE.viewMode[this.viewMode];
    }
    getView(name, controlConfig) {
        if (this.viewMode == INLINE)
            name = this.getName(name, controlConfig, true);
        return DYNAMIC_ELEMENT_DESIGN_TREE[name];
    }
    get viewClassPath() {
        return BOOTSTRAP_DESIGN_CONFIG.elementClassPath.viewMode[this.viewMode];
    }
    build() {
        this.uiBindings.forEach(controlConfigName => {
            this.designForm(controlConfigName, this.element, this.currentViewMode[0], this.currentViewMode[1], BOOTSTRAP_DESIGN_CONFIG.elementClassPath.viewMode[this.viewMode]);
        });
    }
    designForm(controlConfigName, element, viewRoot, viewChild, classPath, childrenControlConfig) {
        let controlConfig = childrenControlConfig || this.getControlConfig(controlConfigName);
        if (controlConfig) {
            if (this.viewMode != INLINE && controlConfig && !controlConfig.config.skipDefaultView)
                this.createElement(viewRoot, viewChild, element, controlConfig, classPath);
            else {
                let currentView = this.getView(controlConfig.config.type, controlConfig);
                if (currentView)
                    this.createElement(currentView[0], currentView[1], element, controlConfig, this.getClassPath(controlConfig.config.type, controlConfig, this._viewMode == INLINE));
                else
                    this.createDomManipulation(controlConfig.config.type, [], element, controlConfig, [], true);
            }
        }
        else if (this.viewMode == ADVANCE && Array.isArray(controlConfigName)) {
            let config = new ControlConfig({}, {});
            let domManipulation = this.createElement(this.currentViewMode[0], [], element, config, BOOTSTRAP_DESIGN_CONFIG.elementClassPath.viewMode[this.viewMode]);
            controlConfigName.forEach(t => {
                this.designForm(t, domManipulation.element, this.currentViewMode[1][0], this.currentViewMode[1][1], BOOTSTRAP_DESIGN_CONFIG.elementClassPath.viewMode[this.viewMode].child["0"]);
            });
        }
    }
    createElement(elementName, collections, parentElement, controlConfig, elementClassPath) {
        if (!elementName.startsWith("#")) {
            elementClassPath = elementClassPath ? elementClassPath : {};
            let domManipulation = this.createDomManipulation(elementName, collections, parentElement, controlConfig, elementClassPath);
            this.createChildrens(collections, domManipulation, controlConfig, elementClassPath);
            if (controlConfig.config && controlConfig.config.childrens && controlConfig.config.childrens.length > 0) {
                controlConfig.config.childrens.forEach((t, i) => {
                    let childrenControlConfig = undefined;
                    if (!(typeof t == STRING) && !Array.isArray(t))
                        childrenControlConfig = new ControlConfig(Object.assign({}, t, { skipDefaultView: true }), {});
                    this.designForm(t, domManipulation.element, this.currentViewMode[0], this.currentViewMode[1], BOOTSTRAP_DESIGN_CONFIG.elementClassPath.viewMode[this.viewMode], childrenControlConfig);
                });
            }
            return domManipulation;
        }
        else
            this.createDomManipulation(elementName, collections, parentElement, controlConfig, elementClassPath, true); //this.createComponentView(controlConfig, parentElement);
    }
    createDomManipulation(elementName, collections, parentElement, controlConfig, elementClassPath, isComponentView = false) {
        let dynamicNodeConfig = {
            controlConfig: controlConfig, additionalClasses: elementClassPath, renderer: this.renderer, collections: collections, controlConfigProcessor: this,
            viewContainerRef: isComponentView ? this.viewContainerRef : undefined,
            componentFactoryResolver: isComponentView ? this.componentFactoryResolver : undefined,
            dynamicFormBuildConfig: this.dynamicFormBuildConfig
        };
        return new DomManipulation(parentElement, elementName, dynamicNodeConfig);
    }
    createChildrens(collections, domManipulation, controlConfig, elementClassPath, isSubscribe = true) {
        let elementCount = 0;
        let childElementsClassConfig = elementClassPath.child ? elementClassPath.child : {};
        for (var i = 0; i < collections.length; i++) {
            let collection = collections[i];
            if (!ApplicationUtil.isObject(collection)) {
                if (this.isCreateElement(collections[i], controlConfig)) {
                    if (collection == SQUARE_CONTROL && controlConfig.config.type == undefined && controlConfig.config.childControlConfigs) {
                        controlConfig.config.childControlConfigs.forEach(x => {
                            let childControlConfig = this.getControlConfig(x);
                            this.createChildNodes(collections, childControlConfig, childElementsClassConfig, elementCount, i, domManipulation);
                        });
                    }
                    else {
                        if (collection == SQUARE_CONTROL && controlConfig.config.type.startsWith("#"))
                            this.createDomManipulation(controlConfig.config.type, [], domManipulation.element, controlConfig, [], true);
                        else {
                            let isIncrease = this.createChildNodes(collections, controlConfig, childElementsClassConfig, elementCount, i, domManipulation);
                            if (isIncrease)
                                i = i + 1;
                        }
                    }
                }
                elementCount++;
            }
            else {
                if (collection.for)
                    this.runForCollection(collection, domManipulation, controlConfig, elementClassPath);
                if (isSubscribe)
                    domManipulation.parseObject(collections[i], isSubscribe);
            }
        }
    }
    createChildNodes(collections, controlConfig, childElementsClassConfig, elementCount, i, domManipulation) {
        let isNextCollection = false;
        let nextCollection = this.getCollection(collections[i], controlConfig);
        let childClasses = this.getAdditionalClasses(collections[i], childElementsClassConfig, elementCount, controlConfig);
        if (!nextCollection) {
            nextCollection = [collections[i], collections[i + 1]];
            isNextCollection = true;
        }
        this.createElement(nextCollection[0], nextCollection[1], domManipulation.element, controlConfig, childClasses);
        return isNextCollection;
    }
    runForCollection(collection, domManipulation, controlConfig, elementClassPath) {
        Object.keys(collection.for).forEach(t => {
            let source = objectPropValue(t, controlConfig);
            source.forEach((x, index) => {
                let item = collection.for[t].call(controlConfig, x, index);
                this.createChildrens(item, domManipulation, controlConfig, elementClassPath);
            });
        });
    }
    getAdditionalClasses(name, childClasses, index, controlConfig) {
        name = this.getName(name, controlConfig);
        let additionalClasses = BOOTSTRAP_DESIGN_CONFIG.elementClassPath[name];
        let childrenClasses = childClasses[index] ? childClasses[index] : {
            class: []
        };
        if (additionalClasses) {
            if (childrenClasses.class)
                additionalClasses = { class: additionalClasses.class.concat(childrenClasses.class), listenerProps: additionalClasses.listenerProps, child: additionalClasses.child };
            return additionalClasses;
        }
        return childrenClasses;
    }
    getCollection(name, controlConfig) {
        if (name[0] == "[") {
            name = this.getName(name, controlConfig);
            return DYNAMIC_ELEMENT_DESIGN_TREE[name];
        }
        return undefined;
    }
    getControlName(name) {
        let controlName = '';
        switch (name) {
            case "number":
            case "color":
            case "date":
            case "email":
            case "password":
            case "tel":
            case "time":
            case "url":
            case "color":
            case RANGE:
            case FILE:
            case TEXT:
                controlName = INPUT;
                break;
            default:
                controlName = name;
        }
        return controlName;
    }
    getControlConfig(name) {
        return this.dynamicFormBuildConfig.controlsConfig[name];
    }
    getName(name, controlConfig, isInline = false) {
        name = name.replace(new RegExp(/\[/g), '').replace(new RegExp(/\]/g), '');
        name = (name == CONTROL || isInline) ? this.getControlName(controlConfig.config.type) : name;
        switch (name) {
            case INPUT:
                name = this.prependControl(name, controlConfig);
                break;
            case INPUT_TEXT:
                name = INPUT;
                break;
        }
        return name;
    }
    prependControl(name, controlConfig) {
        if (controlConfig.config.ui && controlConfig.config.ui.prependText && controlConfig.config.ui.prependText.right && controlConfig.config.ui.prependText.left)
            name = PREPEND_BOTH;
        else if (name == INPUT && controlConfig.config.ui && controlConfig.config.ui.prependText && controlConfig.config.ui.prependText.left)
            name = PREPEND_LEFT;
        else if (name == INPUT && controlConfig.config.ui && controlConfig.config.ui.prependText && controlConfig.config.ui.prependText.right)
            name = PREPEND_RIGHT;
        return name;
    }
    isCreateElement(collection, controlConfig) {
        let isCreate = true;
        switch (collection) {
            case "[img]":
                isCreate = controlConfig.img != undefined;
            case SQUARE_LABEL:
                isCreate = controlConfig.label != undefined;
                break;
            case SQUARE_SMALL:
                isCreate = controlConfig.description != undefined;
                break;
            case SQUARE_ERROR:
                isCreate = controlConfig.formControl != undefined && (controlConfig.formControl.validator != undefined || controlConfig.formControl.asyncValidator != undefined);
                break;
        }
        return isCreate;
    }
    getClassPath(name, controlConfig, isInline) {
        if (this.viewMode == INLINE)
            name = this.getName(name, controlConfig, isInline);
        return BOOTSTRAP_DESIGN_CONFIG.elementClassPath[name];
    }
}
tslib_1.__decorate([
    Input('rxwebDynamicForm'),
    tslib_1.__metadata("design:type", Object)
], ControlConfigProcessor.prototype, "dynamicFormBuildConfig", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", String),
    tslib_1.__metadata("design:paramtypes", [String])
], ControlConfigProcessor.prototype, "viewMode", null);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Array)
], ControlConfigProcessor.prototype, "uiBindings", void 0);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udHJvbC1jb25maWctcHJvY2Vzc29yLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHJ4d2ViL3JlYWN0aXZlLWR5bmFtaWMtZm9ybXMvIiwic291cmNlcyI6WyJmb3JtLWRlc2lnbmVyL2NvbnRyb2wtY29uZmlnLXByb2Nlc3Nvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLEtBQUssRUFBOEMsTUFBTSxlQUFlLENBQUM7QUFDbEYsT0FBTyxFQUFxQixhQUFhLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQTtBQUVsRixPQUFPLEVBQUUsMkJBQTJCLEVBQUUsTUFBTSw0Q0FBNEMsQ0FBQztBQUN6RixPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUNqRixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sZ0NBQWdDLENBQUE7QUFDaEUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQzNELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSx5Q0FBeUMsQ0FBQztBQUUxRSxPQUFPLEVBQUUsTUFBTSxFQUFDLFlBQVksRUFBRSxZQUFZLEVBQUUsYUFBYSxFQUFFLFVBQVUsRUFBQyxZQUFZLEVBQUUsWUFBWSxFQUFFLFlBQVksRUFBQyxjQUFjLEVBQUMsT0FBTyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFHN00sTUFBTSxPQUFPLHNCQUFzQjtJQStCL0IsWUFBc0IsT0FBYSxFQUFVLFFBQVEsRUFBVSx3QkFBa0QsRUFBVSxnQkFBa0M7UUFBdkksWUFBTyxHQUFQLE9BQU8sQ0FBTTtRQUFVLGFBQVEsR0FBUixRQUFRLENBQUE7UUFBVSw2QkFBd0IsR0FBeEIsd0JBQXdCLENBQTBCO1FBQVUscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQTlCN0osWUFBTyxHQUFZLEtBQUssQ0FBQztJQThCd0ks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WUFDVixLQUFLLFlBQVk7Z0JBQ2IsUUFBUSxHQUFHLGFBQWEsQ0FBQyxXQUFXLElBQUksU0FBUyxDQUFDO2dCQUNsRCxNQUFNO1lBQ1YsS0FBSyxZQUFZO2dCQUNiLFFBQVEsR0FBRyxhQUFhLENBQUMsV0FBVyxJQUFJLFNBQVMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsU0FBUyxJQUFJLFNBQVMsSUFBSSxhQUFhLENBQUMsV0FBVyxDQUFDLGNBQWMsSUFBSSxTQUFTLENBQUMsQ0FBRTtnQkFDbEssTUFBTTtTQUNiO1FBQ0QsT0FBTyxRQUFRLENBQUM7SUFDcEIsQ0FBQztJQUVPLFlBQVksQ0FBQyxJQUFZLEVBQUMsYUFBK0IsRUFBQyxRQUFnQjtRQUM5RSxJQUFJLElBQUksQ0FBQyxRQUFRLElBQUksTUFBTTtZQUN2QixJQUFJLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUMsYUFBYSxFQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3JELE9BQU8sdUJBQXVCLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDMUQsQ0FBQztDQUNKO0FBL084QjtJQUExQixLQUFLLENBQUMsa0JBQWtCLENBQUM7O3NFQUFnRDtBQUVqRTtJQUFSLEtBQUssRUFBRTs7O3NEQUlQO0FBb0JRO0lBQVIsS0FBSyxFQUFFOzswREFBbUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbnB1dCwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBWaWV3Q29udGFpbmVyUmVmIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuaW1wb3J0IHsgRm9ybUNvbnRyb2xDb25maWcsIENvbnRyb2xDb25maWcgfSBmcm9tIFwiLi4vc2VydmljZXMvZm9ybS1jb250cm9sLWNvbmZpZ1wiXHJcbmltcG9ydCB7IER5bmFtaWNGb3JtQnVpbGRDb25maWcgfSBmcm9tIFwiLi4vbW9kZWxzL2ludGVyZmFjZS9keW5hbWljLWZvcm0tYnVpbGQtY29uZmlnXCI7XHJcbmltcG9ydCB7IERZTkFNSUNfRUxFTUVOVF9ERVNJR05fVFJFRSB9IGZyb20gJy4uL2NvbnN0L2R5bmFtaWMtZWxlbWVudC1kZXNpZ24tdHJlZS5jb25zdCc7XHJcbmltcG9ydCB7IEJPT1RTVFJBUF9ERVNJR05fQ09ORklHIH0gZnJvbSAnLi4vY29uc3QvYm9vdHN0cmFwLWRlc2lnbi1jb25maWcuY29uc3QnO1xyXG5pbXBvcnQgeyBEb21NYW5pcHVsYXRpb24gfSBmcm9tICcuLi9kb21haW4vZG9tL2RvbS1tYW5pcHVsYXRpb24nXHJcbmltcG9ydCB7IEFwcGxpY2F0aW9uVXRpbCB9IGZyb20gJy4uL3V0aWwvYXBwbGljYXRpb24tdXRpbCc7XHJcbmltcG9ydCB7IG9iamVjdFByb3BWYWx1ZSB9IGZyb20gJy4uL2Z1bmN0aW9ucy9vYmplY3QtcHJvcC12YWx1ZS5mdW5jdGlvbic7XHJcblxyXG5pbXBvcnQgeyBJTkxJTkUsUFJFUEVORF9CT1RILCBQUkVQRU5EX0xFRlQsIFBSRVBFTkRfUklHSFQsIElOUFVUX1RFWFQsU1FVQVJFX0VSUk9SLCBTUVVBUkVfU01BTEwsIFNRVUFSRV9MQUJFTCxTUVVBUkVfQ09OVFJPTCxBRFZBTkNFLCBJTlBVVCwgVEVYVCwgUkFOR0UsIEZJTEUsIFNUUklORywgQ09OVFJPTCB9IGZyb20gJy4uL2NvbnN0L2FwcC5jb25zdCc7XHJcbmltcG9ydCB7IER5bmFtaWNOb2RlQ29uZmlnIH0gZnJvbSBcIi4uL21vZGVscy9pbnRlcmZhY2UvZHluYW1pYy1ub2RlLWNvbmZpZ1wiO1xyXG5cclxuZXhwb3J0IGNsYXNzIENvbnRyb2xDb25maWdQcm9jZXNzb3Ige1xyXG4gICAgaXNCdWlsZDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgX3ZpZXdNb2RlOiBhbnk7XHJcbiAgICBASW5wdXQoJ3J4d2ViRHluYW1pY0Zvcm0nKSBkeW5hbWljRm9ybUJ1aWxkQ29uZmlnOiBEeW5hbWljRm9ybUJ1aWxkQ29uZmlnO1xyXG5cclxuICAgIEBJbnB1dCgpIHNldCB2aWV3TW9kZSh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5fdmlld01vZGUgPSB2YWx1ZTtcclxuICAgICAgICBpZiAodGhpcy5pc0J1aWxkKVxyXG4gICAgICAgICAgICB0aGlzLmJ1aWxkKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHZpZXdNb2RlKCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZpZXdNb2RlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBjdXJyZW50Vmlld01vZGUoKTogYW55IHtcclxuICAgICAgICByZXR1cm4gRFlOQU1JQ19FTEVNRU5UX0RFU0lHTl9UUkVFLnZpZXdNb2RlW3RoaXMudmlld01vZGVdO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFZpZXcobmFtZTogc3RyaW5nLCBjb250cm9sQ29uZmlnOiBGb3JtQ29udHJvbENvbmZpZykge1xyXG4gICAgICAgIGlmICh0aGlzLnZpZXdNb2RlID09IElOTElORSlcclxuICAgICAgICAgICAgbmFtZSA9IHRoaXMuZ2V0TmFtZShuYW1lLGNvbnRyb2xDb25maWcsdHJ1ZSk7XHJcbiAgICAgICAgcmV0dXJuIERZTkFNSUNfRUxFTUVOVF9ERVNJR05fVFJFRVtuYW1lXTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgdmlld0NsYXNzUGF0aCgpOiBhbnkge1xyXG4gICAgICAgIHJldHVybiBCT09UU1RSQVBfREVTSUdOX0NPTkZJRy5lbGVtZW50Q2xhc3NQYXRoLnZpZXdNb2RlW3RoaXMudmlld01vZGVdO1xyXG4gICAgfVxyXG5cclxuICAgIEBJbnB1dCgpIHVpQmluZGluZ3M6IGFueVtdO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBlbGVtZW50OiBOb2RlLCBwcml2YXRlIHJlbmRlcmVyLCBwcml2YXRlIGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBwcml2YXRlIHZpZXdDb250YWluZXJSZWY6IFZpZXdDb250YWluZXJSZWYpIHsgfVxyXG5cclxuXHJcbiAgICBidWlsZCgpIHtcclxuICAgICAgICB0aGlzLnVpQmluZGluZ3MuZm9yRWFjaChjb250cm9sQ29uZmlnTmFtZSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZGVzaWduRm9ybShjb250cm9sQ29uZmlnTmFtZSwgdGhpcy5lbGVtZW50LCB0aGlzLmN1cnJlbnRWaWV3TW9kZVswXSwgdGhpcy5jdXJyZW50Vmlld01vZGVbMV0sIEJPT1RTVFJBUF9ERVNJR05fQ09ORklHLmVsZW1lbnRDbGFzc1BhdGgudmlld01vZGVbdGhpcy52aWV3TW9kZV0pO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgZGVzaWduRm9ybShjb250cm9sQ29uZmlnTmFtZSwgZWxlbWVudCwgdmlld1Jvb3QsIHZpZXdDaGlsZCwgY2xhc3NQYXRoOiBhbnksIGNoaWxkcmVuQ29udHJvbENvbmZpZz86IEZvcm1Db250cm9sQ29uZmlnKSB7XHJcbiAgICAgICAgbGV0IGNvbnRyb2xDb25maWcgPSBjaGlsZHJlbkNvbnRyb2xDb25maWcgfHwgdGhpcy5nZXRDb250cm9sQ29uZmlnKGNvbnRyb2xDb25maWdOYW1lKTtcclxuICAgICAgICBpZiAoY29udHJvbENvbmZpZykge1xyXG4gICAgICAgICAgICBpZiAodGhpcy52aWV3TW9kZSAhPSBJTkxJTkUgJiYgY29udHJvbENvbmZpZyAmJiAhY29udHJvbENvbmZpZy5jb25maWcuc2tpcERlZmF1bHRWaWV3KVxyXG4gICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVFbGVtZW50KHZpZXdSb290LCB2aWV3Q2hpbGQsIGVsZW1lbnQsIGNvbnRyb2xDb25maWcsIGNsYXNzUGF0aCk7XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbGV0IGN1cnJlbnRWaWV3ID0gdGhpcy5nZXRWaWV3KGNvbnRyb2xDb25maWcuY29uZmlnLnR5cGUsIGNvbnRyb2xDb25maWcpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRWaWV3KVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlRWxlbWVudChjdXJyZW50Vmlld1swXSwgY3VycmVudFZpZXdbMV0sIGVsZW1lbnQsIGNvbnRyb2xDb25maWcsIHRoaXMuZ2V0Q2xhc3NQYXRoKGNvbnRyb2xDb25maWcuY29uZmlnLnR5cGUsIGNvbnRyb2xDb25maWcsIHRoaXMuX3ZpZXdNb2RlID09IElOTElORSkpO1xyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlRG9tTWFuaXB1bGF0aW9uKGNvbnRyb2xDb25maWcuY29uZmlnLnR5cGUsIFtdLCBlbGVtZW50LCBjb250cm9sQ29uZmlnLCBbXSwgdHJ1ZSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy52aWV3TW9kZSA9PSBBRFZBTkNFICYmIEFycmF5LmlzQXJyYXkoY29udHJvbENvbmZpZ05hbWUpKSB7XHJcbiAgICAgICAgICAgIGxldCBjb25maWc6IGFueSA9IG5ldyBDb250cm9sQ29uZmlnKHsgfSwge30pO1xyXG4gICAgICAgICAgICBsZXQgZG9tTWFuaXB1bGF0aW9uID0gdGhpcy5jcmVhdGVFbGVtZW50KHRoaXMuY3VycmVudFZpZXdNb2RlWzBdLCBbXSwgZWxlbWVudCwgY29uZmlnLCBCT09UU1RSQVBfREVTSUdOX0NPTkZJRy5lbGVtZW50Q2xhc3NQYXRoLnZpZXdNb2RlW3RoaXMudmlld01vZGVdKVxyXG4gICAgICAgICAgICBjb250cm9sQ29uZmlnTmFtZS5mb3JFYWNoKHQgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZXNpZ25Gb3JtKHQsIGRvbU1hbmlwdWxhdGlvbi5lbGVtZW50LCB0aGlzLmN1cnJlbnRWaWV3TW9kZVsxXVswXSwgdGhpcy5jdXJyZW50Vmlld01vZGVbMV1bMV0sIEJPT1RTVFJBUF9ERVNJR05fQ09ORklHLmVsZW1lbnRDbGFzc1BhdGgudmlld01vZGVbdGhpcy52aWV3TW9kZV0uY2hpbGRbXCIwXCJdKVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgY3JlYXRlRWxlbWVudChlbGVtZW50TmFtZTogc3RyaW5nLCBjb2xsZWN0aW9uczogYW55W10sIHBhcmVudEVsZW1lbnQ6IGFueSwgY29udHJvbENvbmZpZzogRm9ybUNvbnRyb2xDb25maWcsIGVsZW1lbnRDbGFzc1BhdGg6IGFueSkge1xyXG4gICAgICAgIGlmICghZWxlbWVudE5hbWUuc3RhcnRzV2l0aChcIiNcIikpIHtcclxuICAgICAgICAgICAgZWxlbWVudENsYXNzUGF0aCA9IGVsZW1lbnRDbGFzc1BhdGggPyBlbGVtZW50Q2xhc3NQYXRoIDoge307XHJcbiAgICAgICAgICAgIGxldCBkb21NYW5pcHVsYXRpb24gPSB0aGlzLmNyZWF0ZURvbU1hbmlwdWxhdGlvbihlbGVtZW50TmFtZSwgY29sbGVjdGlvbnMsIHBhcmVudEVsZW1lbnQsIGNvbnRyb2xDb25maWcsIGVsZW1lbnRDbGFzc1BhdGgpO1xyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUNoaWxkcmVucyhjb2xsZWN0aW9ucywgZG9tTWFuaXB1bGF0aW9uLCBjb250cm9sQ29uZmlnLCBlbGVtZW50Q2xhc3NQYXRoKVxyXG4gICAgICAgICAgICBpZiAoY29udHJvbENvbmZpZy5jb25maWcgJiYgY29udHJvbENvbmZpZy5jb25maWcuY2hpbGRyZW5zICYmIGNvbnRyb2xDb25maWcuY29uZmlnLmNoaWxkcmVucy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBjb250cm9sQ29uZmlnLmNvbmZpZy5jaGlsZHJlbnMuZm9yRWFjaCgodCwgaSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBjaGlsZHJlbkNvbnRyb2xDb25maWcgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEodHlwZW9mIHQgPT0gU1RSSU5HKSAmJiAhQXJyYXkuaXNBcnJheSh0KSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW5Db250cm9sQ29uZmlnID0gbmV3IENvbnRyb2xDb25maWcoeyAuLi50LCAuLi57IHNraXBEZWZhdWx0VmlldzogdHJ1ZSB9IH0sIHt9KTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRlc2lnbkZvcm0odCwgZG9tTWFuaXB1bGF0aW9uLmVsZW1lbnQsIHRoaXMuY3VycmVudFZpZXdNb2RlWzBdLCB0aGlzLmN1cnJlbnRWaWV3TW9kZVsxXSwgQk9PVFNUUkFQX0RFU0lHTl9DT05GSUcuZWxlbWVudENsYXNzUGF0aC52aWV3TW9kZVt0aGlzLnZpZXdNb2RlXSwgY2hpbGRyZW5Db250cm9sQ29uZmlnKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGRvbU1hbmlwdWxhdGlvbjtcclxuICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgdGhpcy5jcmVhdGVEb21NYW5pcHVsYXRpb24oZWxlbWVudE5hbWUsIGNvbGxlY3Rpb25zLCBwYXJlbnRFbGVtZW50LCBjb250cm9sQ29uZmlnLCBlbGVtZW50Q2xhc3NQYXRoLHRydWUpOy8vdGhpcy5jcmVhdGVDb21wb25lbnRWaWV3KGNvbnRyb2xDb25maWcsIHBhcmVudEVsZW1lbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY3JlYXRlRG9tTWFuaXB1bGF0aW9uKGVsZW1lbnROYW1lOiBzdHJpbmcsIGNvbGxlY3Rpb25zOiBhbnlbXSwgcGFyZW50RWxlbWVudDogYW55LCBjb250cm9sQ29uZmlnOiBGb3JtQ29udHJvbENvbmZpZywgZWxlbWVudENsYXNzUGF0aDogYW55LCBpc0NvbXBvbmVudFZpZXc6IGJvb2xlYW4gPSBmYWxzZSkge1xyXG4gICAgICAgIGxldCBkeW5hbWljTm9kZUNvbmZpZzogRHluYW1pY05vZGVDb25maWcgPSB7XHJcbiAgICAgICAgICAgIGNvbnRyb2xDb25maWc6IGNvbnRyb2xDb25maWcsIGFkZGl0aW9uYWxDbGFzc2VzOiBlbGVtZW50Q2xhc3NQYXRoLCByZW5kZXJlcjogdGhpcy5yZW5kZXJlciwgY29sbGVjdGlvbnM6IGNvbGxlY3Rpb25zLCBjb250cm9sQ29uZmlnUHJvY2Vzc29yOiB0aGlzLFxyXG4gICAgICAgICAgICB2aWV3Q29udGFpbmVyUmVmOiBpc0NvbXBvbmVudFZpZXcgPyB0aGlzLnZpZXdDb250YWluZXJSZWYgOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgIGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjogaXNDb21wb25lbnRWaWV3ID8gdGhpcy5jb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIgOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgIGR5bmFtaWNGb3JtQnVpbGRDb25maWc6IHRoaXMuZHluYW1pY0Zvcm1CdWlsZENvbmZpZ1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbmV3IERvbU1hbmlwdWxhdGlvbihwYXJlbnRFbGVtZW50LCBlbGVtZW50TmFtZSwgZHluYW1pY05vZGVDb25maWcpO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUNoaWxkcmVucyhjb2xsZWN0aW9ucywgZG9tTWFuaXB1bGF0aW9uLCBjb250cm9sQ29uZmlnLCBlbGVtZW50Q2xhc3NQYXRoLGlzU3Vic2NyaWJlOmJvb2xlYW4gPSB0cnVlKSB7XHJcbiAgICAgICAgbGV0IGVsZW1lbnRDb3VudCA9IDA7XHJcbiAgICAgICAgbGV0IGNoaWxkRWxlbWVudHNDbGFzc0NvbmZpZyA9IGVsZW1lbnRDbGFzc1BhdGguY2hpbGQgPyBlbGVtZW50Q2xhc3NQYXRoLmNoaWxkIDoge307XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb2xsZWN0aW9ucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBsZXQgY29sbGVjdGlvbiA9IGNvbGxlY3Rpb25zW2ldO1xyXG4gICAgICAgICAgICBpZiAoIUFwcGxpY2F0aW9uVXRpbC5pc09iamVjdChjb2xsZWN0aW9uKSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNDcmVhdGVFbGVtZW50KGNvbGxlY3Rpb25zW2ldLCBjb250cm9sQ29uZmlnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2xsZWN0aW9uID09IFNRVUFSRV9DT05UUk9MICYmIGNvbnRyb2xDb25maWcuY29uZmlnLnR5cGUgPT0gdW5kZWZpbmVkICYmIGNvbnRyb2xDb25maWcuY29uZmlnLmNoaWxkQ29udHJvbENvbmZpZ3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbENvbmZpZy5jb25maWcuY2hpbGRDb250cm9sQ29uZmlncy5mb3JFYWNoKHggPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNoaWxkQ29udHJvbENvbmZpZyA9IHRoaXMuZ2V0Q29udHJvbENvbmZpZyh4KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlQ2hpbGROb2Rlcyhjb2xsZWN0aW9ucywgY2hpbGRDb250cm9sQ29uZmlnLCBjaGlsZEVsZW1lbnRzQ2xhc3NDb25maWcsIGVsZW1lbnRDb3VudCwgaSwgZG9tTWFuaXB1bGF0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29sbGVjdGlvbiA9PSBTUVVBUkVfQ09OVFJPTCAmJiBjb250cm9sQ29uZmlnLmNvbmZpZy50eXBlLnN0YXJ0c1dpdGgoXCIjXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVEb21NYW5pcHVsYXRpb24oY29udHJvbENvbmZpZy5jb25maWcudHlwZSwgW10sIGRvbU1hbmlwdWxhdGlvbi5lbGVtZW50LCBjb250cm9sQ29uZmlnLFtdLHRydWUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGlzSW5jcmVhc2UgPSB0aGlzLmNyZWF0ZUNoaWxkTm9kZXMoY29sbGVjdGlvbnMsIGNvbnRyb2xDb25maWcsIGNoaWxkRWxlbWVudHNDbGFzc0NvbmZpZywgZWxlbWVudENvdW50LCBpLCBkb21NYW5pcHVsYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzSW5jcmVhc2UpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaSA9IGkgKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxlbWVudENvdW50Kys7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29sbGVjdGlvbi5mb3IpXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ydW5Gb3JDb2xsZWN0aW9uKGNvbGxlY3Rpb24sIGRvbU1hbmlwdWxhdGlvbiwgY29udHJvbENvbmZpZywgZWxlbWVudENsYXNzUGF0aCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNTdWJzY3JpYmUpXHJcbiAgICAgICAgICAgICAgICBkb21NYW5pcHVsYXRpb24ucGFyc2VPYmplY3QoY29sbGVjdGlvbnNbaV0sIGlzU3Vic2NyaWJlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNyZWF0ZUNoaWxkTm9kZXMoY29sbGVjdGlvbnMsIGNvbnRyb2xDb25maWcsIGNoaWxkRWxlbWVudHNDbGFzc0NvbmZpZywgZWxlbWVudENvdW50LCBpLCBkb21NYW5pcHVsYXRpb24pIHtcclxuICAgICAgICBsZXQgaXNOZXh0Q29sbGVjdGlvbjogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgICAgIGxldCBuZXh0Q29sbGVjdGlvbiA9IHRoaXMuZ2V0Q29sbGVjdGlvbihjb2xsZWN0aW9uc1tpXSwgY29udHJvbENvbmZpZyk7XHJcbiAgICAgICAgbGV0IGNoaWxkQ2xhc3NlcyA9IHRoaXMuZ2V0QWRkaXRpb25hbENsYXNzZXMoY29sbGVjdGlvbnNbaV0sIGNoaWxkRWxlbWVudHNDbGFzc0NvbmZpZywgZWxlbWVudENvdW50LCBjb250cm9sQ29uZmlnKTtcclxuICAgICAgICBpZiAoIW5leHRDb2xsZWN0aW9uKSB7XHJcbiAgICAgICAgICAgIG5leHRDb2xsZWN0aW9uID0gW2NvbGxlY3Rpb25zW2ldLCBjb2xsZWN0aW9uc1tpICsgMV1dO1xyXG4gICAgICAgICAgICBpc05leHRDb2xsZWN0aW9uID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jcmVhdGVFbGVtZW50KG5leHRDb2xsZWN0aW9uWzBdLCBuZXh0Q29sbGVjdGlvblsxXSwgZG9tTWFuaXB1bGF0aW9uLmVsZW1lbnQsIGNvbnRyb2xDb25maWcsIGNoaWxkQ2xhc3Nlcyk7XHJcbiAgICAgICAgcmV0dXJuIGlzTmV4dENvbGxlY3Rpb247XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHJ1bkZvckNvbGxlY3Rpb24oY29sbGVjdGlvbjogYW55LCBkb21NYW5pcHVsYXRpb24sIGNvbnRyb2xDb25maWcsIGVsZW1lbnRDbGFzc1BhdGgpIHtcclxuICAgICAgICBPYmplY3Qua2V5cyhjb2xsZWN0aW9uLmZvcikuZm9yRWFjaCh0ID0+IHtcclxuICAgICAgICAgICAgbGV0IHNvdXJjZSA9IG9iamVjdFByb3BWYWx1ZSh0LCBjb250cm9sQ29uZmlnKTtcclxuICAgICAgICAgICAgc291cmNlLmZvckVhY2goKHgsIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgaXRlbSA9IGNvbGxlY3Rpb24uZm9yW3RdLmNhbGwoY29udHJvbENvbmZpZywgeCwgaW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVDaGlsZHJlbnMoaXRlbSwgZG9tTWFuaXB1bGF0aW9uLCBjb250cm9sQ29uZmlnLCBlbGVtZW50Q2xhc3NQYXRoKTtcclxuICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldEFkZGl0aW9uYWxDbGFzc2VzKG5hbWU6IHN0cmluZywgY2hpbGRDbGFzc2VzOiB7IFtrZXk6IHN0cmluZ106IGFueSB9LCBpbmRleDogbnVtYmVyLCBjb250cm9sQ29uZmlnOiBGb3JtQ29udHJvbENvbmZpZykge1xyXG4gICAgICAgIG5hbWUgPSB0aGlzLmdldE5hbWUobmFtZSwgY29udHJvbENvbmZpZylcclxuICAgICAgICBsZXQgYWRkaXRpb25hbENsYXNzZXMgPSBCT09UU1RSQVBfREVTSUdOX0NPTkZJRy5lbGVtZW50Q2xhc3NQYXRoW25hbWVdO1xyXG4gICAgICAgIGxldCBjaGlsZHJlbkNsYXNzZXMgPSBjaGlsZENsYXNzZXNbaW5kZXhdID8gY2hpbGRDbGFzc2VzW2luZGV4XSA6IHtcclxuICAgICAgICAgICAgY2xhc3M6IFtdXHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAoYWRkaXRpb25hbENsYXNzZXMpIHtcclxuICAgICAgICAgICAgaWYgKGNoaWxkcmVuQ2xhc3Nlcy5jbGFzcylcclxuICAgICAgICAgICAgICAgIGFkZGl0aW9uYWxDbGFzc2VzID0geyBjbGFzczogYWRkaXRpb25hbENsYXNzZXMuY2xhc3MuY29uY2F0KGNoaWxkcmVuQ2xhc3Nlcy5jbGFzcyksIGxpc3RlbmVyUHJvcHM6IGFkZGl0aW9uYWxDbGFzc2VzLmxpc3RlbmVyUHJvcHMsIGNoaWxkOiBhZGRpdGlvbmFsQ2xhc3Nlcy5jaGlsZCB9XHJcbiAgICAgICAgICAgIHJldHVybiBhZGRpdGlvbmFsQ2xhc3Nlc1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGNoaWxkcmVuQ2xhc3NlcztcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldENvbGxlY3Rpb24obmFtZTogc3RyaW5nLGNvbnRyb2xDb25maWc6IEZvcm1Db250cm9sQ29uZmlnKSB7XHJcbiAgICAgICAgaWYgKG5hbWVbMF0gPT0gXCJbXCIpIHtcclxuICAgICAgICAgICAgbmFtZSA9IHRoaXMuZ2V0TmFtZShuYW1lLCBjb250cm9sQ29uZmlnKTtcclxuICAgICAgICAgICAgcmV0dXJuIERZTkFNSUNfRUxFTUVOVF9ERVNJR05fVFJFRVtuYW1lXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldENvbnRyb2xOYW1lKG5hbWU6IHN0cmluZykge1xyXG4gICAgICAgIGxldCBjb250cm9sTmFtZTogc3RyaW5nID0gJyc7XHJcbiAgICAgICAgc3dpdGNoIChuYW1lKSB7XHJcbiAgICAgICAgICAgIGNhc2UgXCJudW1iZXJcIjpcclxuICAgICAgICAgICAgY2FzZSBcImNvbG9yXCI6XHJcbiAgICAgICAgICAgIGNhc2UgXCJkYXRlXCI6XHJcbiAgICAgICAgICAgIGNhc2UgXCJlbWFpbFwiOlxyXG4gICAgICAgICAgICBjYXNlIFwicGFzc3dvcmRcIjpcclxuICAgICAgICAgICAgY2FzZSBcInRlbFwiOlxyXG4gICAgICAgICAgICBjYXNlIFwidGltZVwiOlxyXG4gICAgICAgICAgICBjYXNlIFwidXJsXCI6XHJcbiAgICAgICAgICAgIGNhc2UgXCJjb2xvclwiOlxyXG4gICAgICAgICAgICBjYXNlIFJBTkdFOlxyXG4gICAgICAgICAgICBjYXNlIEZJTEU6XHJcbiAgICAgICAgICAgIGNhc2UgVEVYVDpcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xOYW1lID0gSU5QVVQ7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xOYW1lID0gbmFtZTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBjb250cm9sTmFtZTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldENvbnRyb2xDb25maWcobmFtZTogc3RyaW5nKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZHluYW1pY0Zvcm1CdWlsZENvbmZpZy5jb250cm9sc0NvbmZpZ1tuYW1lXTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldE5hbWUobmFtZTogc3RyaW5nLCBjb250cm9sQ29uZmlnOiBGb3JtQ29udHJvbENvbmZpZyxpc0lubGluZTpib29sZWFuID0gZmFsc2UpIHtcclxuICAgICAgICBuYW1lID0gbmFtZS5yZXBsYWNlKG5ldyBSZWdFeHAoL1xcWy9nKSwgJycpLnJlcGxhY2UobmV3IFJlZ0V4cCgvXFxdL2cpLCAnJyk7XHJcbiAgICAgICAgbmFtZSA9IChuYW1lID09IENPTlRST0wgfHwgaXNJbmxpbmUpID8gdGhpcy5nZXRDb250cm9sTmFtZShjb250cm9sQ29uZmlnLmNvbmZpZy50eXBlKSA6IG5hbWU7XHJcbiAgICAgICAgc3dpdGNoIChuYW1lKSB7XHJcbiAgICAgICAgICAgIGNhc2UgSU5QVVQ6XHJcbiAgICAgICAgICAgICAgICBuYW1lID0gdGhpcy5wcmVwZW5kQ29udHJvbChuYW1lLGNvbnRyb2xDb25maWcpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgSU5QVVRfVEVYVDpcclxuICAgICAgICAgICAgICAgIG5hbWUgPSBJTlBVVDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbmFtZTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHByZXBlbmRDb250cm9sKG5hbWU6IHN0cmluZywgY29udHJvbENvbmZpZzogRm9ybUNvbnRyb2xDb25maWcpIHtcclxuICAgICAgICBpZiAoY29udHJvbENvbmZpZy5jb25maWcudWkgJiYgY29udHJvbENvbmZpZy5jb25maWcudWkucHJlcGVuZFRleHQgJiYgY29udHJvbENvbmZpZy5jb25maWcudWkucHJlcGVuZFRleHQucmlnaHQgJiYgY29udHJvbENvbmZpZy5jb25maWcudWkucHJlcGVuZFRleHQubGVmdClcclxuICAgICAgICAgICAgbmFtZSA9IFBSRVBFTkRfQk9USDtcclxuICAgICAgICBlbHNlIGlmIChuYW1lID09IElOUFVUICYmIGNvbnRyb2xDb25maWcuY29uZmlnLnVpICYmIGNvbnRyb2xDb25maWcuY29uZmlnLnVpLnByZXBlbmRUZXh0ICYmIGNvbnRyb2xDb25maWcuY29uZmlnLnVpLnByZXBlbmRUZXh0LmxlZnQpXHJcbiAgICAgICAgICAgIG5hbWUgPSBQUkVQRU5EX0xFRlQ7XHJcbiAgICAgICAgZWxzZSBpZiAobmFtZSA9PSBJTlBVVCAmJiBjb250cm9sQ29uZmlnLmNvbmZpZy51aSAmJiBjb250cm9sQ29uZmlnLmNvbmZpZy51aS5wcmVwZW5kVGV4dCAmJiBjb250cm9sQ29uZmlnLmNvbmZpZy51aS5wcmVwZW5kVGV4dC5yaWdodClcclxuICAgICAgICAgICAgbmFtZSA9IFBSRVBFTkRfUklHSFQ7XHJcbiAgICAgICAgcmV0dXJuIG5hbWU7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpc0NyZWF0ZUVsZW1lbnQoY29sbGVjdGlvbjogYW55LCBjb250cm9sQ29uZmlnOiBGb3JtQ29udHJvbENvbmZpZykge1xyXG4gICAgICAgIGxldCBpc0NyZWF0ZSA9IHRydWU7XHJcbiAgICAgICAgc3dpdGNoIChjb2xsZWN0aW9uKSB7XHJcbiAgICAgICAgICAgIGNhc2UgXCJbaW1nXVwiOlxyXG4gICAgICAgICAgICAgICAgaXNDcmVhdGUgPSBjb250cm9sQ29uZmlnLmltZyAhPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIGNhc2UgU1FVQVJFX0xBQkVMOlxyXG4gICAgICAgICAgICAgICAgaXNDcmVhdGUgPSBjb250cm9sQ29uZmlnLmxhYmVsICE9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFNRVUFSRV9TTUFMTDpcclxuICAgICAgICAgICAgICAgIGlzQ3JlYXRlID0gY29udHJvbENvbmZpZy5kZXNjcmlwdGlvbiAhPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBTUVVBUkVfRVJST1I6XHJcbiAgICAgICAgICAgICAgICBpc0NyZWF0ZSA9IGNvbnRyb2xDb25maWcuZm9ybUNvbnRyb2wgIT0gdW5kZWZpbmVkICYmIChjb250cm9sQ29uZmlnLmZvcm1Db250cm9sLnZhbGlkYXRvciAhPSB1bmRlZmluZWQgfHwgY29udHJvbENvbmZpZy5mb3JtQ29udHJvbC5hc3luY1ZhbGlkYXRvciAhPSB1bmRlZmluZWQpIDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gaXNDcmVhdGU7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRDbGFzc1BhdGgobmFtZTogc3RyaW5nLGNvbnRyb2xDb25maWc6Rm9ybUNvbnRyb2xDb25maWcsaXNJbmxpbmU6Ym9vbGVhbikge1xyXG4gICAgICAgIGlmICh0aGlzLnZpZXdNb2RlID09IElOTElORSlcclxuICAgICAgICAgICAgbmFtZSA9IHRoaXMuZ2V0TmFtZShuYW1lLGNvbnRyb2xDb25maWcsaXNJbmxpbmUpO1xyXG4gICAgICAgIHJldHVybiBCT09UU1RSQVBfREVTSUdOX0NPTkZJRy5lbGVtZW50Q2xhc3NQYXRoW25hbWVdO1xyXG4gICAgfVxyXG59Il19