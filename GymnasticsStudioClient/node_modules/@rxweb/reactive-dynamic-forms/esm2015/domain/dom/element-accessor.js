import { BaseObjectAccessor } from './base-object-accessor';
import { CHECKBOX, SELECT_MULTIPLE, RADIO, FILE } from '../../const/app.const';
import { ControlState } from '../../statics/control-state';
import { dynamicContainer } from "../../core/dynamicContainer";
import { ComponentView } from "../component-viewer/component-view";
export class ElementAccessor extends BaseObjectAccessor {
    constructor(dynamicNodeConfig) {
        super(dynamicNodeConfig);
        this.checkedCheckbox = (value, element) => (value) ? (this.controlConfig.config.multiselect) ? value.filter(t => element.value == t)[0] != undefined : element.value == value : false;
        this.checkedRadio = (value, element) => (value) ? value == element.value : false;
    }
    createNodeElement(parentElement, name) {
        this.element = name.startsWith("#") ? this.createComponentView(this.dynamicNodeConfig.controlConfig) : this.dynamicNodeConfig.renderer.createElement(name);
        this.dynamicNodeConfig.renderer.appendChild(parentElement, this.element);
    }
    createComponentView(controlConfig) {
        let container = dynamicContainer.getComponent(controlConfig.config.type.replace("#", ""));
        if (container) {
            this.componentView = new ComponentView(container.instance, this.dynamicNodeConfig.viewContainerRef, this.dynamicNodeConfig.componentFactoryResolver, controlConfig, this.dynamicNodeConfig.dynamicFormBuildConfig);
            this.componentView.create();
            return this.componentView.rootNode();
        }
    }
    removeChildren(element) {
        if (element.firstElementChild) {
            this.removeChildren(element.firstElementChild);
        }
        let controlId = element.getAttribute("data-rxwebid");
        if (controlId && ControlState.controls[controlId]) {
            ControlState.controls[controlId].destroy();
            delete ControlState.controls[controlId];
        }
    }
    setControlConfigValue(targetElement) {
        let value = targetElement.value === "" ? null : targetElement.value;
        switch (targetElement.type) {
            case FILE:
                this.controlConfig.formControl.setValue(targetElement.files);
                this.controlConfig.value = targetElement.files;
                break;
            case CHECKBOX:
                this.setCheckboxValue(targetElement);
                break;
            case SELECT_MULTIPLE:
                let values = [];
                for (let option of this.element.options)
                    if (option.selected && option.value)
                        values.push(option.value);
                this.controlConfig.value = values;
                break;
            default:
                this.controlConfig.formControl.setValue(value);
                this.controlConfig.value = value;
                break;
        }
    }
    resetElementValue(value) {
        switch (this.element.type) {
            case CHECKBOX:
            case RADIO:
                var elements = document.querySelectorAll(`[name='${this.controlConfig.config.name}']`);
                for (var i = 0; i < elements.length; i++) {
                    elements[i].checked = this.element.type == CHECKBOX ? this.checkedCheckbox(value, elements[i]) : this.checkedRadio(value, elements[i]);
                }
                break;
            case SELECT_MULTIPLE:
                for (let option of this.element.options) {
                    option.selected = (value) ? value.filter(t => t == option.value)[0] != undefined : false;
                }
                break;
            default:
                this.element.value = value;
        }
    }
    setCheckboxValue(targetElement) {
        let value = (this.controlConfig.config.multiselect) ? this.controlConfig.value || [] : targetElement.value;
        if (targetElement.checked)
            (this.controlConfig.config.multiselect) ? value.push(targetElement.value) : null;
        else
            (this.controlConfig.config.multiselect) ? value.splice(value.indexOf(targetElement.value), 1) : value = null;
        this.controlConfig.formControl.setValue(value);
        this.controlConfig.value = value;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWxlbWVudC1hY2Nlc3Nvci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0ByeHdlYi9yZWFjdGl2ZS1keW5hbWljLWZvcm1zLyIsInNvdXJjZXMiOlsiZG9tYWluL2RvbS9lbGVtZW50LWFjY2Vzc29yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQzVELE9BQU8sRUFBRSxRQUFRLEVBQUUsZUFBZSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQTtBQUM5RSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDM0QsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDL0QsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBRW5FLE1BQU0sT0FBZ0IsZUFBZ0IsU0FBUSxrQkFBa0I7SUFJNUQsWUFBWSxpQkFBb0M7UUFDNUMsS0FBSyxDQUFDLGlCQUFpQixDQUFDLENBQUE7UUF5RXBCLG9CQUFlLEdBQUcsQ0FBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxTQUFTLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7UUFFakwsaUJBQVksR0FBRyxDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUUsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssSUFBSSxPQUFPLENBQUMs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RCxNQUFNO1lBQ1Y7Z0JBQ0ksSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1NBQ2xDO0lBQ0wsQ0FBQztJQU1PLGdCQUFnQixDQUFDLGFBQWE7UUFDbEMsSUFBSSxLQUFLLEdBQUcsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDO1FBQzNHLElBQUksYUFBYSxDQUFDLE9BQU87WUFDckIsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQzs7WUFFakYsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztRQUNqSCxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDL0MsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO0lBQ3JDLENBQUM7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IER5bmFtaWNOb2RlQ29uZmlnIH0gZnJvbSBcIi4uLy4uL21vZGVscy9pbnRlcmZhY2UvZHluYW1pYy1ub2RlLWNvbmZpZ1wiO1xyXG5pbXBvcnQgeyBCYXNlT2JqZWN0QWNjZXNzb3IgfSBmcm9tICcuL2Jhc2Utb2JqZWN0LWFjY2Vzc29yJztcclxuaW1wb3J0IHsgQ0hFQ0tCT1gsIFNFTEVDVF9NVUxUSVBMRSwgUkFESU8sIEZJTEUgfSBmcm9tICcuLi8uLi9jb25zdC9hcHAuY29uc3QnXHJcbmltcG9ydCB7IENvbnRyb2xTdGF0ZSB9IGZyb20gJy4uLy4uL3N0YXRpY3MvY29udHJvbC1zdGF0ZSc7XHJcbmltcG9ydCB7IGR5bmFtaWNDb250YWluZXIgfSBmcm9tIFwiLi4vLi4vY29yZS9keW5hbWljQ29udGFpbmVyXCI7XHJcbmltcG9ydCB7IENvbXBvbmVudFZpZXcgfSBmcm9tIFwiLi4vY29tcG9uZW50LXZpZXdlci9jb21wb25lbnQtdmlld1wiO1xyXG5cclxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEVsZW1lbnRBY2Nlc3NvciBleHRlbmRzIEJhc2VPYmplY3RBY2Nlc3NvcntcclxuICAgIGVsZW1lbnQ6IGFueTtcclxuICAgIHByb3RlY3RlZCBjb21wb25lbnRWaWV3OiBhbnk7XHJcblxyXG4gICAgY29uc3RydWN0b3IoZHluYW1pY05vZGVDb25maWc6IER5bmFtaWNOb2RlQ29uZmlnKSB7XHJcbiAgICAgICAgc3VwZXIoZHluYW1pY05vZGVDb25maWcpXHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlTm9kZUVsZW1lbnQocGFyZW50RWxlbWVudDogYW55LCBuYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLmVsZW1lbnQgPSBuYW1lLnN0YXJ0c1dpdGgoXCIjXCIpID8gdGhpcy5jcmVhdGVDb21wb25lbnRWaWV3KHRoaXMuZHluYW1pY05vZGVDb25maWcuY29udHJvbENvbmZpZykgOiB0aGlzLmR5bmFtaWNOb2RlQ29uZmlnLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQobmFtZSk7XHJcbiAgICAgICAgdGhpcy5keW5hbWljTm9kZUNvbmZpZy5yZW5kZXJlci5hcHBlbmRDaGlsZChwYXJlbnRFbGVtZW50LCB0aGlzLmVsZW1lbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY3JlYXRlQ29tcG9uZW50Vmlldyhjb250cm9sQ29uZmlnOiBhbnkpIHtcclxuICAgICAgICBsZXQgY29udGFpbmVyID0gZHluYW1pY0NvbnRhaW5lci5nZXRDb21wb25lbnQoY29udHJvbENvbmZpZy5jb25maWcudHlwZS5yZXBsYWNlKFwiI1wiLCBcIlwiKSk7XHJcbiAgICAgICAgaWYgKGNvbnRhaW5lcikge1xyXG4gICAgICAgICAgICB0aGlzLmNvbXBvbmVudFZpZXcgPSBuZXcgQ29tcG9uZW50Vmlldyhjb250YWluZXIuaW5zdGFuY2UsIHRoaXMuZHluYW1pY05vZGVDb25maWcudmlld0NvbnRhaW5lclJlZiwgdGhpcy5keW5hbWljTm9kZUNvbmZpZy5jb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIGNvbnRyb2xDb25maWcsIHRoaXMuZHluYW1pY05vZGVDb25maWcuZHluYW1pY0Zvcm1CdWlsZENvbmZpZyk7XHJcbiAgICAgICAgICAgIHRoaXMuY29tcG9uZW50Vmlldy5jcmVhdGUoKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29tcG9uZW50Vmlldy5yb290Tm9kZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgcmVtb3ZlQ2hpbGRyZW4oZWxlbWVudDogYW55KSB7XHJcbiAgICAgICAgaWYgKGVsZW1lbnQuZmlyc3RFbGVtZW50Q2hpbGQpIHtcclxuICAgICAgICAgICAgdGhpcy5yZW1vdmVDaGlsZHJlbihlbGVtZW50LmZpcnN0RWxlbWVudENoaWxkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IGNvbnRyb2xJZCA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKFwiZGF0YS1yeHdlYmlkXCIpO1xyXG4gICAgICAgIGlmIChjb250cm9sSWQgJiYgQ29udHJvbFN0YXRlLmNvbnRyb2xzW2NvbnRyb2xJZF0pIHtcclxuICAgICAgICAgICAgQ29udHJvbFN0YXRlLmNvbnRyb2xzW2NvbnRyb2xJZF0uZGVzdHJveSgpO1xyXG4gICAgICAgICAgICBkZWxldGUgQ29udHJvbFN0YXRlLmNvbnRyb2xzW2NvbnRyb2xJZF07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICBcclxuXHJcbiAgICBzZXRDb250cm9sQ29uZmlnVmFsdWUodGFyZ2V0RWxlbWVudCkge1xyXG4gICAgICAgIGxldCB2YWx1ZSA9IHRhcmdldEVsZW1lbnQudmFsdWUgPT09IFwiXCIgPyBudWxsIDogdGFyZ2V0RWxlbWVudC52YWx1ZTtcclxuICAgICAgICBzd2l0Y2ggKHRhcmdldEVsZW1lbnQudHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlIEZJTEU6XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xDb25maWcuZm9ybUNvbnRyb2wuc2V0VmFsdWUodGFyZ2V0RWxlbWVudC5maWxlcylcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbENvbmZpZy52YWx1ZSA9IHRhcmdldEVsZW1lbnQuZmlsZXM7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBDSEVDS0JPWDpcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0Q2hlY2tib3hWYWx1ZSh0YXJnZXRFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFNFTEVDVF9NVUxUSVBMRTpcclxuICAgICAgICAgICAgICAgIGxldCB2YWx1ZXMgPSBbXTtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiB0aGlzLmVsZW1lbnQub3B0aW9ucylcclxuICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9uLnNlbGVjdGVkICYmIG9wdGlvbi52YWx1ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzLnB1c2gob3B0aW9uLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbENvbmZpZy52YWx1ZSA9IHZhbHVlcztcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgdGhpcy5jb250cm9sQ29uZmlnLmZvcm1Db250cm9sLnNldFZhbHVlKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbENvbmZpZy52YWx1ZSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJlc2V0RWxlbWVudFZhbHVlKHZhbHVlOiBhbnkpIHtcclxuICAgICAgICBzd2l0Y2ggKHRoaXMuZWxlbWVudC50eXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgQ0hFQ0tCT1g6XHJcbiAgICAgICAgICAgIGNhc2UgUkFESU86XHJcbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudHM6YW55ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgW25hbWU9JyR7dGhpcy5jb250cm9sQ29uZmlnLmNvbmZpZy5uYW1lfSddYCk7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudHNbaV0uY2hlY2tlZCA9IHRoaXMuZWxlbWVudC50eXBlID09IENIRUNLQk9YID8gdGhpcy5jaGVja2VkQ2hlY2tib3godmFsdWUsIGVsZW1lbnRzW2ldKSA6IHRoaXMuY2hlY2tlZFJhZGlvKHZhbHVlLCBlbGVtZW50c1tpXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBTRUxFQ1RfTVVMVElQTEU6XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgdGhpcy5lbGVtZW50Lm9wdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSAodmFsdWUpID8gdmFsdWUuZmlsdGVyKHQgPT4gdCA9PSBvcHRpb24udmFsdWUpWzBdICE9IHVuZGVmaW5lZCA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQudmFsdWUgPSB2YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjaGVja2VkQ2hlY2tib3ggPSAodmFsdWUsIGVsZW1lbnQpID0+ICh2YWx1ZSkgPyAodGhpcy5jb250cm9sQ29uZmlnLmNvbmZpZy5tdWx0aXNlbGVjdCkgPyB2YWx1ZS5maWx0ZXIodCA9PiBlbGVtZW50LnZhbHVlID09IHQpWzBdICE9IHVuZGVmaW5lZCA6IGVsZW1lbnQudmFsdWUgPT0gdmFsdWUgOiBmYWxzZTtcclxuXHJcbiAgICBwcml2YXRlIGNoZWNrZWRSYWRpbyA9ICh2YWx1ZSwgZWxlbWVudCkgPT4gKHZhbHVlKSA/IHZhbHVlID09IGVsZW1lbnQudmFsdWUgOiBmYWxzZTtcclxuXHJcbiAgICBwcml2YXRlIHNldENoZWNrYm94VmFsdWUodGFyZ2V0RWxlbWVudCkge1xyXG4gICAgICAgIGxldCB2YWx1ZSA9ICh0aGlzLmNvbnRyb2xDb25maWcuY29uZmlnLm11bHRpc2VsZWN0KSA/IHRoaXMuY29udHJvbENvbmZpZy52YWx1ZSB8fCBbXSA6IHRhcmdldEVsZW1lbnQudmFsdWU7XHJcbiAgICAgICAgaWYgKHRhcmdldEVsZW1lbnQuY2hlY2tlZClcclxuICAgICAgICAgICAgKHRoaXMuY29udHJvbENvbmZpZy5jb25maWcubXVsdGlzZWxlY3QpID8gdmFsdWUucHVzaCh0YXJnZXRFbGVtZW50LnZhbHVlKSA6IG51bGw7XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAodGhpcy5jb250cm9sQ29uZmlnLmNvbmZpZy5tdWx0aXNlbGVjdCkgPyB2YWx1ZS5zcGxpY2UodmFsdWUuaW5kZXhPZih0YXJnZXRFbGVtZW50LnZhbHVlKSwgMSkgOiB2YWx1ZSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5jb250cm9sQ29uZmlnLmZvcm1Db250cm9sLnNldFZhbHVlKHZhbHVlKTtcclxuICAgICAgICB0aGlzLmNvbnRyb2xDb25maWcudmFsdWUgPSB2YWx1ZTtcclxuICAgIH1cclxufSJdfQ==