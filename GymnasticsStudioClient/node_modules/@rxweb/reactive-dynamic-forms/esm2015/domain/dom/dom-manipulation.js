import { SOURCE, SELECT, ADDITIONAL_CLASS, PROP, ATTR, EVENTS, INPUT, TEXTAREA, READONLY } from '../../const/app.const';
import { ControlState } from '../../statics/control-state';
import { OverrideObjectProp } from "./override-object-prop";
export class DomManipulation extends OverrideObjectProp {
    constructor(parentNode, elementName, dynamicNodeConfig) {
        super(dynamicNodeConfig);
        this.isComponentView = false;
        this.subscribers = [];
        this.elementIndex = 0;
        this.eventListeners = [];
        this.actionListeners = {};
        this.elementClasses = [];
        this.nodeName = elementName;
        super.createNodeElement(parentNode, elementName);
        this.bindAdditionalClasses();
        this.controlId = ControlState.controlId = ControlState.controlId + 1;
        ControlState.controls[this.controlId] = this;
        this.addOrRemoveAttribute("data-rxwebid", this.controlId, false);
    }
    parseObject(jObject, isSubscribe) {
        this.domConfig = jObject;
        this.process(jObject, isSubscribe);
        this.overrideProp(isSubscribe);
        this.subscribeValueChange();
    }
    subscribeValueChange() {
        if (Object.keys(this.subscribeProps).length > 0)
            this.controlConfig.onPropValueChanged(this.controlId, this.subscribeProps, (x, y) => {
                this.process(x, false);
            });
    }
    process(jObject, isSubscribe) {
        Object.keys(jObject).forEach(propName => {
            switch (propName) {
                case PROP:
                    this.bindProp(jObject[propName], isSubscribe);
                    break;
                case ATTR:
                    this.bindAttribute(jObject[propName], isSubscribe);
                    break;
                case EVENTS:
                    this.bindEvents(jObject[propName], isSubscribe);
                    break;
                case SOURCE:
                    if (!isSubscribe) {
                        while (this.element.firstElementChild)
                            this.removeChildren(this.element.firstElementChild);
                        this.dynamicNodeConfig.controlConfigProcessor.createChildrens(this.dynamicNodeConfig.collections, this, this.controlConfig, this.dynamicNodeConfig.additionalClasses, false);
                    }
                    else
                        this.setPropSubscription(SOURCE, SOURCE, SOURCE);
                    break;
            }
        });
    }
    overrideProp(isSubscribe) {
        switch (this.nodeName) {
            case INPUT:
            case SELECT:
            case TEXTAREA:
                if (this.domConfig.overrideProp == undefined || this.domConfig.overrideProp)
                    this.overrideValueProp();
                this.setPropSubscription(READONLY, ATTR, ADDITIONAL_CLASS, ADDITIONAL_CLASS);
                if (this.controlConfig && this.controlConfig.config && this.controlConfig.config.additionalConfig)
                    this.process(this.controlConfig.config.additionalConfig, isSubscribe);
                break;
        }
    }
    bindAdditionalClasses() {
        let additionalClasses = this.dynamicNodeConfig.additionalClasses;
        if (additionalClasses && additionalClasses.class) {
            this.setClass(additionalClasses.class, ADDITIONAL_CLASS);
            if (additionalClasses.listenerProps)
                additionalClasses.listenerProps.forEach(t => this.setPropSubscription(t, ATTR, ADDITIONAL_CLASS, ADDITIONAL_CLASS));
        }
    }
    destroy() {
        let eventCount = this.eventListeners.length;
        for (var i = 0; i < eventCount; i++) {
            this.eventListeners[0]();
            this.eventListeners.splice(0, 1);
        }
        this.eventListeners = [];
        this.element.onClick = null;
        if (this.componentView)
            this.componentView.destroy();
        else
            this.element.parentElement.removeChild(this.element);
        this.controlConfig.destroy(this.controlId);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9tLW1hbmlwdWxhdGlvbi5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0ByeHdlYi9yZWFjdGl2ZS1keW5hbWljLWZvcm1zLyIsInNvdXJjZXMiOlsiZG9tYWluL2RvbS9kb20tbWFuaXB1bGF0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLGdCQUFnQixFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDeEgsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQzNELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBRzVELE1BQU0sT0FBTyxlQUFnQixTQUFRLGtCQUFrQjtJQWFuRCxZQUFZLFVBQWUsRUFBRSxXQUFtQixFQUFFLGlCQUFvQztRQUNsRixLQUFLLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQWI3QixvQkFBZSxHQUFZLEtBQUssQ0FBQztRQUNqQyxnQkFBVyxHQUFhLEVBQUUsQ0FBQztRQUMzQixpQkFBWSxHQUFXLENBQUMsQ0FBQztRQUt6QixtQkFBYyxHQUFVLEVBQUUsQ0FBQztRQUVuQixvQkFBZSxHQUEyQixFQUFFLENBQUM7UUFDN0MsbUJBQWMsR0FBVSxFQUFFLENBQUM7UUFJL0IsSUFBSSxDQUFDLFFBQVEsR0FBRyxXQUFXLENBQUM7UUFDNUIsS0FBSyxDQUFDLGlCQUFpQixDQUFDLFVBQVUsRUFBRSxXQUFXLENBQUMsQ0FBQztRQUNqRCxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztRQUM3QixJQUFJLENBQUMsU0FBUyxHQUFHLFlBQVksQ0FBQyxTQUFTLEdBQUcsWUFBWSxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUM7UUFDckUsWUFBWSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsSUFBSSxDQUFDO1FBQzdDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLFNBQVMsRUFBQyxLQUFLLENBQUMsQ0FBQztJQUNwRSxDQUFDO0lBRUQsV0FBVyxDQUFDLE9BQStCLEVBQUUsV0FBb0I7UUFDN0QsSUFBSSxDQUFDLFNBQVMsR0FBRyxPQUFPLENBQUM7UUFDekIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsV0FBVyxDQUFDLENBQUE7UUFDbEMsSUFBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUMvQixJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztJQUNoQyxDQUFDO0lBRU8sb0JBQW9CO1FBQ3hCLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUMsTUFBTSxHQUFHLENBQUM7WUFDM0MsSUFBSSxDQUFDLGFBQWEsQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7Z0JBQ2hGLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFBO1lBQzFCLENBQUMsQ0FBQyxDQUFBO0lBQ1YsQ0FBQztJQUNELE9BQU8sQ0FBQyxPQUErQixFQUFFLFdBQW9CO1FBQ3pELE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQ3BDLFFBQVEsUUFBUSxFQUFFO2dCQUNkLEtBQUssSUFBSTtvQkFDTCxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRSxXQUFXLENBQUMsQ0FBQztvQkFDOUMsTUFBTTtnQkFDVixLQUFLLElBQUk7b0JBQ0wsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUUsV0FBVyxDQUFDLENBQUM7b0JBQ25ELE1BQU07Z0JBQ1YsS0FBSyxNQUFNO29CQUNQLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFLFdBQVcsQ0FBQyxDQUFDO29CQUNoRCxNQUFNO2dCQUNWLEtBQUssTUFBTTtvQkFDUCxJQUFJLENBQUMsV0FBVyxFQUFFO3dCQUNkLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxpQkFBaUI7NEJBQ2pDLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO3dCQUN4RCxJQUFJLENBQUMsaUJBQWlCLENBQUMsc0JBQXNCLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDLGlCQUFpQixDQUFDLGlCQUFpQixFQUFFLEtBQUssQ0FBQyxDQUFDO3FCQUNoTDs7d0JBQ0csSUFBSSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7b0JBQ3JELE1BQU07YUFDYjtRQUNMLENBQUMsQ0FBQyxDQUFBO0lBQ04sQ0FBQztJQUNELFlBQVksQ0FBQyxXQUFvQjtRQUM3QixRQUFRLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDbkIsS0FBSyxLQUFLLENBQUM7WUFDWCxLQUFLLE1BQU0sQ0FBQztZQUNaLEtBQUssUUFBUTtnQkFDVCxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsWUFBWSxJQUFJLFNBQVMsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVk7b0JBQ3ZFLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO2dCQUM3QixJQUFJLENBQUMsbUJBQW1CLENBQUMsUUFBUSxFQUFFLElBQUksRUFBRSxnQkFBZ0IsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFBO2dCQUM1RSxJQUFJLElBQUksQ0FBQyxhQUFhLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsZ0JBQWdCO29CQUM3RixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLGdCQUFnQixFQUFFLFdBQVcsQ0FBQyxDQUFDO2dCQUMxRSxNQUFNO1NBQ2I7SUFDTCxDQUFDO0lBR0QscUJBQXFCO1FBQ2pCLElBQUksaUJBQWlCLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLGlCQUFpQixDQUFDO1FBQ2pFLElBQUksaUJBQWlCLElBQUksaUJBQWlCLENBQUMsS0FBSyxFQUFFO1lBQzlDLElBQUksQ0FBQyxRQUFRLENBQUMsaUJBQWlCLENBQUMsS0FBSyxFQUFFLGdCQUFnQixDQUFDLENBQUM7WUFDekQsSUFBSSxpQkFBaUIsQ0FBQyxhQUFhO2dCQUMvQixpQkFBaUIsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsZ0JBQWdCLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQyxDQUFBO1NBQzFIO0lBQ0wsQ0FBQztJQUVELE9BQU87UUFDSCxJQUFJLFVBQVUsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQztRQUM1QyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsVUFBVSxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQ2pDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUN6QixJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7U0FDcEM7UUFDRCxJQUFJLENBQUMsY0FBYyxHQUFHLEVBQUUsQ0FBQztRQUN6QixJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7UUFDNUIsSUFBSSxJQUFJLENBQUMsYUFBYTtZQUNsQixJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sRUFBRSxDQUFDOztZQUU3QixJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFBO1FBQ3hELElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUMvQyxDQUFDO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTT1VSQ0UsIFNFTEVDVCwgQURESVRJT05BTF9DTEFTUywgUFJPUCwgQVRUUiwgRVZFTlRTLCBJTlBVVCwgVEVYVEFSRUEsIFJFQURPTkxZIH0gZnJvbSAnLi4vLi4vY29uc3QvYXBwLmNvbnN0JztcclxuaW1wb3J0IHsgQ29udHJvbFN0YXRlIH0gZnJvbSAnLi4vLi4vc3RhdGljcy9jb250cm9sLXN0YXRlJztcclxuaW1wb3J0IHsgT3ZlcnJpZGVPYmplY3RQcm9wIH0gZnJvbSBcIi4vb3ZlcnJpZGUtb2JqZWN0LXByb3BcIjtcclxuaW1wb3J0IHsgRHluYW1pY05vZGVDb25maWcgfSBmcm9tIFwiLi4vLi4vbW9kZWxzL2ludGVyZmFjZS9keW5hbWljLW5vZGUtY29uZmlnXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgRG9tTWFuaXB1bGF0aW9uIGV4dGVuZHMgT3ZlcnJpZGVPYmplY3RQcm9wIHtcclxuICAgIGlzQ29tcG9uZW50VmlldzogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgc3Vic2NyaWJlcnM6IHN0cmluZ1tdID0gW107XHJcbiAgICBlbGVtZW50SW5kZXg6IG51bWJlciA9IDA7XHJcbiAgICBjb21tZW50Tm9kZTogYW55O1xyXG4gICAgbm9kZU5hbWU6IHN0cmluZztcclxuICAgIGRvbUNvbmZpZzogeyBba2V5OiBzdHJpbmddOiBhbnkgfTtcclxuICAgIGVsZW1lbnQ6IGFueTtcclxuICAgIGV2ZW50TGlzdGVuZXJzOiBhbnlbXSA9IFtdO1xyXG4gICAgY29udHJvbElkOiBudW1iZXI7XHJcbiAgICBwcml2YXRlIGFjdGlvbkxpc3RlbmVyczogeyBba2V5OiBzdHJpbmddOiBhbnkgfSA9IHt9O1xyXG4gICAgcHJpdmF0ZSBlbGVtZW50Q2xhc3NlczogYW55W10gPSBbXTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihwYXJlbnROb2RlOiBhbnksIGVsZW1lbnROYW1lOiBzdHJpbmcsIGR5bmFtaWNOb2RlQ29uZmlnOiBEeW5hbWljTm9kZUNvbmZpZykge1xyXG4gICAgICAgIHN1cGVyKGR5bmFtaWNOb2RlQ29uZmlnKTtcclxuICAgICAgICB0aGlzLm5vZGVOYW1lID0gZWxlbWVudE5hbWU7XHJcbiAgICAgICAgc3VwZXIuY3JlYXRlTm9kZUVsZW1lbnQocGFyZW50Tm9kZSwgZWxlbWVudE5hbWUpO1xyXG4gICAgICAgIHRoaXMuYmluZEFkZGl0aW9uYWxDbGFzc2VzKCk7XHJcbiAgICAgICAgdGhpcy5jb250cm9sSWQgPSBDb250cm9sU3RhdGUuY29udHJvbElkID0gQ29udHJvbFN0YXRlLmNvbnRyb2xJZCArIDE7XHJcbiAgICAgICAgQ29udHJvbFN0YXRlLmNvbnRyb2xzW3RoaXMuY29udHJvbElkXSA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5hZGRPclJlbW92ZUF0dHJpYnV0ZShcImRhdGEtcnh3ZWJpZFwiLCB0aGlzLmNvbnRyb2xJZCxmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcGFyc2VPYmplY3Qoak9iamVjdDogeyBba2V5OiBzdHJpbmddOiBhbnkgfSwgaXNTdWJzY3JpYmU6IGJvb2xlYW4pIHtcclxuICAgICAgICB0aGlzLmRvbUNvbmZpZyA9IGpPYmplY3Q7XHJcbiAgICAgICAgdGhpcy5wcm9jZXNzKGpPYmplY3QsIGlzU3Vic2NyaWJlKVxyXG4gICAgICAgIHRoaXMub3ZlcnJpZGVQcm9wKGlzU3Vic2NyaWJlKTtcclxuICAgICAgICB0aGlzLnN1YnNjcmliZVZhbHVlQ2hhbmdlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzdWJzY3JpYmVWYWx1ZUNoYW5nZSgpIHtcclxuICAgICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5zdWJzY3JpYmVQcm9wcykubGVuZ3RoID4gMClcclxuICAgICAgICAgICAgdGhpcy5jb250cm9sQ29uZmlnLm9uUHJvcFZhbHVlQ2hhbmdlZCh0aGlzLmNvbnRyb2xJZCwgdGhpcy5zdWJzY3JpYmVQcm9wcywgKHgsIHkpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMucHJvY2Vzcyh4LCBmYWxzZSlcclxuICAgICAgICAgICAgfSlcclxuICAgIH1cclxuICAgIHByb2Nlc3Moak9iamVjdDogeyBba2V5OiBzdHJpbmddOiBhbnkgfSwgaXNTdWJzY3JpYmU6IGJvb2xlYW4pIHtcclxuICAgICAgICBPYmplY3Qua2V5cyhqT2JqZWN0KS5mb3JFYWNoKHByb3BOYW1lID0+IHtcclxuICAgICAgICAgICAgc3dpdGNoIChwcm9wTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSBQUk9QOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYmluZFByb3Aoak9iamVjdFtwcm9wTmFtZV0sIGlzU3Vic2NyaWJlKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgQVRUUjpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmJpbmRBdHRyaWJ1dGUoak9iamVjdFtwcm9wTmFtZV0sIGlzU3Vic2NyaWJlKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgRVZFTlRTOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYmluZEV2ZW50cyhqT2JqZWN0W3Byb3BOYW1lXSwgaXNTdWJzY3JpYmUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBTT1VSQ0U6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc1N1YnNjcmliZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAodGhpcy5lbGVtZW50LmZpcnN0RWxlbWVudENoaWxkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVDaGlsZHJlbih0aGlzLmVsZW1lbnQuZmlyc3RFbGVtZW50Q2hpbGQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmR5bmFtaWNOb2RlQ29uZmlnLmNvbnRyb2xDb25maWdQcm9jZXNzb3IuY3JlYXRlQ2hpbGRyZW5zKHRoaXMuZHluYW1pY05vZGVDb25maWcuY29sbGVjdGlvbnMsIHRoaXMsIHRoaXMuY29udHJvbENvbmZpZywgdGhpcy5keW5hbWljTm9kZUNvbmZpZy5hZGRpdGlvbmFsQ2xhc3NlcywgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFByb3BTdWJzY3JpcHRpb24oU09VUkNFLCBTT1VSQ0UsIFNPVVJDRSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgfVxyXG4gICAgb3ZlcnJpZGVQcm9wKGlzU3Vic2NyaWJlOiBib29sZWFuKSB7XHJcbiAgICAgICAgc3dpdGNoICh0aGlzLm5vZGVOYW1lKSB7XHJcbiAgICAgICAgICAgIGNhc2UgSU5QVVQ6XHJcbiAgICAgICAgICAgIGNhc2UgU0VMRUNUOlxyXG4gICAgICAgICAgICBjYXNlIFRFWFRBUkVBOlxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZG9tQ29uZmlnLm92ZXJyaWRlUHJvcCA9PSB1bmRlZmluZWQgfHwgdGhpcy5kb21Db25maWcub3ZlcnJpZGVQcm9wKVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3ZlcnJpZGVWYWx1ZVByb3AoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0UHJvcFN1YnNjcmlwdGlvbihSRUFET05MWSwgQVRUUiwgQURESVRJT05BTF9DTEFTUywgQURESVRJT05BTF9DTEFTUylcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbnRyb2xDb25maWcgJiYgdGhpcy5jb250cm9sQ29uZmlnLmNvbmZpZyAmJiB0aGlzLmNvbnRyb2xDb25maWcuY29uZmlnLmFkZGl0aW9uYWxDb25maWcpIFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvY2Vzcyh0aGlzLmNvbnRyb2xDb25maWcuY29uZmlnLmFkZGl0aW9uYWxDb25maWcsIGlzU3Vic2NyaWJlKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgYmluZEFkZGl0aW9uYWxDbGFzc2VzKCkge1xyXG4gICAgICAgIGxldCBhZGRpdGlvbmFsQ2xhc3NlcyA9IHRoaXMuZHluYW1pY05vZGVDb25maWcuYWRkaXRpb25hbENsYXNzZXM7XHJcbiAgICAgICAgaWYgKGFkZGl0aW9uYWxDbGFzc2VzICYmIGFkZGl0aW9uYWxDbGFzc2VzLmNsYXNzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q2xhc3MoYWRkaXRpb25hbENsYXNzZXMuY2xhc3MsIEFERElUSU9OQUxfQ0xBU1MpO1xyXG4gICAgICAgICAgICBpZiAoYWRkaXRpb25hbENsYXNzZXMubGlzdGVuZXJQcm9wcylcclxuICAgICAgICAgICAgICAgIGFkZGl0aW9uYWxDbGFzc2VzLmxpc3RlbmVyUHJvcHMuZm9yRWFjaCh0ID0+IHRoaXMuc2V0UHJvcFN1YnNjcmlwdGlvbih0LCBBVFRSLCBBRERJVElPTkFMX0NMQVNTLCBBRERJVElPTkFMX0NMQVNTKSlcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZGVzdHJveSgpIHtcclxuICAgICAgICBsZXQgZXZlbnRDb3VudCA9IHRoaXMuZXZlbnRMaXN0ZW5lcnMubGVuZ3RoO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZXZlbnRDb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZXZlbnRMaXN0ZW5lcnNbMF0oKTtcclxuICAgICAgICAgICAgdGhpcy5ldmVudExpc3RlbmVycy5zcGxpY2UoMCwgMSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZXZlbnRMaXN0ZW5lcnMgPSBbXTtcclxuICAgICAgICB0aGlzLmVsZW1lbnQub25DbGljayA9IG51bGw7XHJcbiAgICAgICAgaWYgKHRoaXMuY29tcG9uZW50VmlldylcclxuICAgICAgICAgICAgdGhpcy5jb21wb25lbnRWaWV3LmRlc3Ryb3koKTtcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5wYXJlbnRFbGVtZW50LnJlbW92ZUNoaWxkKHRoaXMuZWxlbWVudClcclxuICAgICAgICB0aGlzLmNvbnRyb2xDb25maWcuZGVzdHJveSh0aGlzLmNvbnRyb2xJZCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbiJdfQ==