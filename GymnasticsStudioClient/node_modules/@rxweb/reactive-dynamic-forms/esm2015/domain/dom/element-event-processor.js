import { ElementAccessor } from './element-accessor';
import { CONDITIONAL_VALIDATOR, BLUR, FOCUS, SELECT, INPUT, CLICK, EVENTS } from '../../const/app.const';
export class ElementEventProcessor extends ElementAccessor {
    constructor(dynamicNodeConfig) {
        super(dynamicNodeConfig);
        this.dynamicNodeConfig = dynamicNodeConfig;
    }
    bindEvents(events, isSubscribe) {
        Object.keys(events).forEach(eventName => {
            switch (eventName) {
                case FOCUS:
                    this.setFocus(this.getValue(events[eventName]));
                    break;
                case SELECT:
                case INPUT:
                    this.setInput();
                    break;
                case BLUR:
                    this.setBlur();
                    break;
                case CLICK:
                    this.setClick(this.getValue(events[eventName]));
                    break;
            }
            if (isSubscribe && this.isSubscribeProp(events[eventName]))
                this.setPropSubscription(this.getPropName(events[eventName]), EVENTS, eventName);
        });
    }
    setClick(functionName) {
        this.element.onclick = () => {
            if (this.controlConfig[functionName])
                this.controlConfig[functionName].call(this.controlConfig);
        };
    }
    setFocus(value) {
        if (value && this.element.focus)
            setTimeout(t => { this.element.focus(); }, 1000);
    }
    setBlur() {
        let listen = this.dynamicNodeConfig.renderer.listen(this.element, BLUR, () => {
            this.dynamicNodeConfig.controlConfig.formControl.markAsTouched();
        });
        this.eventListeners.push(listen);
    }
    setInput() {
        let listen = this.dynamicNodeConfig.renderer.listen(this.element, INPUT, (v) => {
            let isPassed = true;
            if (this.controlConfig.hooks && this.controlConfig.hooks.preValue) {
                isPassed = this.controlConfig.hooks.preValue.call(this.controlConfig, v.target.value);
                if (!isPassed) {
                    this.controlConfig.formControl.patchValue(this.controlConfig.formControl.value);
                    this.resetElementValue(this.controlConfig.formControl.value);
                }
            }
            if (isPassed) {
                this.setControlConfigValue(v.target);
                if (this.controlConfig.hooks && this.controlConfig.hooks.postValue)
                    this.controlConfig.hooks.postValue.call(this.controlConfig);
                this.controlConfig.formControl.markAsDirty();
            }
            if (this.conditionalValidator)
                this.conditionalValidator(this.controlConfig.formControl);
        });
        this.eventListeners.push(listen);
        setTimeout(() => {
            if (this.controlConfig.formControl[CONDITIONAL_VALIDATOR]) {
                this.conditionalValidator = this.controlConfig.formControl[CONDITIONAL_VALIDATOR];
                delete this.controlConfig.formControl[CONDITIONAL_VALIDATOR];
            }
        }, 50);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWxlbWVudC1ldmVudC1wcm9jZXNzb3IuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Acnh3ZWIvcmVhY3RpdmUtZHluYW1pYy1mb3Jtcy8iLCJzb3VyY2VzIjpbImRvbWFpbi9kb20vZWxlbWVudC1ldmVudC1wcm9jZXNzb3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBRXJELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBR3pHLE1BQU0sT0FBTyxxQkFBc0IsU0FBUSxlQUFlO0lBR3RELFlBQW1CLGlCQUFvQztRQUFJLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBQWpFLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7SUFBOEIsQ0FBQztJQUV0RixVQUFVLENBQUMsTUFBOEIsRUFBQyxXQUFtQjtRQUN6RCxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsRUFBRTtZQUNwQyxRQUFRLFNBQVMsRUFBRTtnQkFDZixLQUFLLEtBQUs7b0JBQ04sSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ2hELE1BQU07Z0JBQ1YsS0FBSyxNQUFNLENBQUM7Z0JBQ1osS0FBSyxLQUFLO29CQUNOLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztvQkFDaEIsTUFBTTtnQkFDVixLQUFLLElBQUk7b0JBQ0wsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO29CQUNmLE1BQU07Z0JBQ1YsS0FBSyxLQUFLO29CQUNOLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENB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QyxXQUFXLENBQUMsQ0FBQztRQUNsRSxDQUFDLENBQUMsQ0FBQTtRQUNGLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2pDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7WUFDWixJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLHFCQUFxQixDQUFDLEVBQUU7Z0JBQ3ZELElBQUksQ0FBQyxvQkFBb0IsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO2dCQUNsRixPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLHFCQUFxQixDQUFDLENBQUM7YUFDaEU7UUFDTCxDQUFDLEVBQUMsRUFBRSxDQUFDLENBQUE7SUFHVCxDQUFDO0NBSUoiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFbGVtZW50QWNjZXNzb3IgfSBmcm9tICcuL2VsZW1lbnQtYWNjZXNzb3InO1xyXG5pbXBvcnQgeyBEeW5hbWljTm9kZUNvbmZpZyB9IGZyb20gJy4uLy4uL21vZGVscy9pbnRlcmZhY2UvZHluYW1pYy1ub2RlLWNvbmZpZyc7XHJcbmltcG9ydCB7IENPTkRJVElPTkFMX1ZBTElEQVRPUiwgQkxVUiwgRk9DVVMsIFNFTEVDVCwgSU5QVVQsIENMSUNLLCBFVkVOVFMgfSBmcm9tICcuLi8uLi9jb25zdC9hcHAuY29uc3QnO1xyXG5pbXBvcnQgeyBWYWxpZGF0b3JGbiB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuXHJcbmV4cG9ydCBjbGFzcyBFbGVtZW50RXZlbnRQcm9jZXNzb3IgZXh0ZW5kcyBFbGVtZW50QWNjZXNzb3J7XHJcbiAgICBldmVudExpc3RlbmVyczogYW55W107XHJcbiAgICBwcml2YXRlIGNvbmRpdGlvbmFsVmFsaWRhdG9yOiBWYWxpZGF0b3JGbjtcclxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBkeW5hbWljTm9kZUNvbmZpZzogRHluYW1pY05vZGVDb25maWcpIHsgc3VwZXIoZHluYW1pY05vZGVDb25maWcpOyB9XHJcblxyXG4gICAgYmluZEV2ZW50cyhldmVudHM6IHsgW2tleTogc3RyaW5nXTogYW55IH0saXNTdWJzY3JpYmU6Ym9vbGVhbikge1xyXG4gICAgICAgIE9iamVjdC5rZXlzKGV2ZW50cykuZm9yRWFjaChldmVudE5hbWUgPT4ge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKGV2ZW50TmFtZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSBGT0NVUzpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEZvY3VzKHRoaXMuZ2V0VmFsdWUoZXZlbnRzW2V2ZW50TmFtZV0pKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgU0VMRUNUOlxyXG4gICAgICAgICAgICAgICAgY2FzZSBJTlBVVDpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldElucHV0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIEJMVVI6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRCbHVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIENMSUNLOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0Q2xpY2sodGhpcy5nZXRWYWx1ZShldmVudHNbZXZlbnROYW1lXSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpc1N1YnNjcmliZSAmJiB0aGlzLmlzU3Vic2NyaWJlUHJvcChldmVudHNbZXZlbnROYW1lXSkpXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldFByb3BTdWJzY3JpcHRpb24odGhpcy5nZXRQcm9wTmFtZShldmVudHNbZXZlbnROYW1lXSksIEVWRU5UUywgZXZlbnROYW1lKTtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIHNldENsaWNrKGZ1bmN0aW9uTmFtZTpzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLmVsZW1lbnQub25jbGljayA9ICgpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuY29udHJvbENvbmZpZ1tmdW5jdGlvbk5hbWVdKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5jb250cm9sQ29uZmlnW2Z1bmN0aW9uTmFtZV0uY2FsbCh0aGlzLmNvbnRyb2xDb25maWcpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzZXRGb2N1cyh2YWx1ZTogYm9vbGVhbikge1xyXG4gICAgICAgIGlmICh2YWx1ZSAmJiB0aGlzLmVsZW1lbnQuZm9jdXMpIFxyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KHQgPT4geyB0aGlzLmVsZW1lbnQuZm9jdXMoKX0gLCAxMDAwKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRCbHVyKCkge1xyXG4gICAgICAgIGxldCBsaXN0ZW4gPSB0aGlzLmR5bmFtaWNOb2RlQ29uZmlnLnJlbmRlcmVyLmxpc3Rlbih0aGlzLmVsZW1lbnQsIEJMVVIsICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5keW5hbWljTm9kZUNvbmZpZy5jb250cm9sQ29uZmlnLmZvcm1Db250cm9sLm1hcmtBc1RvdWNoZWQoKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIHRoaXMuZXZlbnRMaXN0ZW5lcnMucHVzaChsaXN0ZW4pO1xyXG4gICAgfVxyXG5cclxuICAgIHNldElucHV0KCkge1xyXG4gICAgICAgIGxldCBsaXN0ZW4gPSB0aGlzLmR5bmFtaWNOb2RlQ29uZmlnLnJlbmRlcmVyLmxpc3Rlbih0aGlzLmVsZW1lbnQsIElOUFVULCAodikgPT4ge1xyXG4gICAgICAgICAgICBsZXQgaXNQYXNzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jb250cm9sQ29uZmlnLmhvb2tzICYmIHRoaXMuY29udHJvbENvbmZpZy5ob29rcy5wcmVWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgaXNQYXNzZWQgPSB0aGlzLmNvbnRyb2xDb25maWcuaG9va3MucHJlVmFsdWUuY2FsbCh0aGlzLmNvbnRyb2xDb25maWcsdi50YXJnZXQudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFpc1Bhc3NlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbENvbmZpZy5mb3JtQ29udHJvbC5wYXRjaFZhbHVlKHRoaXMuY29udHJvbENvbmZpZy5mb3JtQ29udHJvbC52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNldEVsZW1lbnRWYWx1ZSh0aGlzLmNvbnRyb2xDb25maWcuZm9ybUNvbnRyb2wudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpc1Bhc3NlZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRDb250cm9sQ29uZmlnVmFsdWUodi50YXJnZXQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY29udHJvbENvbmZpZy5ob29rcyAmJiB0aGlzLmNvbnRyb2xDb25maWcuaG9va3MucG9zdFZhbHVlKVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbENvbmZpZy5ob29rcy5wb3N0VmFsdWUuY2FsbCh0aGlzLmNvbnRyb2xDb25maWcpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb250cm9sQ29uZmlnLmZvcm1Db250cm9sLm1hcmtBc0RpcnR5KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuY29uZGl0aW9uYWxWYWxpZGF0b3IpXHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmRpdGlvbmFsVmFsaWRhdG9yKHRoaXMuY29udHJvbENvbmZpZy5mb3JtQ29udHJvbCk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICB0aGlzLmV2ZW50TGlzdGVuZXJzLnB1c2gobGlzdGVuKTtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuY29udHJvbENvbmZpZy5mb3JtQ29udHJvbFtDT05ESVRJT05BTF9WQUxJREFUT1JdKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmRpdGlvbmFsVmFsaWRhdG9yID0gdGhpcy5jb250cm9sQ29uZmlnLmZvcm1Db250cm9sW0NPTkRJVElPTkFMX1ZBTElEQVRPUl07XHJcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5jb250cm9sQ29uZmlnLmZvcm1Db250cm9sW0NPTkRJVElPTkFMX1ZBTElEQVRPUl07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LDUwKVxyXG4gICAgICAgIFxyXG5cclxuICAgIH1cclxuXHJcblxyXG4gICAgXHJcbn0iXX0=