import { ElementEventProcessor } from './element-event-processor';
import { ADDITIONAL_CLASS, BOOLEAN, NONE, BLANK, DISPLAY, FUNCTION, STRING, ATTR, PROP, CLASS, STYLE } from '../../const/app.const';
export class ElementPropsAccessor extends ElementEventProcessor {
    constructor(dynamicNodeConfig) {
        super(dynamicNodeConfig);
        this.oldAdditionalClasses = [];
        this.oldClasses = [];
    }
    bindAttribute(attr, isSubscribe) {
        Object.keys(attr).forEach(attributeName => {
            let value = (attributeName !== STYLE) ? this.getValue(attr[attributeName]) : attr[attributeName];
            switch (attributeName) {
                case ADDITIONAL_CLASS:
                case CLASS:
                    this.setClass(value, attributeName);
                    break;
                case STYLE:
                    Object.keys(attr[attributeName]).forEach(x => {
                        let value = this.getValue(attr[attributeName][x]);
                        this.setStyleProp(x, value);
                        if (isSubscribe && this.isSubscribeProp(attr[attributeName][x]))
                            this.setPropSubscription(attr[attributeName][x], ATTR, x, '', STYLE);
                    });
                    break;
                default:
                    this.addOrRemoveAttribute(attributeName, value, attr[attributeName] === "");
                    break;
            }
            if (isSubscribe && attributeName !== STYLE && this.isSubscribeProp(attr[attributeName]))
                this.setPropSubscription(attr[attributeName], ATTR, attributeName);
        });
    }
    bindProp(prop, isSubscribe) {
        Object.keys(prop).forEach(propName => {
            let value = this.getValue(prop[propName]);
            this.setProperty(propName, (value !== undefined && value !== null && value !== false) ? value : "");
            if (isSubscribe && this.isSubscribeProp(prop[propName]))
                this.setPropSubscription(prop[propName], PROP, propName);
        });
    }
    setClass(classes, type) {
        classes = this.getClassNames(type == ADDITIONAL_CLASS ? this.dynamicNodeConfig.additionalClasses.class : classes);
        type == ADDITIONAL_CLASS ? this.addOrRemoveClasses(this.oldAdditionalClasses, false) : this.addOrRemoveClasses(this.oldClasses, false);
        this.addOrRemoveClasses(classes);
        switch (type) {
            case ADDITIONAL_CLASS:
                this.oldAdditionalClasses = classes;
                break;
            case CLASS:
                this.oldClasses = classes;
                break;
        }
    }
    setStyleProp(propName, value) {
        switch (propName) {
            case DISPLAY:
                value = (typeof value == BOOLEAN || value === undefined) ? value : !(value);
                value = (value) ? NONE : BLANK;
                break;
        }
        this.addOrRemoveStyle(propName, value);
    }
    setProperty(propertyName, value) {
        this.dynamicNodeConfig.renderer.setProperty(this.element, propertyName, value);
    }
    addOrRemoveClasses(classes, isAdd = true) {
        if (isAdd)
            classes.forEach(t => this.dynamicNodeConfig.renderer.addClass(this.element, t));
        else
            classes.forEach(t => this.dynamicNodeConfig.renderer.removeClass(this.element, t));
    }
    addOrRemoveStyle(styleName, value) {
        if (value)
            this.dynamicNodeConfig.renderer.setStyle(this.element, styleName, value);
        else
            this.dynamicNodeConfig.renderer.removeStyle(this.element, styleName);
    }
    addOrRemoveAttribute(attributeName, value, isBlank) {
        if (value || isBlank)
            this.dynamicNodeConfig.renderer.setAttribute(this.element, attributeName, value);
        else
            this.dynamicNodeConfig.renderer.removeAttribute(this.element, attributeName);
    }
    getClassNames(classes) {
        let elementClasses = [];
        if (classes)
            classes.forEach(t => {
                if (typeof t == STRING)
                    elementClasses.push(t);
                else if (typeof t == FUNCTION) {
                    let elementClass = t.call(this.controlConfig);
                    if (elementClass && !Array.isArray(elementClass))
                        elementClasses.push(elementClass);
                    else if (Array.isArray(elementClass))
                        elementClass.forEach(x => elementClasses.push(x));
                }
            });
        return elementClasses;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWxlbWVudC1wcm9wcy1hY2Nlc3Nvci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0ByeHdlYi9yZWFjdGl2ZS1keW5hbWljLWZvcm1zLyIsInNvdXJjZXMiOlsiZG9tYWluL2RvbS9lbGVtZW50LXByb3BzLWFjY2Vzc29yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBRWxFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUVwSSxNQUFNLE9BQWdCLG9CQUFxQixTQUFRLHFCQUFxQjtJQUdwRSxZQUFZLGlCQUFvQztRQUFJLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBRnJFLHlCQUFvQixHQUFhLEVBQUUsQ0FBQztRQUNwQyxlQUFVLEdBQWEsRUFBRSxDQUFDO0lBQzRDLENBQUM7SUFHL0UsYUFBYSxDQUFDLElBQTRCLEVBQUUsV0FBb0I7UUFDNUQsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLEVBQUU7WUFDdEMsSUFBSSxLQUFLLEdBQUcsQ0FBQyxhQUFhLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUNqRyxRQUFRLGFBQWEsRUFBRTtnQkFDbkIsS0FBSyxnQkFBZ0IsQ0FBQztnQkFDdEIsS0FBSyxLQUFLO29CQUNOLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLGFBQWEsQ0FBQyxDQUFDO29CQUNwQyxNQUFNO2dCQUNWLEtBQUssS0FBSztv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QUE7aUJBQ3hEO1lBQ0wsQ0FBQyxDQUFDLENBQUE7UUFDTixPQUFPLGNBQWMsQ0FBQztJQUMxQixDQUFDO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFbGVtZW50RXZlbnRQcm9jZXNzb3IgfSBmcm9tICcuL2VsZW1lbnQtZXZlbnQtcHJvY2Vzc29yJztcclxuaW1wb3J0IHsgRHluYW1pY05vZGVDb25maWcgfSBmcm9tICcuLi8uLi9tb2RlbHMvaW50ZXJmYWNlL2R5bmFtaWMtbm9kZS1jb25maWcnO1xyXG5pbXBvcnQgeyBBRERJVElPTkFMX0NMQVNTLCBCT09MRUFOLCBOT05FLCBCTEFOSywgRElTUExBWSwgRlVOQ1RJT04sIFNUUklORywgQVRUUiwgUFJPUCwgQ0xBU1MsIFNUWUxFIH0gZnJvbSAnLi4vLi4vY29uc3QvYXBwLmNvbnN0JztcclxuXHJcbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBFbGVtZW50UHJvcHNBY2Nlc3NvciBleHRlbmRzIEVsZW1lbnRFdmVudFByb2Nlc3NvciB7XHJcbiAgICBwcml2YXRlIG9sZEFkZGl0aW9uYWxDbGFzc2VzOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgcHJpdmF0ZSBvbGRDbGFzc2VzOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgY29uc3RydWN0b3IoZHluYW1pY05vZGVDb25maWc6IER5bmFtaWNOb2RlQ29uZmlnKSB7IHN1cGVyKGR5bmFtaWNOb2RlQ29uZmlnKTsgfVxyXG5cclxuXHJcbiAgICBiaW5kQXR0cmlidXRlKGF0dHI6IHsgW2tleTogc3RyaW5nXTogYW55IH0sIGlzU3Vic2NyaWJlOiBib29sZWFuKSB7XHJcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cikuZm9yRWFjaChhdHRyaWJ1dGVOYW1lID0+IHtcclxuICAgICAgICAgICAgbGV0IHZhbHVlID0gKGF0dHJpYnV0ZU5hbWUgIT09IFNUWUxFKSA/IHRoaXMuZ2V0VmFsdWUoYXR0clthdHRyaWJ1dGVOYW1lXSkgOiBhdHRyW2F0dHJpYnV0ZU5hbWVdO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKGF0dHJpYnV0ZU5hbWUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgQURESVRJT05BTF9DTEFTUzpcclxuICAgICAgICAgICAgICAgIGNhc2UgQ0xBU1M6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRDbGFzcyh2YWx1ZSwgYXR0cmlidXRlTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFNUWUxFOlxyXG4gICAgICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKGF0dHJbYXR0cmlidXRlTmFtZV0pLmZvckVhY2goeCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB2YWx1ZSA9IHRoaXMuZ2V0VmFsdWUoYXR0clthdHRyaWJ1dGVOYW1lXVt4XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U3R5bGVQcm9wKHgsIHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzU3Vic2NyaWJlICYmIHRoaXMuaXNTdWJzY3JpYmVQcm9wKGF0dHJbYXR0cmlidXRlTmFtZV1beF0pKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRQcm9wU3Vic2NyaXB0aW9uKGF0dHJbYXR0cmlidXRlTmFtZV1beF0sIEFUVFIsIHgsICcnLCBTVFlMRSlcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZE9yUmVtb3ZlQXR0cmlidXRlKGF0dHJpYnV0ZU5hbWUsIHZhbHVlLCBhdHRyW2F0dHJpYnV0ZU5hbWVdID09PSBcIlwiKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoaXNTdWJzY3JpYmUgJiYgYXR0cmlidXRlTmFtZSAhPT0gU1RZTEUgJiYgdGhpcy5pc1N1YnNjcmliZVByb3AoYXR0clthdHRyaWJ1dGVOYW1lXSkpXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldFByb3BTdWJzY3JpcHRpb24oYXR0clthdHRyaWJ1dGVOYW1lXSwgQVRUUiwgYXR0cmlidXRlTmFtZSk7XHJcbiAgICAgICAgfSlcclxuXHJcbiAgICB9XHJcblxyXG4gICAgYmluZFByb3AocHJvcDogeyBba2V5OiBzdHJpbmddOiBhbnkgfSwgaXNTdWJzY3JpYmU6IGJvb2xlYW4pIHtcclxuICAgICAgICBPYmplY3Qua2V5cyhwcm9wKS5mb3JFYWNoKHByb3BOYW1lID0+IHtcclxuICAgICAgICAgICAgbGV0IHZhbHVlID0gdGhpcy5nZXRWYWx1ZShwcm9wW3Byb3BOYW1lXSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0UHJvcGVydHkocHJvcE5hbWUsICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSBmYWxzZSkgPyB2YWx1ZSA6IFwiXCIpXHJcbiAgICAgICAgICAgIGlmIChpc1N1YnNjcmliZSAmJiB0aGlzLmlzU3Vic2NyaWJlUHJvcChwcm9wW3Byb3BOYW1lXSkpXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldFByb3BTdWJzY3JpcHRpb24ocHJvcFtwcm9wTmFtZV0sIFBST1AsIHByb3BOYW1lKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRDbGFzcyhjbGFzc2VzOiBhbnlbXSwgdHlwZTogc3RyaW5nKSB7XHJcbiAgICAgICAgY2xhc3NlcyA9IHRoaXMuZ2V0Q2xhc3NOYW1lcyh0eXBlID09IEFERElUSU9OQUxfQ0xBU1MgPyB0aGlzLmR5bmFtaWNOb2RlQ29uZmlnLmFkZGl0aW9uYWxDbGFzc2VzLmNsYXNzIDogY2xhc3Nlcyk7XHJcbiAgICAgICAgdHlwZSA9PSBBRERJVElPTkFMX0NMQVNTID8gdGhpcy5hZGRPclJlbW92ZUNsYXNzZXModGhpcy5vbGRBZGRpdGlvbmFsQ2xhc3NlcywgZmFsc2UpIDogdGhpcy5hZGRPclJlbW92ZUNsYXNzZXModGhpcy5vbGRDbGFzc2VzLCBmYWxzZSk7XHJcbiAgICAgICAgdGhpcy5hZGRPclJlbW92ZUNsYXNzZXMoY2xhc3Nlcyk7XHJcbiAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgQURESVRJT05BTF9DTEFTUzpcclxuICAgICAgICAgICAgICAgIHRoaXMub2xkQWRkaXRpb25hbENsYXNzZXMgPSBjbGFzc2VzO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgQ0xBU1M6XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9sZENsYXNzZXMgPSBjbGFzc2VzO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldFN0eWxlUHJvcChwcm9wTmFtZTogc3RyaW5nLCB2YWx1ZTogYW55KSB7XHJcbiAgICAgICAgc3dpdGNoIChwcm9wTmFtZSkge1xyXG4gICAgICAgICAgICBjYXNlIERJU1BMQVk6XHJcbiAgICAgICAgICAgICAgICB2YWx1ZSA9ICh0eXBlb2YgdmFsdWUgPT0gQk9PTEVBTiB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkKSA/IHZhbHVlIDogISh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB2YWx1ZSA9ICh2YWx1ZSkgPyBOT05FIDogQkxBTks7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5hZGRPclJlbW92ZVN0eWxlKHByb3BOYW1lLCB2YWx1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0UHJvcGVydHkocHJvcGVydHlOYW1lOiBzdHJpbmcsIHZhbHVlOiBhbnkpIHtcclxuICAgICAgICB0aGlzLmR5bmFtaWNOb2RlQ29uZmlnLnJlbmRlcmVyLnNldFByb3BlcnR5KHRoaXMuZWxlbWVudCwgcHJvcGVydHlOYW1lLCB2YWx1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkT3JSZW1vdmVDbGFzc2VzKGNsYXNzZXM6IGFueVtdLCBpc0FkZDogYm9vbGVhbiA9IHRydWUpIHtcclxuXHJcbiAgICAgICAgaWYgKGlzQWRkKVxyXG4gICAgICAgICAgICBjbGFzc2VzLmZvckVhY2godCA9PiB0aGlzLmR5bmFtaWNOb2RlQ29uZmlnLnJlbmRlcmVyLmFkZENsYXNzKHRoaXMuZWxlbWVudCwgdCkpO1xyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgY2xhc3Nlcy5mb3JFYWNoKHQgPT4gdGhpcy5keW5hbWljTm9kZUNvbmZpZy5yZW5kZXJlci5yZW1vdmVDbGFzcyh0aGlzLmVsZW1lbnQsIHQpKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgYWRkT3JSZW1vdmVTdHlsZShzdHlsZU5hbWU6IHN0cmluZywgdmFsdWU6IGFueSkge1xyXG4gICAgICAgIGlmICh2YWx1ZSlcclxuICAgICAgICAgICAgdGhpcy5keW5hbWljTm9kZUNvbmZpZy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmVsZW1lbnQsIHN0eWxlTmFtZSwgdmFsdWUpO1xyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgdGhpcy5keW5hbWljTm9kZUNvbmZpZy5yZW5kZXJlci5yZW1vdmVTdHlsZSh0aGlzLmVsZW1lbnQsIHN0eWxlTmFtZSk7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkT3JSZW1vdmVBdHRyaWJ1dGUoYXR0cmlidXRlTmFtZTogc3RyaW5nLCB2YWx1ZTogYW55LGlzQmxhbms6Ym9vbGVhbikge1xyXG4gICAgICAgIGlmICh2YWx1ZSB8fCBpc0JsYW5rKVxyXG4gICAgICAgICAgICB0aGlzLmR5bmFtaWNOb2RlQ29uZmlnLnJlbmRlcmVyLnNldEF0dHJpYnV0ZSh0aGlzLmVsZW1lbnQsIGF0dHJpYnV0ZU5hbWUsIHZhbHVlKTtcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHRoaXMuZHluYW1pY05vZGVDb25maWcucmVuZGVyZXIucmVtb3ZlQXR0cmlidXRlKHRoaXMuZWxlbWVudCwgYXR0cmlidXRlTmFtZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRDbGFzc05hbWVzKGNsYXNzZXM6IGFueVtdKSB7XHJcbiAgICAgICAgbGV0IGVsZW1lbnRDbGFzc2VzID0gW107XHJcbiAgICAgICAgaWYgKGNsYXNzZXMpXHJcbiAgICAgICAgICAgIGNsYXNzZXMuZm9yRWFjaCh0ID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdCA9PSBTVFJJTkcpXHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudENsYXNzZXMucHVzaCh0KTtcclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB0ID09IEZVTkNUSU9OKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGVsZW1lbnRDbGFzcyA9IHQuY2FsbCh0aGlzLmNvbnRyb2xDb25maWcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50Q2xhc3MgJiYgIUFycmF5LmlzQXJyYXkoZWxlbWVudENsYXNzKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudENsYXNzZXMucHVzaChlbGVtZW50Q2xhc3MpXHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoQXJyYXkuaXNBcnJheShlbGVtZW50Q2xhc3MpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50Q2xhc3MuZm9yRWFjaCh4ID0+IGVsZW1lbnRDbGFzc2VzLnB1c2goeCkpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgcmV0dXJuIGVsZW1lbnRDbGFzc2VzO1xyXG4gICAgfVxyXG59Il19