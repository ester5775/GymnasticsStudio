import * as tslib_1 from "tslib";
import { SOURCE, SELECT, ADDITIONAL_CLASS, PROP, ATTR, EVENTS, INPUT, TEXTAREA, READONLY } from '../../const/app.const';
import { ControlState } from '../../statics/control-state';
import { OverrideObjectProp } from "./override-object-prop";
var DomManipulation = /** @class */ (function (_super) {
    tslib_1.__extends(DomManipulation, _super);
    function DomManipulation(parentNode, elementName, dynamicNodeConfig) {
        var _this = _super.call(this, dynamicNodeConfig) || this;
        _this.isComponentView = false;
        _this.subscribers = [];
        _this.elementIndex = 0;
        _this.eventListeners = [];
        _this.actionListeners = {};
        _this.elementClasses = [];
        _this.nodeName = elementName;
        _super.prototype.createNodeElement.call(_this, parentNode, elementName);
        _this.bindAdditionalClasses();
        _this.controlId = ControlState.controlId = ControlState.controlId + 1;
        ControlState.controls[_this.controlId] = _this;
        _this.addOrRemoveAttribute("data-rxwebid", _this.controlId, false);
        return _this;
    }
    DomManipulation.prototype.parseObject = function (jObject, isSubscribe) {
        this.domConfig = jObject;
        this.process(jObject, isSubscribe);
        this.overrideProp(isSubscribe);
        this.subscribeValueChange();
    };
    DomManipulation.prototype.subscribeValueChange = function () {
        var _this = this;
        if (Object.keys(this.subscribeProps).length > 0)
            this.controlConfig.onPropValueChanged(this.controlId, this.subscribeProps, function (x, y) {
                _this.process(x, false);
            });
    };
    DomManipulation.prototype.process = function (jObject, isSubscribe) {
        var _this = this;
        Object.keys(jObject).forEach(function (propName) {
            switch (propName) {
                case PROP:
                    _this.bindProp(jObject[propName], isSubscribe);
                    break;
                case ATTR:
                    _this.bindAttribute(jObject[propName], isSubscribe);
                    break;
                case EVENTS:
                    _this.bindEvents(jObject[propName], isSubscribe);
                    break;
                case SOURCE:
                    if (!isSubscribe) {
                        while (_this.element.firstElementChild)
                            _this.removeChildren(_this.element.firstElementChild);
                        _this.dynamicNodeConfig.controlConfigProcessor.createChildrens(_this.dynamicNodeConfig.collections, _this, _this.controlConfig, _this.dynamicNodeConfig.additionalClasses, false);
                    }
                    else
                        _this.setPropSubscription(SOURCE, SOURCE, SOURCE);
                    break;
            }
        });
    };
    DomManipulation.prototype.overrideProp = function (isSubscribe) {
        switch (this.nodeName) {
            case INPUT:
            case SELECT:
            case TEXTAREA:
                if (this.domConfig.overrideProp == undefined || this.domConfig.overrideProp)
                    this.overrideValueProp();
                this.setPropSubscription(READONLY, ATTR, ADDITIONAL_CLASS, ADDITIONAL_CLASS);
                if (this.controlConfig && this.controlConfig.config && this.controlConfig.config.additionalConfig)
                    this.process(this.controlConfig.config.additionalConfig, isSubscribe);
                break;
        }
    };
    DomManipulation.prototype.bindAdditionalClasses = function () {
        var _this = this;
        var additionalClasses = this.dynamicNodeConfig.additionalClasses;
        if (additionalClasses && additionalClasses.class) {
            this.setClass(additionalClasses.class, ADDITIONAL_CLASS);
            if (additionalClasses.listenerProps)
                additionalClasses.listenerProps.forEach(function (t) { return _this.setPropSubscription(t, ATTR, ADDITIONAL_CLASS, ADDITIONAL_CLASS); });
        }
    };
    DomManipulation.prototype.destroy = function () {
        var eventCount = this.eventListeners.length;
        for (var i = 0; i < eventCount; i++) {
            this.eventListeners[0]();
            this.eventListeners.splice(0, 1);
        }
        this.eventListeners = [];
        this.element.onClick = null;
        if (this.componentView)
            this.componentView.destroy();
        else
            this.element.parentElement.removeChild(this.element);
        this.controlConfig.destroy(this.controlId);
    };
    return DomManipulation;
}(OverrideObjectProp));
export { DomManipulation };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9tLW1hbmlwdWxhdGlvbi5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0ByeHdlYi9yZWFjdGl2ZS1keW5hbWljLWZvcm1zLyIsInNvdXJjZXMiOlsiZG9tYWluL2RvbS9kb20tbWFuaXB1bGF0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxnQkFBZ0IsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ3hILE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUMzRCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUc1RDtJQUFxQywyQ0FBa0I7SUFhbkQseUJBQVksVUFBZSxFQUFFLFdBQW1CLEVBQUUsaUJBQW9DO1FBQXRGLFlBQ0ksa0JBQU0saUJBQWlCLENBQUMsU0FPM0I7UUFwQkQscUJBQWUsR0FBWSxLQUFLLENBQUM7UUFDakMsaUJBQVcsR0FBYSxFQUFFLENBQUM7UUFDM0Isa0JBQVksR0FBVyxDQUFDLENBQUM7UUFLekIsb0JBQWMsR0FBVSxFQUFFLENBQUM7UUFFbkIscUJBQWUsR0FBMkIsRUFBRSxDQUFDO1FBQzdDLG9CQUFjLEdBQVUsRUFBRSxDQUFDO1FBSS9CLEtBQUksQ0FBQyxRQUFRLEdBQUcsV0FBVyxDQUFDO1FBQzVCLGlCQUFNLGlCQUFpQixhQUFDLFVBQVUsRUFBRSxXQUFXLENBQUMsQ0FBQztRQUNqRCxLQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztRQUM3QixLQUFJLENBQUMsU0FBUyxHQUFHLFlBQVksQ0FBQyxTQUFTLEdBQUcsWUFBWSxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUM7UUFDckUsWUFBWSxDQUFDLFFBQVEsQ0FBQyxLQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsS0FBSSxDQUFDO1FBQzdDLEtBQUksQ0FBQyxvQkFBb0IsQ0FBQyxjQUFjLEVBQUUsS0FBSSxDQUFDLFNBQVMsRUFBQyxLQUFLLENBQUMsQ0FBQzs7SUFDcEUsQ0FBQztJQUVELHFDQUFXLEdBQVgsVUFBWSxPQUErQixFQUFFLFdBQW9CO1FBQzdELElBQUksQ0FBQyxTQUFTLEdBQUcsT0FBTyxDQUFDO1FBQ3pCLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLFdBQVcsQ0FBQyxDQUFBO1FBQ2xDLElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDL0IsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUM7SUFDaEMsQ0FBQztJQUVPLDhDQUFvQixHQUE1QjtRQUFBLGlCQUtDO1FBSkcsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQztZQUMzQyxJQUFJLENBQUMsYUFBYSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLGNBQWMsRUFBRSxVQUFDLENBQUMsRUFBRSxDQUFDO2dCQUM1RSxLQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQTtZQUMxQixDQUFDLENBQUMsQ0FBQTtJQUNWLENBQUM7SUFDRCxpQ0FBTyxHQUFQLFVBQVEsT0FBK0IsRUFBRSxXQUFvQjtRQUE3RCxpQkFzQkM7UUFyQkcsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBQSxRQUFRO1lBQ2pDLFFBQVEsUUFBUSxFQUFFO2dCQUNkLEtBQUssSUFBSTtvQkFDTCxLQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRSxXQUFXLENBQUMsQ0FBQztvQkFDOUMsTUFBTTtnQkFDVixLQUFLLElBQUk7b0JBQ0wsS0FBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUUsV0FBVyxDQUFDLENBQUM7b0JBQ25ELE1BQU07Z0JBQ1YsS0FBSyxNQUFNO29CQUNQLEtBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFLFdBQVcsQ0FBQyxDQUFDO29CQUNoRCxNQUFNO2dCQUNWLEtBQUssTUFBTTtvQkFDUCxJQUFJLENBQUMsV0FBVyxFQUFFO3dCQUNkLE9BQU8sS0FBSSxDQUFDLE9BQU8sQ0FBQyxpQkFBaUI7NEJBQ2pDLEtBQUksQ0FBQyxjQUFjLENBQUMsS0FBSSxDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO3dCQUN4RCxLQUFJLENBQUMsaUJBQWlCLENBQUMsc0JBQXNCLENBQUMsZUFBZSxDQUFDLEtBQUksQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXLEVBQUUsS0FBSSxFQUFFLEtBQUksQ0FBQyxhQUFhLEVBQUUsS0FBSSxDQUFDLGlCQUFpQixDQUFDLGlCQUFpQixFQUFFLEtBQUssQ0FBQyxDQUFDO3FCQUNoTDs7d0JBQ0csS0FBSSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7b0JBQ3JELE1BQU07YUFDYjtRQUNMLENBQUMsQ0FBQyxDQUFBO0lBQ04sQ0FBQztJQUNELHNDQUFZLEdBQVosVUFBYSxXQUFvQjtRQUM3QixRQUFRLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDbkIsS0FBSyxLQUFLLENBQUM7WUFDWCxLQUFLLE1BQU0sQ0FBQztZQUNaLEtBQUssUUFBUTtnQkFDVCxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsWUFBWSxJQUFJLFNBQVMsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVk7b0JBQ3ZFLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO2dCQUM3QixJQUFJLENBQUMsbUJBQW1CLENBQUMsUUFBUSxFQUFFLElBQUksRUFBRSxnQkFBZ0IsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFBO2dCQUM1RSxJQUFJLElBQUksQ0FBQyxhQUFhLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsZ0JBQWdCO29CQUM3RixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLGdCQUFnQixFQUFFLFdBQVcsQ0FBQyxDQUFDO2dCQUMxRSxNQUFNO1NBQ2I7SUFDTCxDQUFDO0lBR0QsK0NBQXFCLEdBQXJCO1FBQUEsaUJBT0M7UUFORyxJQUFJLGlCQUFpQixHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxpQkFBaUIsQ0FBQztRQUNqRSxJQUFJLGlCQUFpQixJQUFJLGlCQUFpQixDQUFDLEtBQUssRUFBRTtZQUM5QyxJQUFJLENBQUMsUUFBUSxDQUFDLGlCQUFpQixDQUFDLEtBQUssRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO1lBQ3pELElBQUksaUJBQWlCLENBQUMsYUFBYTtnQkFDL0IsaUJBQWlCLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLEtBQUksQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLGdCQUFnQixFQUFFLGdCQUFnQixDQUFDLEVBQXJFLENBQXFFLENBQUMsQ0FBQTtTQUMxSDtJQUNMLENBQUM7SUFFRCxpQ0FBTyxHQUFQO1FBQ0ksSUFBSSxVQUFVLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUM7UUFDNUMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFVBQVUsRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUNqQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDekIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1NBQ3BDO1FBQ0QsSUFBSSxDQUFDLGNBQWMsR0FBRyxFQUFFLENBQUM7UUFDekIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO1FBQzVCLElBQUksSUFBSSxDQUFDLGFBQWE7WUFDbEIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLEVBQUUsQ0FBQzs7WUFFN0IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUN4RCxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDL0MsQ0FBQztJQUNMLHNCQUFDO0FBQUQsQ0FBQyxBQWpHRCxDQUFxQyxrQkFBa0IsR0FpR3REIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU09VUkNFLCBTRUxFQ1QsIEFERElUSU9OQUxfQ0xBU1MsIFBST1AsIEFUVFIsIEVWRU5UUywgSU5QVVQsIFRFWFRBUkVBLCBSRUFET05MWSB9IGZyb20gJy4uLy4uL2NvbnN0L2FwcC5jb25zdCc7XHJcbmltcG9ydCB7IENvbnRyb2xTdGF0ZSB9IGZyb20gJy4uLy4uL3N0YXRpY3MvY29udHJvbC1zdGF0ZSc7XHJcbmltcG9ydCB7IE92ZXJyaWRlT2JqZWN0UHJvcCB9IGZyb20gXCIuL292ZXJyaWRlLW9iamVjdC1wcm9wXCI7XHJcbmltcG9ydCB7IER5bmFtaWNOb2RlQ29uZmlnIH0gZnJvbSBcIi4uLy4uL21vZGVscy9pbnRlcmZhY2UvZHluYW1pYy1ub2RlLWNvbmZpZ1wiO1xyXG5cclxuZXhwb3J0IGNsYXNzIERvbU1hbmlwdWxhdGlvbiBleHRlbmRzIE92ZXJyaWRlT2JqZWN0UHJvcCB7XHJcbiAgICBpc0NvbXBvbmVudFZpZXc6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIHN1YnNjcmliZXJzOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgZWxlbWVudEluZGV4OiBudW1iZXIgPSAwO1xyXG4gICAgY29tbWVudE5vZGU6IGFueTtcclxuICAgIG5vZGVOYW1lOiBzdHJpbmc7XHJcbiAgICBkb21Db25maWc6IHsgW2tleTogc3RyaW5nXTogYW55IH07XHJcbiAgICBlbGVtZW50OiBhbnk7XHJcbiAgICBldmVudExpc3RlbmVyczogYW55W10gPSBbXTtcclxuICAgIGNvbnRyb2xJZDogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSBhY3Rpb25MaXN0ZW5lcnM6IHsgW2tleTogc3RyaW5nXTogYW55IH0gPSB7fTtcclxuICAgIHByaXZhdGUgZWxlbWVudENsYXNzZXM6IGFueVtdID0gW107XHJcblxyXG4gICAgY29uc3RydWN0b3IocGFyZW50Tm9kZTogYW55LCBlbGVtZW50TmFtZTogc3RyaW5nLCBkeW5hbWljTm9kZUNvbmZpZzogRHluYW1pY05vZGVDb25maWcpIHtcclxuICAgICAgICBzdXBlcihkeW5hbWljTm9kZUNvbmZpZyk7XHJcbiAgICAgICAgdGhpcy5ub2RlTmFtZSA9IGVsZW1lbnROYW1lO1xyXG4gICAgICAgIHN1cGVyLmNyZWF0ZU5vZGVFbGVtZW50KHBhcmVudE5vZGUsIGVsZW1lbnROYW1lKTtcclxuICAgICAgICB0aGlzLmJpbmRBZGRpdGlvbmFsQ2xhc3NlcygpO1xyXG4gICAgICAgIHRoaXMuY29udHJvbElkID0gQ29udHJvbFN0YXRlLmNvbnRyb2xJZCA9IENvbnRyb2xTdGF0ZS5jb250cm9sSWQgKyAxO1xyXG4gICAgICAgIENvbnRyb2xTdGF0ZS5jb250cm9sc1t0aGlzLmNvbnRyb2xJZF0gPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuYWRkT3JSZW1vdmVBdHRyaWJ1dGUoXCJkYXRhLXJ4d2ViaWRcIiwgdGhpcy5jb250cm9sSWQsZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIHBhcnNlT2JqZWN0KGpPYmplY3Q6IHsgW2tleTogc3RyaW5nXTogYW55IH0sIGlzU3Vic2NyaWJlOiBib29sZWFuKSB7XHJcbiAgICAgICAgdGhpcy5kb21Db25maWcgPSBqT2JqZWN0O1xyXG4gICAgICAgIHRoaXMucHJvY2VzcyhqT2JqZWN0LCBpc1N1YnNjcmliZSlcclxuICAgICAgICB0aGlzLm92ZXJyaWRlUHJvcChpc1N1YnNjcmliZSk7XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpYmVWYWx1ZUNoYW5nZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc3Vic2NyaWJlVmFsdWVDaGFuZ2UoKSB7XHJcbiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMuc3Vic2NyaWJlUHJvcHMpLmxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgIHRoaXMuY29udHJvbENvbmZpZy5vblByb3BWYWx1ZUNoYW5nZWQodGhpcy5jb250cm9sSWQsIHRoaXMuc3Vic2NyaWJlUHJvcHMsICh4LCB5KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnByb2Nlc3MoeCwgZmFsc2UpXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICB9XHJcbiAgICBwcm9jZXNzKGpPYmplY3Q6IHsgW2tleTogc3RyaW5nXTogYW55IH0sIGlzU3Vic2NyaWJlOiBib29sZWFuKSB7XHJcbiAgICAgICAgT2JqZWN0LmtleXMoak9iamVjdCkuZm9yRWFjaChwcm9wTmFtZSA9PiB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAocHJvcE5hbWUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgUFJPUDpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmJpbmRQcm9wKGpPYmplY3RbcHJvcE5hbWVdLCBpc1N1YnNjcmliZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIEFUVFI6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5iaW5kQXR0cmlidXRlKGpPYmplY3RbcHJvcE5hbWVdLCBpc1N1YnNjcmliZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIEVWRU5UUzpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmJpbmRFdmVudHMoak9iamVjdFtwcm9wTmFtZV0sIGlzU3Vic2NyaWJlKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgU09VUkNFOlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghaXNTdWJzY3JpYmUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHRoaXMuZWxlbWVudC5maXJzdEVsZW1lbnRDaGlsZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlQ2hpbGRyZW4odGhpcy5lbGVtZW50LmZpcnN0RWxlbWVudENoaWxkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5keW5hbWljTm9kZUNvbmZpZy5jb250cm9sQ29uZmlnUHJvY2Vzc29yLmNyZWF0ZUNoaWxkcmVucyh0aGlzLmR5bmFtaWNOb2RlQ29uZmlnLmNvbGxlY3Rpb25zLCB0aGlzLCB0aGlzLmNvbnRyb2xDb25maWcsIHRoaXMuZHluYW1pY05vZGVDb25maWcuYWRkaXRpb25hbENsYXNzZXMsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRQcm9wU3Vic2NyaXB0aW9uKFNPVVJDRSwgU09VUkNFLCBTT1VSQ0UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuICAgIG92ZXJyaWRlUHJvcChpc1N1YnNjcmliZTogYm9vbGVhbikge1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5ub2RlTmFtZSkge1xyXG4gICAgICAgICAgICBjYXNlIElOUFVUOlxyXG4gICAgICAgICAgICBjYXNlIFNFTEVDVDpcclxuICAgICAgICAgICAgY2FzZSBURVhUQVJFQTpcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRvbUNvbmZpZy5vdmVycmlkZVByb3AgPT0gdW5kZWZpbmVkIHx8IHRoaXMuZG9tQ29uZmlnLm92ZXJyaWRlUHJvcClcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm92ZXJyaWRlVmFsdWVQcm9wKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldFByb3BTdWJzY3JpcHRpb24oUkVBRE9OTFksIEFUVFIsIEFERElUSU9OQUxfQ0xBU1MsIEFERElUSU9OQUxfQ0xBU1MpXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jb250cm9sQ29uZmlnICYmIHRoaXMuY29udHJvbENvbmZpZy5jb25maWcgJiYgdGhpcy5jb250cm9sQ29uZmlnLmNvbmZpZy5hZGRpdGlvbmFsQ29uZmlnKSBcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb2Nlc3ModGhpcy5jb250cm9sQ29uZmlnLmNvbmZpZy5hZGRpdGlvbmFsQ29uZmlnLCBpc1N1YnNjcmliZSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGJpbmRBZGRpdGlvbmFsQ2xhc3NlcygpIHtcclxuICAgICAgICBsZXQgYWRkaXRpb25hbENsYXNzZXMgPSB0aGlzLmR5bmFtaWNOb2RlQ29uZmlnLmFkZGl0aW9uYWxDbGFzc2VzO1xyXG4gICAgICAgIGlmIChhZGRpdGlvbmFsQ2xhc3NlcyAmJiBhZGRpdGlvbmFsQ2xhc3Nlcy5jbGFzcykge1xyXG4gICAgICAgICAgICB0aGlzLnNldENsYXNzKGFkZGl0aW9uYWxDbGFzc2VzLmNsYXNzLCBBRERJVElPTkFMX0NMQVNTKTtcclxuICAgICAgICAgICAgaWYgKGFkZGl0aW9uYWxDbGFzc2VzLmxpc3RlbmVyUHJvcHMpXHJcbiAgICAgICAgICAgICAgICBhZGRpdGlvbmFsQ2xhc3Nlcy5saXN0ZW5lclByb3BzLmZvckVhY2godCA9PiB0aGlzLnNldFByb3BTdWJzY3JpcHRpb24odCwgQVRUUiwgQURESVRJT05BTF9DTEFTUywgQURESVRJT05BTF9DTEFTUykpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGRlc3Ryb3koKSB7XHJcbiAgICAgICAgbGV0IGV2ZW50Q291bnQgPSB0aGlzLmV2ZW50TGlzdGVuZXJzLmxlbmd0aDtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50Q291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICB0aGlzLmV2ZW50TGlzdGVuZXJzWzBdKCk7XHJcbiAgICAgICAgICAgIHRoaXMuZXZlbnRMaXN0ZW5lcnMuc3BsaWNlKDAsIDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmV2ZW50TGlzdGVuZXJzID0gW107XHJcbiAgICAgICAgdGhpcy5lbGVtZW50Lm9uQ2xpY2sgPSBudWxsO1xyXG4gICAgICAgIGlmICh0aGlzLmNvbXBvbmVudFZpZXcpXHJcbiAgICAgICAgICAgIHRoaXMuY29tcG9uZW50Vmlldy5kZXN0cm95KCk7XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucGFyZW50RWxlbWVudC5yZW1vdmVDaGlsZCh0aGlzLmVsZW1lbnQpXHJcbiAgICAgICAgdGhpcy5jb250cm9sQ29uZmlnLmRlc3Ryb3kodGhpcy5jb250cm9sSWQpO1xyXG4gICAgfVxyXG59XHJcblxyXG4iXX0=