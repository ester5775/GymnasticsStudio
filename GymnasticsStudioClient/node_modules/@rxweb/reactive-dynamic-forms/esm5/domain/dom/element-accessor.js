import * as tslib_1 from "tslib";
import { BaseObjectAccessor } from './base-object-accessor';
import { CHECKBOX, SELECT_MULTIPLE, RADIO, FILE } from '../../const/app.const';
import { ControlState } from '../../statics/control-state';
import { dynamicContainer } from "../../core/dynamicContainer";
import { ComponentView } from "../component-viewer/component-view";
var ElementAccessor = /** @class */ (function (_super) {
    tslib_1.__extends(ElementAccessor, _super);
    function ElementAccessor(dynamicNodeConfig) {
        var _this = _super.call(this, dynamicNodeConfig) || this;
        _this.checkedCheckbox = function (value, element) { return (value) ? (_this.controlConfig.config.multiselect) ? value.filter(function (t) { return element.value == t; })[0] != undefined : element.value == value : false; };
        _this.checkedRadio = function (value, element) { return (value) ? value == element.value : false; };
        return _this;
    }
    ElementAccessor.prototype.createNodeElement = function (parentElement, name) {
        this.element = name.startsWith("#") ? this.createComponentView(this.dynamicNodeConfig.controlConfig) : this.dynamicNodeConfig.renderer.createElement(name);
        this.dynamicNodeConfig.renderer.appendChild(parentElement, this.element);
    };
    ElementAccessor.prototype.createComponentView = function (controlConfig) {
        var container = dynamicContainer.getComponent(controlConfig.config.type.replace("#", ""));
        if (container) {
            this.componentView = new ComponentView(container.instance, this.dynamicNodeConfig.viewContainerRef, this.dynamicNodeConfig.componentFactoryResolver, controlConfig, this.dynamicNodeConfig.dynamicFormBuildConfig);
            this.componentView.create();
            return this.componentView.rootNode();
        }
    };
    ElementAccessor.prototype.removeChildren = function (element) {
        if (element.firstElementChild) {
            this.removeChildren(element.firstElementChild);
        }
        var controlId = element.getAttribute("data-rxwebid");
        if (controlId && ControlState.controls[controlId]) {
            ControlState.controls[controlId].destroy();
            delete ControlState.controls[controlId];
        }
    };
    ElementAccessor.prototype.setControlConfigValue = function (targetElement) {
        var e_1, _a;
        var value = targetElement.value === "" ? null : targetElement.value;
        switch (targetElement.type) {
            case FILE:
                this.controlConfig.formControl.setValue(targetElement.files);
                this.controlConfig.value = targetElement.files;
                break;
            case CHECKBOX:
                this.setCheckboxValue(targetElement);
                break;
            case SELECT_MULTIPLE:
                var values = [];
                try {
                    for (var _b = tslib_1.__values(this.element.options), _c = _b.next(); !_c.done; _c = _b.next()) {
                        var option = _c.value;
                        if (option.selected && option.value)
                            values.push(option.value);
                    }
                }
                catch (e_1_1) { e_1 = { error: e_1_1 }; }
                finally {
                    try {
                        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                    }
                    finally { if (e_1) throw e_1.error; }
                }
                this.controlConfig.value = values;
                break;
            default:
                this.controlConfig.formControl.setValue(value);
                this.controlConfig.value = value;
                break;
        }
    };
    ElementAccessor.prototype.resetElementValue = function (value) {
        var e_2, _a;
        switch (this.element.type) {
            case CHECKBOX:
            case RADIO:
                var elements = document.querySelectorAll("[name='" + this.controlConfig.config.name + "']");
                for (var i = 0; i < elements.length; i++) {
                    elements[i].checked = this.element.type == CHECKBOX ? this.checkedCheckbox(value, elements[i]) : this.checkedRadio(value, elements[i]);
                }
                break;
            case SELECT_MULTIPLE:
                var _loop_1 = function (option) {
                    option.selected = (value) ? value.filter(function (t) { return t == option.value; })[0] != undefined : false;
                };
                try {
                    for (var _b = tslib_1.__values(this.element.options), _c = _b.next(); !_c.done; _c = _b.next()) {
                        var option = _c.value;
                        _loop_1(option);
                    }
                }
                catch (e_2_1) { e_2 = { error: e_2_1 }; }
                finally {
                    try {
                        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                    }
                    finally { if (e_2) throw e_2.error; }
                }
                break;
            default:
                this.element.value = value;
        }
    };
    ElementAccessor.prototype.setCheckboxValue = function (targetElement) {
        var value = (this.controlConfig.config.multiselect) ? this.controlConfig.value || [] : targetElement.value;
        if (targetElement.checked)
            (this.controlConfig.config.multiselect) ? value.push(targetElement.value) : null;
        else
            (this.controlConfig.config.multiselect) ? value.splice(value.indexOf(targetElement.value), 1) : value = null;
        this.controlConfig.formControl.setValue(value);
        this.controlConfig.value = value;
    };
    return ElementAccessor;
}(BaseObjectAccessor));
export { ElementAccessor };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWxlbWVudC1hY2Nlc3Nvci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0ByeHdlYi9yZWFjdGl2ZS1keW5hbWljLWZvcm1zLyIsInNvdXJjZXMiOlsiZG9tYWluL2RvbS9lbGVtZW50LWFjY2Vzc29yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUM1RCxPQUFPLEVBQUUsUUFBUSxFQUFFLGVBQWUsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLE1BQU0sdUJBQXVCLENBQUE7QUFDOUUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQzNELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQy9ELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUVuRTtJQUE4QywyQ0FBa0I7SUFJNUQseUJBQVksaUJBQW9DO1FBQWhELFlBQ0ksa0JBQU0saUJBQWlCLENBQUMsU0FDM0I7UUF3RU8scUJBQWUsR0FBRyxVQUFDLEtBQUssRUFBRSxPQUFPLElBQUssT0FBQSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsT0FBTyxDQUFDLEtBQUssSUFBSSxDQUFDLEVBQWxCLENBQWtCLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxTQUFTLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLEVBQTFJLENBQTBJLENBQUM7UUFFakwsa0JBQVksR0FBRyxVQUFDLEtBQUssRUFBRSxPQUFPLElBQUssT0FBQSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksT0FBTyxDQUFD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M0ZELENBQThDLGtCQUFrQixHQTJGL0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEeW5hbWljTm9kZUNvbmZpZyB9IGZyb20gXCIuLi8uLi9tb2RlbHMvaW50ZXJmYWNlL2R5bmFtaWMtbm9kZS1jb25maWdcIjtcclxuaW1wb3J0IHsgQmFzZU9iamVjdEFjY2Vzc29yIH0gZnJvbSAnLi9iYXNlLW9iamVjdC1hY2Nlc3Nvcic7XHJcbmltcG9ydCB7IENIRUNLQk9YLCBTRUxFQ1RfTVVMVElQTEUsIFJBRElPLCBGSUxFIH0gZnJvbSAnLi4vLi4vY29uc3QvYXBwLmNvbnN0J1xyXG5pbXBvcnQgeyBDb250cm9sU3RhdGUgfSBmcm9tICcuLi8uLi9zdGF0aWNzL2NvbnRyb2wtc3RhdGUnO1xyXG5pbXBvcnQgeyBkeW5hbWljQ29udGFpbmVyIH0gZnJvbSBcIi4uLy4uL2NvcmUvZHluYW1pY0NvbnRhaW5lclwiO1xyXG5pbXBvcnQgeyBDb21wb25lbnRWaWV3IH0gZnJvbSBcIi4uL2NvbXBvbmVudC12aWV3ZXIvY29tcG9uZW50LXZpZXdcIjtcclxuXHJcbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBFbGVtZW50QWNjZXNzb3IgZXh0ZW5kcyBCYXNlT2JqZWN0QWNjZXNzb3J7XHJcbiAgICBlbGVtZW50OiBhbnk7XHJcbiAgICBwcm90ZWN0ZWQgY29tcG9uZW50VmlldzogYW55O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGR5bmFtaWNOb2RlQ29uZmlnOiBEeW5hbWljTm9kZUNvbmZpZykge1xyXG4gICAgICAgIHN1cGVyKGR5bmFtaWNOb2RlQ29uZmlnKVxyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZU5vZGVFbGVtZW50KHBhcmVudEVsZW1lbnQ6IGFueSwgbmFtZTogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gbmFtZS5zdGFydHNXaXRoKFwiI1wiKSA/IHRoaXMuY3JlYXRlQ29tcG9uZW50Vmlldyh0aGlzLmR5bmFtaWNOb2RlQ29uZmlnLmNvbnRyb2xDb25maWcpIDogdGhpcy5keW5hbWljTm9kZUNvbmZpZy5yZW5kZXJlci5jcmVhdGVFbGVtZW50KG5hbWUpO1xyXG4gICAgICAgIHRoaXMuZHluYW1pY05vZGVDb25maWcucmVuZGVyZXIuYXBwZW5kQ2hpbGQocGFyZW50RWxlbWVudCwgdGhpcy5lbGVtZW50KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNyZWF0ZUNvbXBvbmVudFZpZXcoY29udHJvbENvbmZpZzogYW55KSB7XHJcbiAgICAgICAgbGV0IGNvbnRhaW5lciA9IGR5bmFtaWNDb250YWluZXIuZ2V0Q29tcG9uZW50KGNvbnRyb2xDb25maWcuY29uZmlnLnR5cGUucmVwbGFjZShcIiNcIiwgXCJcIikpO1xyXG4gICAgICAgIGlmIChjb250YWluZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5jb21wb25lbnRWaWV3ID0gbmV3IENvbXBvbmVudFZpZXcoY29udGFpbmVyLmluc3RhbmNlLCB0aGlzLmR5bmFtaWNOb2RlQ29uZmlnLnZpZXdDb250YWluZXJSZWYsIHRoaXMuZHluYW1pY05vZGVDb25maWcuY29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBjb250cm9sQ29uZmlnLCB0aGlzLmR5bmFtaWNOb2RlQ29uZmlnLmR5bmFtaWNGb3JtQnVpbGRDb25maWcpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbXBvbmVudFZpZXcuY3JlYXRlKCk7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbXBvbmVudFZpZXcucm9vdE5vZGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHJlbW92ZUNoaWxkcmVuKGVsZW1lbnQ6IGFueSkge1xyXG4gICAgICAgIGlmIChlbGVtZW50LmZpcnN0RWxlbWVudENoaWxkKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlQ2hpbGRyZW4oZWxlbWVudC5maXJzdEVsZW1lbnRDaGlsZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBjb250cm9sSWQgPSBlbGVtZW50LmdldEF0dHJpYnV0ZShcImRhdGEtcnh3ZWJpZFwiKTtcclxuICAgICAgICBpZiAoY29udHJvbElkICYmIENvbnRyb2xTdGF0ZS5jb250cm9sc1tjb250cm9sSWRdKSB7XHJcbiAgICAgICAgICAgIENvbnRyb2xTdGF0ZS5jb250cm9sc1tjb250cm9sSWRdLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgZGVsZXRlIENvbnRyb2xTdGF0ZS5jb250cm9sc1tjb250cm9sSWRdO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgXHJcblxyXG4gICAgc2V0Q29udHJvbENvbmZpZ1ZhbHVlKHRhcmdldEVsZW1lbnQpIHtcclxuICAgICAgICBsZXQgdmFsdWUgPSB0YXJnZXRFbGVtZW50LnZhbHVlID09PSBcIlwiID8gbnVsbCA6IHRhcmdldEVsZW1lbnQudmFsdWU7XHJcbiAgICAgICAgc3dpdGNoICh0YXJnZXRFbGVtZW50LnR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSBGSUxFOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5jb250cm9sQ29uZmlnLmZvcm1Db250cm9sLnNldFZhbHVlKHRhcmdldEVsZW1lbnQuZmlsZXMpXHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xDb25maWcudmFsdWUgPSB0YXJnZXRFbGVtZW50LmZpbGVzO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgQ0hFQ0tCT1g6XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldENoZWNrYm94VmFsdWUodGFyZ2V0RWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBTRUxFQ1RfTVVMVElQTEU6XHJcbiAgICAgICAgICAgICAgICBsZXQgdmFsdWVzID0gW107XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgdGhpcy5lbGVtZW50Lm9wdGlvbnMpXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbi5zZWxlY3RlZCAmJiBvcHRpb24udmFsdWUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKG9wdGlvbi52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xDb25maWcudmFsdWUgPSB2YWx1ZXM7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbENvbmZpZy5mb3JtQ29udHJvbC5zZXRWYWx1ZSh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xDb25maWcudmFsdWUgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXNldEVsZW1lbnRWYWx1ZSh2YWx1ZTogYW55KSB7XHJcbiAgICAgICAgc3dpdGNoICh0aGlzLmVsZW1lbnQudHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlIENIRUNLQk9YOlxyXG4gICAgICAgICAgICBjYXNlIFJBRElPOlxyXG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnRzOmFueSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoYFtuYW1lPScke3RoaXMuY29udHJvbENvbmZpZy5jb25maWcubmFtZX0nXWApO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzW2ldLmNoZWNrZWQgPSB0aGlzLmVsZW1lbnQudHlwZSA9PSBDSEVDS0JPWCA/IHRoaXMuY2hlY2tlZENoZWNrYm94KHZhbHVlLCBlbGVtZW50c1tpXSkgOiB0aGlzLmNoZWNrZWRSYWRpbyh2YWx1ZSwgZWxlbWVudHNbaV0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgU0VMRUNUX01VTFRJUExFOlxyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIHRoaXMuZWxlbWVudC5vcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gKHZhbHVlKSA/IHZhbHVlLmZpbHRlcih0ID0+IHQgPT0gb3B0aW9uLnZhbHVlKVswXSAhPSB1bmRlZmluZWQgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnZhbHVlID0gdmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY2hlY2tlZENoZWNrYm94ID0gKHZhbHVlLCBlbGVtZW50KSA9PiAodmFsdWUpID8gKHRoaXMuY29udHJvbENvbmZpZy5jb25maWcubXVsdGlzZWxlY3QpID8gdmFsdWUuZmlsdGVyKHQgPT4gZWxlbWVudC52YWx1ZSA9PSB0KVswXSAhPSB1bmRlZmluZWQgOiBlbGVtZW50LnZhbHVlID09IHZhbHVlIDogZmFsc2U7XHJcblxyXG4gICAgcHJpdmF0ZSBjaGVja2VkUmFkaW8gPSAodmFsdWUsIGVsZW1lbnQpID0+ICh2YWx1ZSkgPyB2YWx1ZSA9PSBlbGVtZW50LnZhbHVlIDogZmFsc2U7XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRDaGVja2JveFZhbHVlKHRhcmdldEVsZW1lbnQpIHtcclxuICAgICAgICBsZXQgdmFsdWUgPSAodGhpcy5jb250cm9sQ29uZmlnLmNvbmZpZy5tdWx0aXNlbGVjdCkgPyB0aGlzLmNvbnRyb2xDb25maWcudmFsdWUgfHwgW10gOiB0YXJnZXRFbGVtZW50LnZhbHVlO1xyXG4gICAgICAgIGlmICh0YXJnZXRFbGVtZW50LmNoZWNrZWQpXHJcbiAgICAgICAgICAgICh0aGlzLmNvbnRyb2xDb25maWcuY29uZmlnLm11bHRpc2VsZWN0KSA/IHZhbHVlLnB1c2godGFyZ2V0RWxlbWVudC52YWx1ZSkgOiBudWxsO1xyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgKHRoaXMuY29udHJvbENvbmZpZy5jb25maWcubXVsdGlzZWxlY3QpID8gdmFsdWUuc3BsaWNlKHZhbHVlLmluZGV4T2YodGFyZ2V0RWxlbWVudC52YWx1ZSksIDEpIDogdmFsdWUgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuY29udHJvbENvbmZpZy5mb3JtQ29udHJvbC5zZXRWYWx1ZSh2YWx1ZSk7XHJcbiAgICAgICAgdGhpcy5jb250cm9sQ29uZmlnLnZhbHVlID0gdmFsdWU7XHJcbiAgICB9XHJcbn0iXX0=