import * as tslib_1 from "tslib";
import { ElementAccessor } from './element-accessor';
import { CONDITIONAL_VALIDATOR, BLUR, FOCUS, SELECT, INPUT, CLICK, EVENTS } from '../../const/app.const';
var ElementEventProcessor = /** @class */ (function (_super) {
    tslib_1.__extends(ElementEventProcessor, _super);
    function ElementEventProcessor(dynamicNodeConfig) {
        var _this = _super.call(this, dynamicNodeConfig) || this;
        _this.dynamicNodeConfig = dynamicNodeConfig;
        return _this;
    }
    ElementEventProcessor.prototype.bindEvents = function (events, isSubscribe) {
        var _this = this;
        Object.keys(events).forEach(function (eventName) {
            switch (eventName) {
                case FOCUS:
                    _this.setFocus(_this.getValue(events[eventName]));
                    break;
                case SELECT:
                case INPUT:
                    _this.setInput();
                    break;
                case BLUR:
                    _this.setBlur();
                    break;
                case CLICK:
                    _this.setClick(_this.getValue(events[eventName]));
                    break;
            }
            if (isSubscribe && _this.isSubscribeProp(events[eventName]))
                _this.setPropSubscription(_this.getPropName(events[eventName]), EVENTS, eventName);
        });
    };
    ElementEventProcessor.prototype.setClick = function (functionName) {
        var _this = this;
        this.element.onclick = function () {
            if (_this.controlConfig[functionName])
                _this.controlConfig[functionName].call(_this.controlConfig);
        };
    };
    ElementEventProcessor.prototype.setFocus = function (value) {
        var _this = this;
        if (value && this.element.focus)
            setTimeout(function (t) { _this.element.focus(); }, 1000);
    };
    ElementEventProcessor.prototype.setBlur = function () {
        var _this = this;
        var listen = this.dynamicNodeConfig.renderer.listen(this.element, BLUR, function () {
            _this.dynamicNodeConfig.controlConfig.formControl.markAsTouched();
        });
        this.eventListeners.push(listen);
    };
    ElementEventProcessor.prototype.setInput = function () {
        var _this = this;
        var listen = this.dynamicNodeConfig.renderer.listen(this.element, INPUT, function (v) {
            var isPassed = true;
            if (_this.controlConfig.hooks && _this.controlConfig.hooks.preValue) {
                isPassed = _this.controlConfig.hooks.preValue.call(_this.controlConfig, v.target.value);
                if (!isPassed) {
                    _this.controlConfig.formControl.patchValue(_this.controlConfig.formControl.value);
                    _this.resetElementValue(_this.controlConfig.formControl.value);
                }
            }
            if (isPassed) {
                _this.setControlConfigValue(v.target);
                if (_this.controlConfig.hooks && _this.controlConfig.hooks.postValue)
                    _this.controlConfig.hooks.postValue.call(_this.controlConfig);
                _this.controlConfig.formControl.markAsDirty();
            }
            if (_this.conditionalValidator)
                _this.conditionalValidator(_this.controlConfig.formControl);
        });
        this.eventListeners.push(listen);
        setTimeout(function () {
            if (_this.controlConfig.formControl[CONDITIONAL_VALIDATOR]) {
                _this.conditionalValidator = _this.controlConfig.formControl[CONDITIONAL_VALIDATOR];
                delete _this.controlConfig.formControl[CONDITIONAL_VALIDATOR];
            }
        }, 50);
    };
    return ElementEventProcessor;
}(ElementAccessor));
export { ElementEventProcessor };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWxlbWVudC1ldmVudC1wcm9jZXNzb3IuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Acnh3ZWIvcmVhY3RpdmUtZHluYW1pYy1mb3Jtcy8iLCJzb3VyY2VzIjpbImRvbWFpbi9kb20vZWxlbWVudC1ldmVudC1wcm9jZXNzb3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUVyRCxPQUFPLEVBQUUscUJBQXFCLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUd6RztJQUEyQyxpREFBZTtJQUd0RCwrQkFBbUIsaUJBQW9DO1FBQXZELFlBQTJELGtCQUFNLGlCQUFpQixDQUFDLFNBQUc7UUFBbkUsdUJBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjs7SUFBOEIsQ0FBQztJQUV0RiwwQ0FBVSxHQUFWLFVBQVcsTUFBOEIsRUFBQyxXQUFtQjtRQUE3RCxpQkFvQkM7UUFuQkcsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBQSxTQUFTO1lBQ2pDLFFBQVEsU0FBUyxFQUFFO2dCQUNmLEtBQUssS0FBSztvQkFDTixLQUFJLENBQUMsUUFBUSxDQUFDLEtBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDaEQsTUFBTTtnQkFDVixLQUFLLE1BQU0sQ0FBQztnQkFDWixLQUFLLEtBQUs7b0JBQ04sS0FBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO29CQUNoQixNQUFNO2dCQUNWLEtBQUssSUFBSTtvQkFDTCxLQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7b0JBQ2YsTUFBTTtnQkFDVixLQUFLLEtBQUs7b0JBQ04sS0FBSSxDQUFDLFFBQVEsQ0FBQyxLQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENB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S0FBSSxDQUFDLG9CQUFvQixDQUFDLEtBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDbEUsQ0FBQyxDQUFDLENBQUE7UUFDRixJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNqQyxVQUFVLENBQUM7WUFDUCxJQUFJLEtBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLHFCQUFxQixDQUFDLEVBQUU7Z0JBQ3ZELEtBQUksQ0FBQyxvQkFBb0IsR0FBRyxLQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO2dCQUNsRixPQUFPLEtBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLHFCQUFxQixDQUFDLENBQUM7YUFDaEU7UUFDTCxDQUFDLEVBQUMsRUFBRSxDQUFDLENBQUE7SUFHVCxDQUFDO0lBSUwsNEJBQUM7QUFBRCxDQUFDLEFBOUVELENBQTJDLGVBQWUsR0E4RXpEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRWxlbWVudEFjY2Vzc29yIH0gZnJvbSAnLi9lbGVtZW50LWFjY2Vzc29yJztcclxuaW1wb3J0IHsgRHluYW1pY05vZGVDb25maWcgfSBmcm9tICcuLi8uLi9tb2RlbHMvaW50ZXJmYWNlL2R5bmFtaWMtbm9kZS1jb25maWcnO1xyXG5pbXBvcnQgeyBDT05ESVRJT05BTF9WQUxJREFUT1IsIEJMVVIsIEZPQ1VTLCBTRUxFQ1QsIElOUFVULCBDTElDSywgRVZFTlRTIH0gZnJvbSAnLi4vLi4vY29uc3QvYXBwLmNvbnN0JztcclxuaW1wb3J0IHsgVmFsaWRhdG9yRm4gfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcblxyXG5leHBvcnQgY2xhc3MgRWxlbWVudEV2ZW50UHJvY2Vzc29yIGV4dGVuZHMgRWxlbWVudEFjY2Vzc29ye1xyXG4gICAgZXZlbnRMaXN0ZW5lcnM6IGFueVtdO1xyXG4gICAgcHJpdmF0ZSBjb25kaXRpb25hbFZhbGlkYXRvcjogVmFsaWRhdG9yRm47XHJcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgZHluYW1pY05vZGVDb25maWc6IER5bmFtaWNOb2RlQ29uZmlnKSB7IHN1cGVyKGR5bmFtaWNOb2RlQ29uZmlnKTsgfVxyXG5cclxuICAgIGJpbmRFdmVudHMoZXZlbnRzOiB7IFtrZXk6IHN0cmluZ106IGFueSB9LGlzU3Vic2NyaWJlOmJvb2xlYW4pIHtcclxuICAgICAgICBPYmplY3Qua2V5cyhldmVudHMpLmZvckVhY2goZXZlbnROYW1lID0+IHtcclxuICAgICAgICAgICAgc3dpdGNoIChldmVudE5hbWUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgRk9DVVM6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRGb2N1cyh0aGlzLmdldFZhbHVlKGV2ZW50c1tldmVudE5hbWVdKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFNFTEVDVDpcclxuICAgICAgICAgICAgICAgIGNhc2UgSU5QVVQ6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRJbnB1dCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBCTFVSOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0Qmx1cigpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBDTElDSzpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldENsaWNrKHRoaXMuZ2V0VmFsdWUoZXZlbnRzW2V2ZW50TmFtZV0pKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoaXNTdWJzY3JpYmUgJiYgdGhpcy5pc1N1YnNjcmliZVByb3AoZXZlbnRzW2V2ZW50TmFtZV0pKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRQcm9wU3Vic2NyaXB0aW9uKHRoaXMuZ2V0UHJvcE5hbWUoZXZlbnRzW2V2ZW50TmFtZV0pLCBFVkVOVFMsIGV2ZW50TmFtZSk7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICBzZXRDbGljayhmdW5jdGlvbk5hbWU6c3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50Lm9uY2xpY2sgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbnRyb2xDb25maWdbZnVuY3Rpb25OYW1lXSlcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbENvbmZpZ1tmdW5jdGlvbk5hbWVdLmNhbGwodGhpcy5jb250cm9sQ29uZmlnKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2V0Rm9jdXModmFsdWU6IGJvb2xlYW4pIHtcclxuICAgICAgICBpZiAodmFsdWUgJiYgdGhpcy5lbGVtZW50LmZvY3VzKSBcclxuICAgICAgICAgICAgc2V0VGltZW91dCh0ID0+IHsgdGhpcy5lbGVtZW50LmZvY3VzKCl9ICwgMTAwMCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0Qmx1cigpIHtcclxuICAgICAgICBsZXQgbGlzdGVuID0gdGhpcy5keW5hbWljTm9kZUNvbmZpZy5yZW5kZXJlci5saXN0ZW4odGhpcy5lbGVtZW50LCBCTFVSLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZHluYW1pY05vZGVDb25maWcuY29udHJvbENvbmZpZy5mb3JtQ29udHJvbC5tYXJrQXNUb3VjaGVkKCk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICB0aGlzLmV2ZW50TGlzdGVuZXJzLnB1c2gobGlzdGVuKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRJbnB1dCgpIHtcclxuICAgICAgICBsZXQgbGlzdGVuID0gdGhpcy5keW5hbWljTm9kZUNvbmZpZy5yZW5kZXJlci5saXN0ZW4odGhpcy5lbGVtZW50LCBJTlBVVCwgKHYpID0+IHtcclxuICAgICAgICAgICAgbGV0IGlzUGFzc2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuY29udHJvbENvbmZpZy5ob29rcyAmJiB0aGlzLmNvbnRyb2xDb25maWcuaG9va3MucHJlVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGlzUGFzc2VkID0gdGhpcy5jb250cm9sQ29uZmlnLmhvb2tzLnByZVZhbHVlLmNhbGwodGhpcy5jb250cm9sQ29uZmlnLHYudGFyZ2V0LnZhbHVlKTtcclxuICAgICAgICAgICAgICAgIGlmICghaXNQYXNzZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xDb25maWcuZm9ybUNvbnRyb2wucGF0Y2hWYWx1ZSh0aGlzLmNvbnRyb2xDb25maWcuZm9ybUNvbnRyb2wudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVzZXRFbGVtZW50VmFsdWUodGhpcy5jb250cm9sQ29uZmlnLmZvcm1Db250cm9sLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoaXNQYXNzZWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0Q29udHJvbENvbmZpZ1ZhbHVlKHYudGFyZ2V0KTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbnRyb2xDb25maWcuaG9va3MgJiYgdGhpcy5jb250cm9sQ29uZmlnLmhvb2tzLnBvc3RWYWx1ZSlcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xDb25maWcuaG9va3MucG9zdFZhbHVlLmNhbGwodGhpcy5jb250cm9sQ29uZmlnKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbENvbmZpZy5mb3JtQ29udHJvbC5tYXJrQXNEaXJ0eSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbmRpdGlvbmFsVmFsaWRhdG9yKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5jb25kaXRpb25hbFZhbGlkYXRvcih0aGlzLmNvbnRyb2xDb25maWcuZm9ybUNvbnRyb2wpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgdGhpcy5ldmVudExpc3RlbmVycy5wdXNoKGxpc3Rlbik7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbnRyb2xDb25maWcuZm9ybUNvbnRyb2xbQ09ORElUSU9OQUxfVkFMSURBVE9SXSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb25kaXRpb25hbFZhbGlkYXRvciA9IHRoaXMuY29udHJvbENvbmZpZy5mb3JtQ29udHJvbFtDT05ESVRJT05BTF9WQUxJREFUT1JdO1xyXG4gICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuY29udHJvbENvbmZpZy5mb3JtQ29udHJvbFtDT05ESVRJT05BTF9WQUxJREFUT1JdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSw1MClcclxuICAgICAgICBcclxuXHJcbiAgICB9XHJcblxyXG5cclxuICAgIFxyXG59Il19