import * as tslib_1 from "tslib";
import { Input } from "@angular/core";
import { ControlConfig } from "../services/form-control-config";
import { DYNAMIC_ELEMENT_DESIGN_TREE } from '../const/dynamic-element-design-tree.const';
import { BOOTSTRAP_DESIGN_CONFIG } from '../const/bootstrap-design-config.const';
import { DomManipulation } from '../domain/dom/dom-manipulation';
import { ApplicationUtil } from '../util/application-util';
import { objectPropValue } from '../functions/object-prop-value.function';
import { INLINE, PREPEND_BOTH, PREPEND_LEFT, PREPEND_RIGHT, INPUT_TEXT, SQUARE_ERROR, SQUARE_SMALL, SQUARE_LABEL, SQUARE_CONTROL, ADVANCE, INPUT, TEXT, RANGE, FILE, STRING, CONTROL } from '../const/app.const';
var ControlConfigProcessor = /** @class */ (function () {
    function ControlConfigProcessor(element, renderer, componentFactoryResolver, viewContainerRef) {
        this.element = element;
        this.renderer = renderer;
        this.componentFactoryResolver = componentFactoryResolver;
        this.viewContainerRef = viewContainerRef;
        this.isBuild = false;
    }
    Object.defineProperty(ControlConfigProcessor.prototype, "viewMode", {
        get: function () {
            return this._viewMode;
        },
        set: function (value) {
            this._viewMode = value;
            if (this.isBuild)
                this.build();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ControlConfigProcessor.prototype, "currentViewMode", {
        get: function () {
            return DYNAMIC_ELEMENT_DESIGN_TREE.viewMode[this.viewMode];
        },
        enumerable: true,
        configurable: true
    });
    ControlConfigProcessor.prototype.getView = function (name, controlConfig) {
        if (this.viewMode == INLINE)
            name = this.getName(name, controlConfig, true);
        return DYNAMIC_ELEMENT_DESIGN_TREE[name];
    };
    Object.defineProperty(ControlConfigProcessor.prototype, "viewClassPath", {
        get: function () {
            return BOOTSTRAP_DESIGN_CONFIG.elementClassPath.viewMode[this.viewMode];
        },
        enumerable: true,
        configurable: true
    });
    ControlConfigProcessor.prototype.build = function () {
        var _this = this;
        this.uiBindings.forEach(function (controlConfigName) {
            _this.designForm(controlConfigName, _this.element, _this.currentViewMode[0], _this.currentViewMode[1], BOOTSTRAP_DESIGN_CONFIG.elementClassPath.viewMode[_this.viewMode]);
        });
    };
    ControlConfigProcessor.prototype.designForm = function (controlConfigName, element, viewRoot, viewChild, classPath, childrenControlConfig) {
        var _this = this;
        var controlConfig = childrenControlConfig || this.getControlConfig(controlConfigName);
        if (controlConfig) {
            if (this.viewMode != INLINE && controlConfig && !controlConfig.config.skipDefaultView)
                this.createElement(viewRoot, viewChild, element, controlConfig, classPath);
            else {
                var currentView = this.getView(controlConfig.config.type, controlConfig);
                if (currentView)
                    this.createElement(currentView[0], currentView[1], element, controlConfig, this.getClassPath(controlConfig.config.type, controlConfig, this._viewMode == INLINE));
                else
                    this.createDomManipulation(controlConfig.config.type, [], element, controlConfig, [], true);
            }
        }
        else if (this.viewMode == ADVANCE && Array.isArray(controlConfigName)) {
            var config = new ControlConfig({}, {});
            var domManipulation_1 = this.createElement(this.currentViewMode[0], [], element, config, BOOTSTRAP_DESIGN_CONFIG.elementClassPath.viewMode[this.viewMode]);
            controlConfigName.forEach(function (t) {
                _this.designForm(t, domManipulation_1.element, _this.currentViewMode[1][0], _this.currentViewMode[1][1], BOOTSTRAP_DESIGN_CONFIG.elementClassPath.viewMode[_this.viewMode].child["0"]);
            });
        }
    };
    ControlConfigProcessor.prototype.createElement = function (elementName, collections, parentElement, controlConfig, elementClassPath) {
        var _this = this;
        if (!elementName.startsWith("#")) {
            elementClassPath = elementClassPath ? elementClassPath : {};
            var domManipulation_2 = this.createDomManipulation(elementName, collections, parentElement, controlConfig, elementClassPath);
            this.createChildrens(collections, domManipulation_2, controlConfig, elementClassPath);
            if (controlConfig.config && controlConfig.config.childrens && controlConfig.config.childrens.length > 0) {
                controlConfig.config.childrens.forEach(function (t, i) {
                    var childrenControlConfig = undefined;
                    if (!(typeof t == STRING) && !Array.isArray(t))
                        childrenControlConfig = new ControlConfig(tslib_1.__assign({}, t, { skipDefaultView: true }), {});
                    _this.designForm(t, domManipulation_2.element, _this.currentViewMode[0], _this.currentViewMode[1], BOOTSTRAP_DESIGN_CONFIG.elementClassPath.viewMode[_this.viewMode], childrenControlConfig);
                });
            }
            return domManipulation_2;
        }
        else
            this.createDomManipulation(elementName, collections, parentElement, controlConfig, elementClassPath, true); //this.createComponentView(controlConfig, parentElement);
    };
    ControlConfigProcessor.prototype.createDomManipulation = function (elementName, collections, parentElement, controlConfig, elementClassPath, isComponentView) {
        if (isComponentView === void 0) { isComponentView = false; }
        var dynamicNodeConfig = {
            controlConfig: controlConfig, additionalClasses: elementClassPath, renderer: this.renderer, collections: collections, controlConfigProcessor: this,
            viewContainerRef: isComponentView ? this.viewContainerRef : undefined,
            componentFactoryResolver: isComponentView ? this.componentFactoryResolver : undefined,
            dynamicFormBuildConfig: this.dynamicFormBuildConfig
        };
        return new DomManipulation(parentElement, elementName, dynamicNodeConfig);
    };
    ControlConfigProcessor.prototype.createChildrens = function (collections, domManipulation, controlConfig, elementClassPath, isSubscribe) {
        var _this = this;
        if (isSubscribe === void 0) { isSubscribe = true; }
        var elementCount = 0;
        var childElementsClassConfig = elementClassPath.child ? elementClassPath.child : {};
        for (var i = 0; i < collections.length; i++) {
            var collection = collections[i];
            if (!ApplicationUtil.isObject(collection)) {
                if (this.isCreateElement(collections[i], controlConfig)) {
                    if (collection == SQUARE_CONTROL && controlConfig.config.type == undefined && controlConfig.config.childControlConfigs) {
                        controlConfig.config.childControlConfigs.forEach(function (x) {
                            var childControlConfig = _this.getControlConfig(x);
                            _this.createChildNodes(collections, childControlConfig, childElementsClassConfig, elementCount, i, domManipulation);
                        });
                    }
                    else {
                        if (collection == SQUARE_CONTROL && controlConfig.config.type.startsWith("#"))
                            this.createDomManipulation(controlConfig.config.type, [], domManipulation.element, controlConfig, [], true);
                        else {
                            var isIncrease = this.createChildNodes(collections, controlConfig, childElementsClassConfig, elementCount, i, domManipulation);
                            if (isIncrease)
                                i = i + 1;
                        }
                    }
                }
                elementCount++;
            }
            else {
                if (collection.for)
                    this.runForCollection(collection, domManipulation, controlConfig, elementClassPath);
                if (isSubscribe)
                    domManipulation.parseObject(collections[i], isSubscribe);
            }
        }
    };
    ControlConfigProcessor.prototype.createChildNodes = function (collections, controlConfig, childElementsClassConfig, elementCount, i, domManipulation) {
        var isNextCollection = false;
        var nextCollection = this.getCollection(collections[i], controlConfig);
        var childClasses = this.getAdditionalClasses(collections[i], childElementsClassConfig, elementCount, controlConfig);
        if (!nextCollection) {
            nextCollection = [collections[i], collections[i + 1]];
            isNextCollection = true;
        }
        this.createElement(nextCollection[0], nextCollection[1], domManipulation.element, controlConfig, childClasses);
        return isNextCollection;
    };
    ControlConfigProcessor.prototype.runForCollection = function (collection, domManipulation, controlConfig, elementClassPath) {
        var _this = this;
        Object.keys(collection.for).forEach(function (t) {
            var source = objectPropValue(t, controlConfig);
            source.forEach(function (x, index) {
                var item = collection.for[t].call(controlConfig, x, index);
                _this.createChildrens(item, domManipulation, controlConfig, elementClassPath);
            });
        });
    };
    ControlConfigProcessor.prototype.getAdditionalClasses = function (name, childClasses, index, controlConfig) {
        name = this.getName(name, controlConfig);
        var additionalClasses = BOOTSTRAP_DESIGN_CONFIG.elementClassPath[name];
        var childrenClasses = childClasses[index] ? childClasses[index] : {
            class: []
        };
        if (additionalClasses) {
            if (childrenClasses.class)
                additionalClasses = { class: additionalClasses.class.concat(childrenClasses.class), listenerProps: additionalClasses.listenerProps, child: additionalClasses.child };
            return additionalClasses;
        }
        return childrenClasses;
    };
    ControlConfigProcessor.prototype.getCollection = function (name, controlConfig) {
        if (name[0] == "[") {
            name = this.getName(name, controlConfig);
            return DYNAMIC_ELEMENT_DESIGN_TREE[name];
        }
        return undefined;
    };
    ControlConfigProcessor.prototype.getControlName = function (name) {
        var controlName = '';
        switch (name) {
            case "number":
            case "color":
            case "date":
            case "email":
            case "password":
            case "tel":
            case "time":
            case "url":
            case "color":
            case RANGE:
            case FILE:
            case TEXT:
                controlName = INPUT;
                break;
            default:
                controlName = name;
        }
        return controlName;
    };
    ControlConfigProcessor.prototype.getControlConfig = function (name) {
        return this.dynamicFormBuildConfig.controlsConfig[name];
    };
    ControlConfigProcessor.prototype.getName = function (name, controlConfig, isInline) {
        if (isInline === void 0) { isInline = false; }
        name = name.replace(new RegExp(/\[/g), '').replace(new RegExp(/\]/g), '');
        name = (name == CONTROL || isInline) ? this.getControlName(controlConfig.config.type) : name;
        switch (name) {
            case INPUT:
                name = this.prependControl(name, controlConfig);
                break;
            case INPUT_TEXT:
                name = INPUT;
                break;
        }
        return name;
    };
    ControlConfigProcessor.prototype.prependControl = function (name, controlConfig) {
        if (controlConfig.config.ui && controlConfig.config.ui.prependText && controlConfig.config.ui.prependText.right && controlConfig.config.ui.prependText.left)
            name = PREPEND_BOTH;
        else if (name == INPUT && controlConfig.config.ui && controlConfig.config.ui.prependText && controlConfig.config.ui.prependText.left)
            name = PREPEND_LEFT;
        else if (name == INPUT && controlConfig.config.ui && controlConfig.config.ui.prependText && controlConfig.config.ui.prependText.right)
            name = PREPEND_RIGHT;
        return name;
    };
    ControlConfigProcessor.prototype.isCreateElement = function (collection, controlConfig) {
        var isCreate = true;
        switch (collection) {
            case "[img]":
                isCreate = controlConfig.img != undefined;
            case SQUARE_LABEL:
                isCreate = controlConfig.label != undefined;
                break;
            case SQUARE_SMALL:
                isCreate = controlConfig.description != undefined;
                break;
            case SQUARE_ERROR:
                isCreate = controlConfig.formControl != undefined && (controlConfig.formControl.validator != undefined || controlConfig.formControl.asyncValidator != undefined);
                break;
        }
        return isCreate;
    };
    ControlConfigProcessor.prototype.getClassPath = function (name, controlConfig, isInline) {
        if (this.viewMode == INLINE)
            name = this.getName(name, controlConfig, isInline);
        return BOOTSTRAP_DESIGN_CONFIG.elementClassPath[name];
    };
    tslib_1.__decorate([
        Input('rxwebDynamicForm'),
        tslib_1.__metadata("design:type", Object)
    ], ControlConfigProcessor.prototype, "dynamicFormBuildConfig", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", String),
        tslib_1.__metadata("design:paramtypes", [String])
    ], ControlConfigProcessor.prototype, "viewMode", null);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Array)
    ], ControlConfigProcessor.prototype, "uiBindings", void 0);
    return ControlConfigProcessor;
}());
export { ControlConfigProcessor };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udHJvbC1jb25maWctcHJvY2Vzc29yLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHJ4d2ViL3JlYWN0aXZlLWR5bmFtaWMtZm9ybXMvIiwic291cmNlcyI6WyJmb3JtLWRlc2lnbmVyL2NvbnRyb2wtY29uZmlnLXByb2Nlc3Nvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLEtBQUssRUFBOEMsTUFBTSxlQUFlLENBQUM7QUFDbEYsT0FBTyxFQUFxQixhQUFhLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQTtBQUVsRixPQUFPLEVBQUUsMkJBQTJCLEVBQUUsTUFBTSw0Q0FBNEMsQ0FBQztBQUN6RixPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUNqRixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sZ0NBQWdDLENBQUE7QUFDaEUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQzNELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSx5Q0FBeUMsQ0FBQztBQUUxRSxPQUFPLEVBQUUsTUFBTSxFQUFDLFlBQVksRUFBRSxZQUFZLEVBQUUsYUFBYSxFQUFFLFVBQVUsRUFBQyxZQUFZLEVBQUUsWUFBWSxFQUFFLFlBQVksRUFBQyxjQUFjLEVBQUMsT0FBTyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFHN007SUErQkksZ0NBQXNCLE9BQWEsRUFBVSxRQUFRLEVBQVUsd0JBQWtELEVBQVUsZ0JBQWtDO1FBQXZJLFlBQU8sR0FBUCxPQUFPLENBQU07UUFBVSxhQUFRLEdBQVIsUUFBUSxDQUFBO1FBQVUsNkJBQXdCLEdBQXhCLHdCQUF3QixDQUEwQjtRQUFVLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUE5QjdKLFlBQU8sR0FBWSxLQUFLLENBQUM7SUE4QndJLENBQUM7SUExQnpKLHNCQUFJ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ciwgVmlld0NvbnRhaW5lclJlZiB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IEZvcm1Db250cm9sQ29uZmlnLCBDb250cm9sQ29uZmlnIH0gZnJvbSBcIi4uL3NlcnZpY2VzL2Zvcm0tY29udHJvbC1jb25maWdcIlxyXG5pbXBvcnQgeyBEeW5hbWljRm9ybUJ1aWxkQ29uZmlnIH0gZnJvbSBcIi4uL21vZGVscy9pbnRlcmZhY2UvZHluYW1pYy1mb3JtLWJ1aWxkLWNvbmZpZ1wiO1xyXG5pbXBvcnQgeyBEWU5BTUlDX0VMRU1FTlRfREVTSUdOX1RSRUUgfSBmcm9tICcuLi9jb25zdC9keW5hbWljLWVsZW1lbnQtZGVzaWduLXRyZWUuY29uc3QnO1xyXG5pbXBvcnQgeyBCT09UU1RSQVBfREVTSUdOX0NPTkZJRyB9IGZyb20gJy4uL2NvbnN0L2Jvb3RzdHJhcC1kZXNpZ24tY29uZmlnLmNvbnN0JztcclxuaW1wb3J0IHsgRG9tTWFuaXB1bGF0aW9uIH0gZnJvbSAnLi4vZG9tYWluL2RvbS9kb20tbWFuaXB1bGF0aW9uJ1xyXG5pbXBvcnQgeyBBcHBsaWNhdGlvblV0aWwgfSBmcm9tICcuLi91dGlsL2FwcGxpY2F0aW9uLXV0aWwnO1xyXG5pbXBvcnQgeyBvYmplY3RQcm9wVmFsdWUgfSBmcm9tICcuLi9mdW5jdGlvbnMvb2JqZWN0LXByb3AtdmFsdWUuZnVuY3Rpb24nO1xyXG5cclxuaW1wb3J0IHsgSU5MSU5FLFBSRVBFTkRfQk9USCwgUFJFUEVORF9MRUZULCBQUkVQRU5EX1JJR0hULCBJTlBVVF9URVhULFNRVUFSRV9FUlJPUiwgU1FVQVJFX1NNQUxMLCBTUVVBUkVfTEFCRUwsU1FVQVJFX0NPTlRST0wsQURWQU5DRSwgSU5QVVQsIFRFWFQsIFJBTkdFLCBGSUxFLCBTVFJJTkcsIENPTlRST0wgfSBmcm9tICcuLi9jb25zdC9hcHAuY29uc3QnO1xyXG5pbXBvcnQgeyBEeW5hbWljTm9kZUNvbmZpZyB9IGZyb20gXCIuLi9tb2RlbHMvaW50ZXJmYWNlL2R5bmFtaWMtbm9kZS1jb25maWdcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBDb250cm9sQ29uZmlnUHJvY2Vzc29yIHtcclxuICAgIGlzQnVpbGQ6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIF92aWV3TW9kZTogYW55O1xyXG4gICAgQElucHV0KCdyeHdlYkR5bmFtaWNGb3JtJykgZHluYW1pY0Zvcm1CdWlsZENvbmZpZzogRHluYW1pY0Zvcm1CdWlsZENvbmZpZztcclxuXHJcbiAgICBASW5wdXQoKSBzZXQgdmlld01vZGUodmFsdWU6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuX3ZpZXdNb2RlID0gdmFsdWU7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNCdWlsZClcclxuICAgICAgICAgICAgdGhpcy5idWlsZCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCB2aWV3TW9kZSgpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl92aWV3TW9kZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgY3VycmVudFZpZXdNb2RlKCk6IGFueSB7XHJcbiAgICAgICAgcmV0dXJuIERZTkFNSUNfRUxFTUVOVF9ERVNJR05fVFJFRS52aWV3TW9kZVt0aGlzLnZpZXdNb2RlXTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRWaWV3KG5hbWU6IHN0cmluZywgY29udHJvbENvbmZpZzogRm9ybUNvbnRyb2xDb25maWcpIHtcclxuICAgICAgICBpZiAodGhpcy52aWV3TW9kZSA9PSBJTkxJTkUpXHJcbiAgICAgICAgICAgIG5hbWUgPSB0aGlzLmdldE5hbWUobmFtZSxjb250cm9sQ29uZmlnLHRydWUpO1xyXG4gICAgICAgIHJldHVybiBEWU5BTUlDX0VMRU1FTlRfREVTSUdOX1RSRUVbbmFtZV07XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHZpZXdDbGFzc1BhdGgoKTogYW55IHtcclxuICAgICAgICByZXR1cm4gQk9PVFNUUkFQX0RFU0lHTl9DT05GSUcuZWxlbWVudENsYXNzUGF0aC52aWV3TW9kZVt0aGlzLnZpZXdNb2RlXTtcclxuICAgIH1cclxuXHJcbiAgICBASW5wdXQoKSB1aUJpbmRpbmdzOiBhbnlbXTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgZWxlbWVudDogTm9kZSwgcHJpdmF0ZSByZW5kZXJlciwgcHJpdmF0ZSBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgcHJpdmF0ZSB2aWV3Q29udGFpbmVyUmVmOiBWaWV3Q29udGFpbmVyUmVmKSB7IH1cclxuXHJcblxyXG4gICAgYnVpbGQoKSB7XHJcbiAgICAgICAgdGhpcy51aUJpbmRpbmdzLmZvckVhY2goY29udHJvbENvbmZpZ05hbWUgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmRlc2lnbkZvcm0oY29udHJvbENvbmZpZ05hbWUsIHRoaXMuZWxlbWVudCwgdGhpcy5jdXJyZW50Vmlld01vZGVbMF0sIHRoaXMuY3VycmVudFZpZXdNb2RlWzFdLCBCT09UU1RSQVBfREVTSUdOX0NPTkZJRy5lbGVtZW50Q2xhc3NQYXRoLnZpZXdNb2RlW3RoaXMudmlld01vZGVdKTtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIGRlc2lnbkZvcm0oY29udHJvbENvbmZpZ05hbWUsIGVsZW1lbnQsIHZpZXdSb290LCB2aWV3Q2hpbGQsIGNsYXNzUGF0aDogYW55LCBjaGlsZHJlbkNvbnRyb2xDb25maWc/OiBGb3JtQ29udHJvbENvbmZpZykge1xyXG4gICAgICAgIGxldCBjb250cm9sQ29uZmlnID0gY2hpbGRyZW5Db250cm9sQ29uZmlnIHx8IHRoaXMuZ2V0Q29udHJvbENvbmZpZyhjb250cm9sQ29uZmlnTmFtZSk7XHJcbiAgICAgICAgaWYgKGNvbnRyb2xDb25maWcpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMudmlld01vZGUgIT0gSU5MSU5FICYmIGNvbnRyb2xDb25maWcgJiYgIWNvbnRyb2xDb25maWcuY29uZmlnLnNraXBEZWZhdWx0VmlldylcclxuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlRWxlbWVudCh2aWV3Um9vdCwgdmlld0NoaWxkLCBlbGVtZW50LCBjb250cm9sQ29uZmlnLCBjbGFzc1BhdGgpO1xyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGxldCBjdXJyZW50VmlldyA9IHRoaXMuZ2V0Vmlldyhjb250cm9sQ29uZmlnLmNvbmZpZy50eXBlLCBjb250cm9sQ29uZmlnKTtcclxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50VmlldylcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUVsZW1lbnQoY3VycmVudFZpZXdbMF0sIGN1cnJlbnRWaWV3WzFdLCBlbGVtZW50LCBjb250cm9sQ29uZmlnLCB0aGlzLmdldENsYXNzUGF0aChjb250cm9sQ29uZmlnLmNvbmZpZy50eXBlLCBjb250cm9sQ29uZmlnLCB0aGlzLl92aWV3TW9kZSA9PSBJTkxJTkUpKTtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZURvbU1hbmlwdWxhdGlvbihjb250cm9sQ29uZmlnLmNvbmZpZy50eXBlLCBbXSwgZWxlbWVudCwgY29udHJvbENvbmZpZywgW10sIHRydWUpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMudmlld01vZGUgPT0gQURWQU5DRSAmJiBBcnJheS5pc0FycmF5KGNvbnRyb2xDb25maWdOYW1lKSkge1xyXG4gICAgICAgICAgICBsZXQgY29uZmlnOiBhbnkgPSBuZXcgQ29udHJvbENvbmZpZyh7IH0sIHt9KTtcclxuICAgICAgICAgICAgbGV0IGRvbU1hbmlwdWxhdGlvbiA9IHRoaXMuY3JlYXRlRWxlbWVudCh0aGlzLmN1cnJlbnRWaWV3TW9kZVswXSwgW10sIGVsZW1lbnQsIGNvbmZpZywgQk9PVFNUUkFQX0RFU0lHTl9DT05GSUcuZWxlbWVudENsYXNzUGF0aC52aWV3TW9kZVt0aGlzLnZpZXdNb2RlXSlcclxuICAgICAgICAgICAgY29udHJvbENvbmZpZ05hbWUuZm9yRWFjaCh0ID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGVzaWduRm9ybSh0LCBkb21NYW5pcHVsYXRpb24uZWxlbWVudCwgdGhpcy5jdXJyZW50Vmlld01vZGVbMV1bMF0sIHRoaXMuY3VycmVudFZpZXdNb2RlWzFdWzFdLCBCT09UU1RSQVBfREVTSUdOX0NPTkZJRy5lbGVtZW50Q2xhc3NQYXRoLnZpZXdNb2RlW3RoaXMudmlld01vZGVdLmNoaWxkW1wiMFwiXSlcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGNyZWF0ZUVsZW1lbnQoZWxlbWVudE5hbWU6IHN0cmluZywgY29sbGVjdGlvbnM6IGFueVtdLCBwYXJlbnRFbGVtZW50OiBhbnksIGNvbnRyb2xDb25maWc6IEZvcm1Db250cm9sQ29uZmlnLCBlbGVtZW50Q2xhc3NQYXRoOiBhbnkpIHtcclxuICAgICAgICBpZiAoIWVsZW1lbnROYW1lLnN0YXJ0c1dpdGgoXCIjXCIpKSB7XHJcbiAgICAgICAgICAgIGVsZW1lbnRDbGFzc1BhdGggPSBlbGVtZW50Q2xhc3NQYXRoID8gZWxlbWVudENsYXNzUGF0aCA6IHt9O1xyXG4gICAgICAgICAgICBsZXQgZG9tTWFuaXB1bGF0aW9uID0gdGhpcy5jcmVhdGVEb21NYW5pcHVsYXRpb24oZWxlbWVudE5hbWUsIGNvbGxlY3Rpb25zLCBwYXJlbnRFbGVtZW50LCBjb250cm9sQ29uZmlnLCBlbGVtZW50Q2xhc3NQYXRoKTtcclxuICAgICAgICAgICAgdGhpcy5jcmVhdGVDaGlsZHJlbnMoY29sbGVjdGlvbnMsIGRvbU1hbmlwdWxhdGlvbiwgY29udHJvbENvbmZpZywgZWxlbWVudENsYXNzUGF0aClcclxuICAgICAgICAgICAgaWYgKGNvbnRyb2xDb25maWcuY29uZmlnICYmIGNvbnRyb2xDb25maWcuY29uZmlnLmNoaWxkcmVucyAmJiBjb250cm9sQ29uZmlnLmNvbmZpZy5jaGlsZHJlbnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgY29udHJvbENvbmZpZy5jb25maWcuY2hpbGRyZW5zLmZvckVhY2goKHQsIGkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgY2hpbGRyZW5Db250cm9sQ29uZmlnID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghKHR5cGVvZiB0ID09IFNUUklORykgJiYgIUFycmF5LmlzQXJyYXkodCkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuQ29udHJvbENvbmZpZyA9IG5ldyBDb250cm9sQ29uZmlnKHsgLi4udCwgLi4ueyBza2lwRGVmYXVsdFZpZXc6IHRydWUgfSB9LCB7fSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZXNpZ25Gb3JtKHQsIGRvbU1hbmlwdWxhdGlvbi5lbGVtZW50LCB0aGlzLmN1cnJlbnRWaWV3TW9kZVswXSwgdGhpcy5jdXJyZW50Vmlld01vZGVbMV0sIEJPT1RTVFJBUF9ERVNJR05fQ09ORklHLmVsZW1lbnRDbGFzc1BhdGgudmlld01vZGVbdGhpcy52aWV3TW9kZV0sIGNoaWxkcmVuQ29udHJvbENvbmZpZyk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBkb21NYW5pcHVsYXRpb247XHJcbiAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlRG9tTWFuaXB1bGF0aW9uKGVsZW1lbnROYW1lLCBjb2xsZWN0aW9ucywgcGFyZW50RWxlbWVudCwgY29udHJvbENvbmZpZywgZWxlbWVudENsYXNzUGF0aCx0cnVlKTsvL3RoaXMuY3JlYXRlQ29tcG9uZW50Vmlldyhjb250cm9sQ29uZmlnLCBwYXJlbnRFbGVtZW50KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNyZWF0ZURvbU1hbmlwdWxhdGlvbihlbGVtZW50TmFtZTogc3RyaW5nLCBjb2xsZWN0aW9uczogYW55W10sIHBhcmVudEVsZW1lbnQ6IGFueSwgY29udHJvbENvbmZpZzogRm9ybUNvbnRyb2xDb25maWcsIGVsZW1lbnRDbGFzc1BhdGg6IGFueSwgaXNDb21wb25lbnRWaWV3OiBib29sZWFuID0gZmFsc2UpIHtcclxuICAgICAgICBsZXQgZHluYW1pY05vZGVDb25maWc6IER5bmFtaWNOb2RlQ29uZmlnID0ge1xyXG4gICAgICAgICAgICBjb250cm9sQ29uZmlnOiBjb250cm9sQ29uZmlnLCBhZGRpdGlvbmFsQ2xhc3NlczogZWxlbWVudENsYXNzUGF0aCwgcmVuZGVyZXI6IHRoaXMucmVuZGVyZXIsIGNvbGxlY3Rpb25zOiBjb2xsZWN0aW9ucywgY29udHJvbENvbmZpZ1Byb2Nlc3NvcjogdGhpcyxcclxuICAgICAgICAgICAgdmlld0NvbnRhaW5lclJlZjogaXNDb21wb25lbnRWaWV3ID8gdGhpcy52aWV3Q29udGFpbmVyUmVmIDogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXI6IGlzQ29tcG9uZW50VmlldyA/IHRoaXMuY29tcG9uZW50RmFjdG9yeVJlc29sdmVyIDogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICBkeW5hbWljRm9ybUJ1aWxkQ29uZmlnOiB0aGlzLmR5bmFtaWNGb3JtQnVpbGRDb25maWdcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG5ldyBEb21NYW5pcHVsYXRpb24ocGFyZW50RWxlbWVudCwgZWxlbWVudE5hbWUsIGR5bmFtaWNOb2RlQ29uZmlnKTtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVDaGlsZHJlbnMoY29sbGVjdGlvbnMsIGRvbU1hbmlwdWxhdGlvbiwgY29udHJvbENvbmZpZywgZWxlbWVudENsYXNzUGF0aCxpc1N1YnNjcmliZTpib29sZWFuID0gdHJ1ZSkge1xyXG4gICAgICAgIGxldCBlbGVtZW50Q291bnQgPSAwO1xyXG4gICAgICAgIGxldCBjaGlsZEVsZW1lbnRzQ2xhc3NDb25maWcgPSBlbGVtZW50Q2xhc3NQYXRoLmNoaWxkID8gZWxlbWVudENsYXNzUGF0aC5jaGlsZCA6IHt9O1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY29sbGVjdGlvbnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgbGV0IGNvbGxlY3Rpb24gPSBjb2xsZWN0aW9uc1tpXTtcclxuICAgICAgICAgICAgaWYgKCFBcHBsaWNhdGlvblV0aWwuaXNPYmplY3QoY29sbGVjdGlvbikpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzQ3JlYXRlRWxlbWVudChjb2xsZWN0aW9uc1tpXSwgY29udHJvbENvbmZpZykpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY29sbGVjdGlvbiA9PSBTUVVBUkVfQ09OVFJPTCAmJiBjb250cm9sQ29uZmlnLmNvbmZpZy50eXBlID09IHVuZGVmaW5lZCAmJiBjb250cm9sQ29uZmlnLmNvbmZpZy5jaGlsZENvbnRyb2xDb25maWdzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xDb25maWcuY29uZmlnLmNoaWxkQ29udHJvbENvbmZpZ3MuZm9yRWFjaCh4ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjaGlsZENvbnRyb2xDb25maWcgPSB0aGlzLmdldENvbnRyb2xDb25maWcoeCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUNoaWxkTm9kZXMoY29sbGVjdGlvbnMsIGNoaWxkQ29udHJvbENvbmZpZywgY2hpbGRFbGVtZW50c0NsYXNzQ29uZmlnLCBlbGVtZW50Q291bnQsIGksIGRvbU1hbmlwdWxhdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbGxlY3Rpb24gPT0gU1FVQVJFX0NPTlRST0wgJiYgY29udHJvbENvbmZpZy5jb25maWcudHlwZS5zdGFydHNXaXRoKFwiI1wiKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlRG9tTWFuaXB1bGF0aW9uKGNvbnRyb2xDb25maWcuY29uZmlnLnR5cGUsIFtdLCBkb21NYW5pcHVsYXRpb24uZWxlbWVudCwgY29udHJvbENvbmZpZyxbXSx0cnVlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpc0luY3JlYXNlID0gdGhpcy5jcmVhdGVDaGlsZE5vZGVzKGNvbGxlY3Rpb25zLCBjb250cm9sQ29uZmlnLCBjaGlsZEVsZW1lbnRzQ2xhc3NDb25maWcsIGVsZW1lbnRDb3VudCwgaSwgZG9tTWFuaXB1bGF0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0luY3JlYXNlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgPSBpICsgMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsZW1lbnRDb3VudCsrO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbGxlY3Rpb24uZm9yKVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucnVuRm9yQ29sbGVjdGlvbihjb2xsZWN0aW9uLCBkb21NYW5pcHVsYXRpb24sIGNvbnRyb2xDb25maWcsIGVsZW1lbnRDbGFzc1BhdGgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzU3Vic2NyaWJlKVxyXG4gICAgICAgICAgICAgICAgZG9tTWFuaXB1bGF0aW9uLnBhcnNlT2JqZWN0KGNvbGxlY3Rpb25zW2ldLCBpc1N1YnNjcmliZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjcmVhdGVDaGlsZE5vZGVzKGNvbGxlY3Rpb25zLCBjb250cm9sQ29uZmlnLCBjaGlsZEVsZW1lbnRzQ2xhc3NDb25maWcsIGVsZW1lbnRDb3VudCwgaSwgZG9tTWFuaXB1bGF0aW9uKSB7XHJcbiAgICAgICAgbGV0IGlzTmV4dENvbGxlY3Rpb246IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgICAgICBsZXQgbmV4dENvbGxlY3Rpb24gPSB0aGlzLmdldENvbGxlY3Rpb24oY29sbGVjdGlvbnNbaV0sIGNvbnRyb2xDb25maWcpO1xyXG4gICAgICAgIGxldCBjaGlsZENsYXNzZXMgPSB0aGlzLmdldEFkZGl0aW9uYWxDbGFzc2VzKGNvbGxlY3Rpb25zW2ldLCBjaGlsZEVsZW1lbnRzQ2xhc3NDb25maWcsIGVsZW1lbnRDb3VudCwgY29udHJvbENvbmZpZyk7XHJcbiAgICAgICAgaWYgKCFuZXh0Q29sbGVjdGlvbikge1xyXG4gICAgICAgICAgICBuZXh0Q29sbGVjdGlvbiA9IFtjb2xsZWN0aW9uc1tpXSwgY29sbGVjdGlvbnNbaSArIDFdXTtcclxuICAgICAgICAgICAgaXNOZXh0Q29sbGVjdGlvbiA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY3JlYXRlRWxlbWVudChuZXh0Q29sbGVjdGlvblswXSwgbmV4dENvbGxlY3Rpb25bMV0sIGRvbU1hbmlwdWxhdGlvbi5lbGVtZW50LCBjb250cm9sQ29uZmlnLCBjaGlsZENsYXNzZXMpO1xyXG4gICAgICAgIHJldHVybiBpc05leHRDb2xsZWN0aW9uO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBydW5Gb3JDb2xsZWN0aW9uKGNvbGxlY3Rpb246IGFueSwgZG9tTWFuaXB1bGF0aW9uLCBjb250cm9sQ29uZmlnLCBlbGVtZW50Q2xhc3NQYXRoKSB7XHJcbiAgICAgICAgT2JqZWN0LmtleXMoY29sbGVjdGlvbi5mb3IpLmZvckVhY2godCA9PiB7XHJcbiAgICAgICAgICAgIGxldCBzb3VyY2UgPSBvYmplY3RQcm9wVmFsdWUodCwgY29udHJvbENvbmZpZyk7XHJcbiAgICAgICAgICAgIHNvdXJjZS5mb3JFYWNoKCh4LCBpbmRleCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IGl0ZW0gPSBjb2xsZWN0aW9uLmZvclt0XS5jYWxsKGNvbnRyb2xDb25maWcsIHgsIGluZGV4KTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlQ2hpbGRyZW5zKGl0ZW0sIGRvbU1hbmlwdWxhdGlvbiwgY29udHJvbENvbmZpZywgZWxlbWVudENsYXNzUGF0aCk7XHJcbiAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRBZGRpdGlvbmFsQ2xhc3NlcyhuYW1lOiBzdHJpbmcsIGNoaWxkQ2xhc3NlczogeyBba2V5OiBzdHJpbmddOiBhbnkgfSwgaW5kZXg6IG51bWJlciwgY29udHJvbENvbmZpZzogRm9ybUNvbnRyb2xDb25maWcpIHtcclxuICAgICAgICBuYW1lID0gdGhpcy5nZXROYW1lKG5hbWUsIGNvbnRyb2xDb25maWcpXHJcbiAgICAgICAgbGV0IGFkZGl0aW9uYWxDbGFzc2VzID0gQk9PVFNUUkFQX0RFU0lHTl9DT05GSUcuZWxlbWVudENsYXNzUGF0aFtuYW1lXTtcclxuICAgICAgICBsZXQgY2hpbGRyZW5DbGFzc2VzID0gY2hpbGRDbGFzc2VzW2luZGV4XSA/IGNoaWxkQ2xhc3Nlc1tpbmRleF0gOiB7XHJcbiAgICAgICAgICAgIGNsYXNzOiBbXVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKGFkZGl0aW9uYWxDbGFzc2VzKSB7XHJcbiAgICAgICAgICAgIGlmIChjaGlsZHJlbkNsYXNzZXMuY2xhc3MpXHJcbiAgICAgICAgICAgICAgICBhZGRpdGlvbmFsQ2xhc3NlcyA9IHsgY2xhc3M6IGFkZGl0aW9uYWxDbGFzc2VzLmNsYXNzLmNvbmNhdChjaGlsZHJlbkNsYXNzZXMuY2xhc3MpLCBsaXN0ZW5lclByb3BzOiBhZGRpdGlvbmFsQ2xhc3Nlcy5saXN0ZW5lclByb3BzLCBjaGlsZDogYWRkaXRpb25hbENsYXNzZXMuY2hpbGQgfVxyXG4gICAgICAgICAgICByZXR1cm4gYWRkaXRpb25hbENsYXNzZXNcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBjaGlsZHJlbkNsYXNzZXM7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRDb2xsZWN0aW9uKG5hbWU6IHN0cmluZyxjb250cm9sQ29uZmlnOiBGb3JtQ29udHJvbENvbmZpZykge1xyXG4gICAgICAgIGlmIChuYW1lWzBdID09IFwiW1wiKSB7XHJcbiAgICAgICAgICAgIG5hbWUgPSB0aGlzLmdldE5hbWUobmFtZSwgY29udHJvbENvbmZpZyk7XHJcbiAgICAgICAgICAgIHJldHVybiBEWU5BTUlDX0VMRU1FTlRfREVTSUdOX1RSRUVbbmFtZV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRDb250cm9sTmFtZShuYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICBsZXQgY29udHJvbE5hbWU6IHN0cmluZyA9ICcnO1xyXG4gICAgICAgIHN3aXRjaCAobmFtZSkge1xyXG4gICAgICAgICAgICBjYXNlIFwibnVtYmVyXCI6XHJcbiAgICAgICAgICAgIGNhc2UgXCJjb2xvclwiOlxyXG4gICAgICAgICAgICBjYXNlIFwiZGF0ZVwiOlxyXG4gICAgICAgICAgICBjYXNlIFwiZW1haWxcIjpcclxuICAgICAgICAgICAgY2FzZSBcInBhc3N3b3JkXCI6XHJcbiAgICAgICAgICAgIGNhc2UgXCJ0ZWxcIjpcclxuICAgICAgICAgICAgY2FzZSBcInRpbWVcIjpcclxuICAgICAgICAgICAgY2FzZSBcInVybFwiOlxyXG4gICAgICAgICAgICBjYXNlIFwiY29sb3JcIjpcclxuICAgICAgICAgICAgY2FzZSBSQU5HRTpcclxuICAgICAgICAgICAgY2FzZSBGSUxFOlxyXG4gICAgICAgICAgICBjYXNlIFRFWFQ6XHJcbiAgICAgICAgICAgICAgICBjb250cm9sTmFtZSA9IElOUFVUO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICBjb250cm9sTmFtZSA9IG5hbWU7XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gY29udHJvbE5hbWU7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRDb250cm9sQ29uZmlnKG5hbWU6IHN0cmluZykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmR5bmFtaWNGb3JtQnVpbGRDb25maWcuY29udHJvbHNDb25maWdbbmFtZV07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXROYW1lKG5hbWU6IHN0cmluZywgY29udHJvbENvbmZpZzogRm9ybUNvbnRyb2xDb25maWcsaXNJbmxpbmU6Ym9vbGVhbiA9IGZhbHNlKSB7XHJcbiAgICAgICAgbmFtZSA9IG5hbWUucmVwbGFjZShuZXcgUmVnRXhwKC9cXFsvZyksICcnKS5yZXBsYWNlKG5ldyBSZWdFeHAoL1xcXS9nKSwgJycpO1xyXG4gICAgICAgIG5hbWUgPSAobmFtZSA9PSBDT05UUk9MIHx8IGlzSW5saW5lKSA/IHRoaXMuZ2V0Q29udHJvbE5hbWUoY29udHJvbENvbmZpZy5jb25maWcudHlwZSkgOiBuYW1lO1xyXG4gICAgICAgIHN3aXRjaCAobmFtZSkge1xyXG4gICAgICAgICAgICBjYXNlIElOUFVUOlxyXG4gICAgICAgICAgICAgICAgbmFtZSA9IHRoaXMucHJlcGVuZENvbnRyb2wobmFtZSxjb250cm9sQ29uZmlnKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIElOUFVUX1RFWFQ6XHJcbiAgICAgICAgICAgICAgICBuYW1lID0gSU5QVVQ7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG5hbWU7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBwcmVwZW5kQ29udHJvbChuYW1lOiBzdHJpbmcsIGNvbnRyb2xDb25maWc6IEZvcm1Db250cm9sQ29uZmlnKSB7XHJcbiAgICAgICAgaWYgKGNvbnRyb2xDb25maWcuY29uZmlnLnVpICYmIGNvbnRyb2xDb25maWcuY29uZmlnLnVpLnByZXBlbmRUZXh0ICYmIGNvbnRyb2xDb25maWcuY29uZmlnLnVpLnByZXBlbmRUZXh0LnJpZ2h0ICYmIGNvbnRyb2xDb25maWcuY29uZmlnLnVpLnByZXBlbmRUZXh0LmxlZnQpXHJcbiAgICAgICAgICAgIG5hbWUgPSBQUkVQRU5EX0JPVEg7XHJcbiAgICAgICAgZWxzZSBpZiAobmFtZSA9PSBJTlBVVCAmJiBjb250cm9sQ29uZmlnLmNvbmZpZy51aSAmJiBjb250cm9sQ29uZmlnLmNvbmZpZy51aS5wcmVwZW5kVGV4dCAmJiBjb250cm9sQ29uZmlnLmNvbmZpZy51aS5wcmVwZW5kVGV4dC5sZWZ0KVxyXG4gICAgICAgICAgICBuYW1lID0gUFJFUEVORF9MRUZUO1xyXG4gICAgICAgIGVsc2UgaWYgKG5hbWUgPT0gSU5QVVQgJiYgY29udHJvbENvbmZpZy5jb25maWcudWkgJiYgY29udHJvbENvbmZpZy5jb25maWcudWkucHJlcGVuZFRleHQgJiYgY29udHJvbENvbmZpZy5jb25maWcudWkucHJlcGVuZFRleHQucmlnaHQpXHJcbiAgICAgICAgICAgIG5hbWUgPSBQUkVQRU5EX1JJR0hUO1xyXG4gICAgICAgIHJldHVybiBuYW1lO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaXNDcmVhdGVFbGVtZW50KGNvbGxlY3Rpb246IGFueSwgY29udHJvbENvbmZpZzogRm9ybUNvbnRyb2xDb25maWcpIHtcclxuICAgICAgICBsZXQgaXNDcmVhdGUgPSB0cnVlO1xyXG4gICAgICAgIHN3aXRjaCAoY29sbGVjdGlvbikge1xyXG4gICAgICAgICAgICBjYXNlIFwiW2ltZ11cIjpcclxuICAgICAgICAgICAgICAgIGlzQ3JlYXRlID0gY29udHJvbENvbmZpZy5pbWcgIT0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICBjYXNlIFNRVUFSRV9MQUJFTDpcclxuICAgICAgICAgICAgICAgIGlzQ3JlYXRlID0gY29udHJvbENvbmZpZy5sYWJlbCAhPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBTUVVBUkVfU01BTEw6XHJcbiAgICAgICAgICAgICAgICBpc0NyZWF0ZSA9IGNvbnRyb2xDb25maWcuZGVzY3JpcHRpb24gIT0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgU1FVQVJFX0VSUk9SOlxyXG4gICAgICAgICAgICAgICAgaXNDcmVhdGUgPSBjb250cm9sQ29uZmlnLmZvcm1Db250cm9sICE9IHVuZGVmaW5lZCAmJiAoY29udHJvbENvbmZpZy5mb3JtQ29udHJvbC52YWxpZGF0b3IgIT0gdW5kZWZpbmVkIHx8IGNvbnRyb2xDb25maWcuZm9ybUNvbnRyb2wuYXN5bmNWYWxpZGF0b3IgIT0gdW5kZWZpbmVkKSA7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGlzQ3JlYXRlO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0Q2xhc3NQYXRoKG5hbWU6IHN0cmluZyxjb250cm9sQ29uZmlnOkZvcm1Db250cm9sQ29uZmlnLGlzSW5saW5lOmJvb2xlYW4pIHtcclxuICAgICAgICBpZiAodGhpcy52aWV3TW9kZSA9PSBJTkxJTkUpXHJcbiAgICAgICAgICAgIG5hbWUgPSB0aGlzLmdldE5hbWUobmFtZSxjb250cm9sQ29uZmlnLGlzSW5saW5lKTtcclxuICAgICAgICByZXR1cm4gQk9PVFNUUkFQX0RFU0lHTl9DT05GSUcuZWxlbWVudENsYXNzUGF0aFtuYW1lXTtcclxuICAgIH1cclxufSJdfQ==