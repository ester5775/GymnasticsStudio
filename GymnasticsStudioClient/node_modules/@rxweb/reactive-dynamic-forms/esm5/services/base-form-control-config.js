import * as tslib_1 from "tslib";
import { PropDescriptor } from './prop-descriptor';
import { FILTER, SOURCE } from '../const/app.const';
import { Linq } from '../util/linq';
import { NotificationState } from '../statics/control-state';
var BaseFormControlConfig = /** @class */ (function (_super) {
    tslib_1.__extends(BaseFormControlConfig, _super);
    function BaseFormControlConfig(configs, notificationId) {
        var _this = _super.call(this) || this;
        _this.configs = configs;
        _this.notificationId = notificationId;
        _this._actionResult = {
            label: undefined,
            img: undefined,
            placeholder: undefined,
            source: [],
            filter: [],
            hide: false,
            description: undefined,
            disabled: false,
            focus: false,
            readonly: false,
            class: [],
            prependText: ''
        };
        return _this;
    }
    BaseFormControlConfig.prototype.setNotification = function () {
        if (NotificationState.notifications[this.notificationId])
            if (!NotificationState.notifications[this.notificationId][this.config.name])
                NotificationState.notifications[this.notificationId][this.config.name] =
                    this.controlNotifications = { filter: [], disabled: [], label: [], description: [], hide: [], placeholder: [], readonly: [], focus: [], class: [] };
            else
                this.controlNotifications = NotificationState.notifications[this.notificationId][this.config.name];
        this.complete();
    };
    BaseFormControlConfig.prototype.complete = function () {
        var _this = this;
        var _loop_1 = function (action) {
            var descriptor = this_1.getDescriptor(action);
            if ((descriptor && descriptor.get) || this_1.isDefinedFilter) {
                var stringFunction = this_1.isDefinedFilter ? String(this_1[FILTER]) : String(descriptor.get);
                var columnNames = Linq.dynamicConfigParser(stringFunction);
                columnNames.forEach(function (column) {
                    if (!NotificationState.notifications[_this.notificationId][column])
                        NotificationState.notifications[_this.notificationId][column] = { filter: [], disabled: [], label: [], description: [], hide: [], placeholder: [], readonly: [], focus: [], class: [] };
                    var controlNotifications = NotificationState.notifications[_this.notificationId][column];
                    controlNotifications[action].push(_this.config.name);
                });
            }
        };
        var this_1 = this;
        for (var action in this.controlNotifications) {
            _loop_1(action);
        }
        this.overrideProps();
        this.updateActionValue();
    };
    BaseFormControlConfig.prototype.refresh = function (actionName) {
        var _this = this;
        for (var columnName in this.controlNotifications) {
            if (this.controlNotifications[columnName].length > 0)
                this.controlNotifications[columnName].forEach(function (x) {
                    if (columnName == FILTER)
                        _this.configs[x].value = null;
                    if (x != _this.config.name)
                        _this.configs[x].refresh(columnName);
                    else
                        _this.setActionValue(columnName);
                });
        }
        if (actionName)
            this.setActionValue(actionName);
    };
    BaseFormControlConfig.prototype.setActionValue = function (actionName) {
        if (actionName == FILTER && this.isDefinedFilter) {
            this[FILTER].call(this);
        }
        else
            this[actionName == FILTER ? SOURCE : actionName] = this[actionName];
    };
    BaseFormControlConfig.prototype.updateActionValue = function () {
        var _this = this;
        ["disabled", "label", "img", "placeholder", "hide", "description", "focus", "readonly", "class", "filter", "source"].forEach(function (key) {
            switch (key) {
                case FILTER:
                    if (_this.isDefinedFilter && key == FILTER)
                        _this[FILTER]();
                    if (_this.config.filter)
                        _this[FILTER] = _this.config.filter;
                    break;
                case SOURCE:
                    if (_this.config[key])
                        _this[key] = _this.config[key];
                    if (key == SOURCE && !_this.source)
                        _this[key] = [];
                    break;
                default:
                    if (_this.config.ui && _this.config.ui[key])
                        _this[key] = _this.config.ui[key];
                    else
                        _this[key == FILTER ? SOURCE : key] = _this._actionResult[key];
                    break;
            }
        });
    };
    return BaseFormControlConfig;
}(PropDescriptor));
export { BaseFormControlConfig };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS1mb3JtLWNvbnRyb2wtY29uZmlnLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHJ4d2ViL3JlYWN0aXZlLWR5bmFtaWMtZm9ybXMvIiwic291cmNlcyI6WyJzZXJ2aWNlcy9iYXNlLWZvcm0tY29udHJvbC1jb25maWcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQTtBQUNsRCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLG9CQUFvQixDQUFBO0FBRW5ELE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxjQUFjLENBQUE7QUFDbkMsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDN0Q7SUFBb0QsaURBQWM7SUFJOUQsK0JBQW9CLE9BQStCLEVBQVUsY0FBc0I7UUFBbkYsWUFDSSxpQkFBTyxTQUVWO1FBSG1CLGFBQU8sR0FBUCxPQUFPLENBQXdCO1FBQVUsb0JBQWMsR0FBZCxjQUFjLENBQVE7UUF1RjNFLG1CQUFhLEdBQWlCO1lBQ2xDLEtBQUssRUFBRSxTQUFTO1lBQ2hCLEdBQUcsRUFBRSxTQUFTO1lBQ2QsV0FBVyxFQUFFLFNBQVM7WUFDdEIsTUFBTSxFQUFFLEVBQUU7WUFDVixNQUFNLEVBQUUsRUFBRTtZQUNWLElBQUksRUFBRSxLQUFLO1lBQ1gsV0FBVyxFQUFFLFNBQVM7WUFDdEIsUUFBUSxFQUFFLEtBQUs7WUFDZixLQUFLLEVBQUUsS0FBSztZQUNaLFFBQVEsRUFBRSxLQUFLO1lBQ2YsS0FBSyxFQUFFLEVBQUU7WUFDVCxXQUFXLEVBQUUsRUFBRTtTQUNsQixDQUFDOztJQWpHRixDQUFDO0lBRUQsK0NBQWUsR0FBZjtRQUNJLElBQUksaUJBQWlCLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUM7WUFDcEQsSUFBSSxDQUFDLGlCQUFpQixDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUMsSUFB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QUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDO29CQUN0QyxNQUFNO2dCQUNWLEtBQUssTUFBTTtvQkFDUCxJQUFJLEtBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDO3dCQUNoQixLQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsS0FBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztvQkFDakMsSUFBSSxHQUFHLElBQUksTUFBTSxJQUFJLENBQUMsS0FBSSxDQUFDLE1BQU07d0JBQzdCLEtBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUM7b0JBQ25CLE1BQU07Z0JBQ1Y7b0JBQ0ksSUFBSSxLQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsSUFBSSxLQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUM7d0JBQ3JDLEtBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxLQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQzs7d0JBRWhDLEtBQUksQ0FBQyxHQUFHLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEtBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLENBQUM7b0JBQ2pFLE1BQU07YUFFYjtRQUVMLENBQUMsQ0FBQyxDQUFBO0lBQ04sQ0FBQztJQStCTCw0QkFBQztBQUFELENBQUMsQUF2SEQsQ0FBb0QsY0FBYyxHQXVIakUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcm9wRGVzY3JpcHRvciB9IGZyb20gJy4vcHJvcC1kZXNjcmlwdG9yJ1xyXG5pbXBvcnQgeyBGSUxURVIsIFNPVVJDRSB9IGZyb20gJy4uL2NvbnN0L2FwcC5jb25zdCdcclxuaW1wb3J0IHsgQWN0aW9uUmVzdWx0IH0gZnJvbSBcIi4uL21vZGVscy9pbnRlcmZhY2UvYWN0aW9uLWNvbmZpZ1wiXHJcbmltcG9ydCB7IExpbnEgfSBmcm9tICcuLi91dGlsL2xpbnEnXHJcbmltcG9ydCB7IE5vdGlmaWNhdGlvblN0YXRlIH0gZnJvbSAnLi4vc3RhdGljcy9jb250cm9sLXN0YXRlJztcclxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEJhc2VGb3JtQ29udHJvbENvbmZpZyBleHRlbmRzIFByb3BEZXNjcmlwdG9yIHtcclxuICAgIGNvbmZpZzogeyBba2V5OiBzdHJpbmddOiBhbnkgfTtcclxuICAgIHNvdXJjZTogYW55W107XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBjb25maWdzOiB7IFtrZXk6IHN0cmluZ106IGFueSB9LCBwcml2YXRlIG5vdGlmaWNhdGlvbklkOiBudW1iZXIpIHtcclxuICAgICAgICBzdXBlcigpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBzZXROb3RpZmljYXRpb24oKSB7XHJcbiAgICAgICAgaWYgKE5vdGlmaWNhdGlvblN0YXRlLm5vdGlmaWNhdGlvbnNbdGhpcy5ub3RpZmljYXRpb25JZF0pXHJcbiAgICAgICAgICAgIGlmICghTm90aWZpY2F0aW9uU3RhdGUubm90aWZpY2F0aW9uc1t0aGlzLm5vdGlmaWNhdGlvbklkXVt0aGlzLmNvbmZpZy5uYW1lXSlcclxuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvblN0YXRlLm5vdGlmaWNhdGlvbnNbdGhpcy5ub3RpZmljYXRpb25JZF1bdGhpcy5jb25maWcubmFtZV0gPVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbE5vdGlmaWNhdGlvbnMgPSB7IGZpbHRlcjogW10sIGRpc2FibGVkOiBbXSwgbGFiZWw6IFtdLCBkZXNjcmlwdGlvbjogW10sIGhpZGU6IFtdLCBwbGFjZWhvbGRlcjogW10sIHJlYWRvbmx5OiBbXSwgZm9jdXM6IFtdLCBjbGFzczogW10gfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xOb3RpZmljYXRpb25zID0gTm90aWZpY2F0aW9uU3RhdGUubm90aWZpY2F0aW9uc1t0aGlzLm5vdGlmaWNhdGlvbklkXVt0aGlzLmNvbmZpZy5uYW1lXTtcclxuICAgICAgICB0aGlzLmNvbXBsZXRlKCk7XHJcbiAgICB9XHJcblxyXG5cclxuXHJcbiAgICBjb21wbGV0ZSgpIHtcclxuICAgICAgICBmb3IgKGxldCBhY3Rpb24gaW4gdGhpcy5jb250cm9sTm90aWZpY2F0aW9ucykge1xyXG4gICAgICAgICAgICBsZXQgZGVzY3JpcHRvciA9IHRoaXMuZ2V0RGVzY3JpcHRvcihhY3Rpb24pO1xyXG4gICAgICAgICAgICBpZiAoKGRlc2NyaXB0b3IgJiYgZGVzY3JpcHRvci5nZXQpIHx8IHRoaXMuaXNEZWZpbmVkRmlsdGVyKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgc3RyaW5nRnVuY3Rpb24gPSB0aGlzLmlzRGVmaW5lZEZpbHRlciA/IFN0cmluZyh0aGlzW0ZJTFRFUl0pIDogU3RyaW5nKGRlc2NyaXB0b3IuZ2V0KTtcclxuICAgICAgICAgICAgICAgIGxldCBjb2x1bW5OYW1lcyA9IExpbnEuZHluYW1pY0NvbmZpZ1BhcnNlcihzdHJpbmdGdW5jdGlvbik7XHJcbiAgICAgICAgICAgICAgICBjb2x1bW5OYW1lcy5mb3JFYWNoKGNvbHVtbiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFOb3RpZmljYXRpb25TdGF0ZS5ub3RpZmljYXRpb25zW3RoaXMubm90aWZpY2F0aW9uSWRdW2NvbHVtbl0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvblN0YXRlLm5vdGlmaWNhdGlvbnNbdGhpcy5ub3RpZmljYXRpb25JZF1bY29sdW1uXSA9IHsgZmlsdGVyOiBbXSwgZGlzYWJsZWQ6IFtdLCBsYWJlbDogW10sIGRlc2NyaXB0aW9uOiBbXSwgaGlkZTogW10sIHBsYWNlaG9sZGVyOiBbXSwgcmVhZG9ubHk6IFtdLCBmb2N1czogW10sIGNsYXNzOiBbXSB9XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGNvbnRyb2xOb3RpZmljYXRpb25zID0gTm90aWZpY2F0aW9uU3RhdGUubm90aWZpY2F0aW9uc1t0aGlzLm5vdGlmaWNhdGlvbklkXVtjb2x1bW5dO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xOb3RpZmljYXRpb25zW2FjdGlvbl0ucHVzaCh0aGlzLmNvbmZpZy5uYW1lKVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLm92ZXJyaWRlUHJvcHMoKTtcclxuICAgICAgICB0aGlzLnVwZGF0ZUFjdGlvblZhbHVlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVmcmVzaChhY3Rpb25OYW1lPzogc3RyaW5nKSB7XHJcbiAgICAgICAgZm9yICh2YXIgY29sdW1uTmFtZSBpbiB0aGlzLmNvbnRyb2xOb3RpZmljYXRpb25zKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbnRyb2xOb3RpZmljYXRpb25zW2NvbHVtbk5hbWVdLmxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xOb3RpZmljYXRpb25zW2NvbHVtbk5hbWVdLmZvckVhY2goeCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbHVtbk5hbWUgPT0gRklMVEVSKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZ3NbeF0udmFsdWUgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh4ICE9IHRoaXMuY29uZmlnLm5hbWUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnc1t4XS5yZWZyZXNoKGNvbHVtbk5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRBY3Rpb25WYWx1ZShjb2x1bW5OYW1lKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChhY3Rpb25OYW1lKVxyXG4gICAgICAgICAgICB0aGlzLnNldEFjdGlvblZhbHVlKGFjdGlvbk5hbWUpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIHNldEFjdGlvblZhbHVlKGFjdGlvbk5hbWU6IHN0cmluZykge1xyXG4gICAgICAgIGlmIChhY3Rpb25OYW1lID09IEZJTFRFUiAmJiB0aGlzLmlzRGVmaW5lZEZpbHRlcikge1xyXG4gICAgICAgICAgICB0aGlzW0ZJTFRFUl0uY2FsbCh0aGlzKTtcclxuICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgdGhpc1thY3Rpb25OYW1lID09IEZJTFRFUiA/IFNPVVJDRSA6IGFjdGlvbk5hbWVdID0gdGhpc1thY3Rpb25OYW1lXTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHVwZGF0ZUFjdGlvblZhbHVlKCkge1xyXG4gICAgICAgIFtcImRpc2FibGVkXCIsIFwibGFiZWxcIixcImltZ1wiLCBcInBsYWNlaG9sZGVyXCIsIFwiaGlkZVwiLCBcImRlc2NyaXB0aW9uXCIsIFwiZm9jdXNcIiwgXCJyZWFkb25seVwiLCBcImNsYXNzXCIsIFwiZmlsdGVyXCIsIFwic291cmNlXCJdLmZvckVhY2goa2V5ID0+IHtcclxuICAgICAgICAgICAgc3dpdGNoIChrZXkpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgRklMVEVSOlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzRGVmaW5lZEZpbHRlciAmJiBrZXkgPT0gRklMVEVSKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzW0ZJTFRFUl0oKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jb25maWcuZmlsdGVyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzW0ZJTFRFUl0gPSB0aGlzLmNvbmZpZy5maWx0ZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFNPVVJDRTpcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jb25maWdba2V5XSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1trZXldID0gdGhpcy5jb25maWdba2V5XTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09IFNPVVJDRSAmJiAhdGhpcy5zb3VyY2UpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNba2V5XSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jb25maWcudWkgJiYgdGhpcy5jb25maWcudWlba2V5XSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1trZXldID0gdGhpcy5jb25maWcudWlba2V5XTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNba2V5ID09IEZJTFRFUiA/IFNPVVJDRSA6IGtleV0gPSB0aGlzLl9hY3Rpb25SZXN1bHRba2V5XTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBfYWN0aW9uUmVzdWx0OiBBY3Rpb25SZXN1bHQgPSB7XHJcbiAgICAgICAgbGFiZWw6IHVuZGVmaW5lZCxcclxuICAgICAgICBpbWc6IHVuZGVmaW5lZCxcclxuICAgICAgICBwbGFjZWhvbGRlcjogdW5kZWZpbmVkLFxyXG4gICAgICAgIHNvdXJjZTogW10sXHJcbiAgICAgICAgZmlsdGVyOiBbXSxcclxuICAgICAgICBoaWRlOiBmYWxzZSxcclxuICAgICAgICBkZXNjcmlwdGlvbjogdW5kZWZpbmVkLFxyXG4gICAgICAgIGRpc2FibGVkOiBmYWxzZSxcclxuICAgICAgICBmb2N1czogZmFsc2UsXHJcbiAgICAgICAgcmVhZG9ubHk6IGZhbHNlLFxyXG4gICAgICAgIGNsYXNzOiBbXSxcclxuICAgICAgICBwcmVwZW5kVGV4dDogJydcclxuICAgIH07XHJcblxyXG4gICAgcHJpdmF0ZSBjb250cm9sTm90aWZpY2F0aW9uczoge1xyXG4gICAgICAgIGRpc2FibGVkPzogc3RyaW5nW10sXHJcbiAgICAgICAgcGxhY2Vob2xkZXI/OiBzdHJpbmdbXSxcclxuICAgICAgICBmaWx0ZXI/OiBzdHJpbmdbXSxcclxuICAgICAgICBoaWRlPzogc3RyaW5nW10sXHJcbiAgICAgICAgZGVzY3JpcHRpb24/OiBzdHJpbmdbXSxcclxuICAgICAgICBsYWJlbD86IHN0cmluZ1tdLFxyXG4gICAgICAgIGZvY3VzPzogc3RyaW5nW10sXHJcbiAgICAgICAgcmVhZG9ubHk6IHN0cmluZ1tdLFxyXG4gICAgICAgIGNsYXNzOiBzdHJpbmdbXSxcclxuICAgICAgICBpbWc/OnN0cmluZ1tdXHJcbiAgICB9O1xyXG5cclxufSJdfQ==